/*!
 * Copyright (c) 2011-2012 Christian Haas
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */
if(typeof upro=="undefined"){var upro={};
}upro.Uuid={Empty:"00000000-0000-0000-0000-000000000000",newV4:function(b){return b?(b^Math.random()*16>>b/4).toString(16):([10000000]+-1000+-4000+-8000+-100000000000).replace(/[018]/g,upro.Uuid.newV4);
}};upro.sys={};Prototype.Browser.EVE_IGB=typeof CCPEVE!=="undefined";upro.sys.log=function(a){console.log((new Date().toISOString())+" upro: "+a);
};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b,a){return window.setTimeout(b,1000/60);
};})();window.cancelRequestAnimFrame=(function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout;
})();upro.sys.ResizableContext=Class.create({initialize:function(){},getHolderName:function(){return null;},getFrame:function(){return null;
}});upro.sys.ResizableContextWindow=Class.create(upro.sys.ResizableContext,{initialize:function(a){this.holderName=a;},getHolderName:function(){return this.holderName;
},getFrame:function(){return $(window);}});upro.sys.Time={tickMSec:function(){return +new Date();}};upro.sys.Timer=Class.create({initialize:function(a){this.callback=a;
this.context=null;this.executing=false;},start:function(a){if(this.context==null){this.context=this.startInternal(this.callbackInternal.bind(this),a);
}},startInternal:function(a,b){return null;},stop:function(){if(this.context!=null){var a=this.context;this.context=null;
this.stopInternal(a);}},stopInternal:function(a){},callbackInternal:function(){if(!this.executing){this.context=this.restartInternal(this.context);
try{this.executing=true;this.callback();this.executing=false;}catch(a){this.executing=false;throw a;}}},restartInternal:function(a){return a;
}});upro.sys.Timer.getIntervalTimer=function(b){var a=new upro.sys.Timer(b);a.startInternal=function(c,d){return window.setInterval(c,d);
};a.stopInternal=function(c){window.clearInterval(c);};return a;};upro.sys.Timer.getSingleTimer=function(b){var a=new upro.sys.Timer(b);
a.startInternal=function(c,d){return window.setTimeout(c,d);};a.stopInternal=function(c){window.clearTimeout(c);};a.restartInternal=function(c){return null;
};return a;};upro.sys.KeyboardListener=Class.create({initialize:function(c,b){this.handler=c;this.context=b||document;this.boundHandler={"keydown":this.onKeyDown.bind(this),"keyup":this.onKeyUp.bind(this),"keypress":this.onKeyPress.bind(this)};
for(var a in this.boundHandler){Element.observe(this.context,a,this.boundHandler[a]);}},destroy:function(){for(var a in this.boundHandler){Element.stopObserving(this.context,a,this.boundHandler[a]);
}},shouldStopEvent:function(c,b){var a=false;if((c==82)&&b.ctrlKey&&!b.shiftKey){a=true;}else{if(c==116){a=true;}else{if(c==118){a=true;
}else{if((c==65)&&b.ctrlKey){a=true;}else{if((c==70)&&b.ctrlKey){a=true;}else{if((c==83)&&b.ctrlKey){a=true;}else{if(c==Event.KEY_TAB){a=true;
}else{if(c==Event.KEY_BACKSPACE){a=true;}}}}}}}}return a;},onKeyDown:function(a){var b=a.which||a.keyCode;if(this.shouldStopEvent(b,a)){a.stop();
}this.handler.onDown(b);},onKeyUp:function(a){var b=a.which||a.keyCode;if(this.shouldStopEvent(b,a)){a.stop();}this.handler.onUp(b);
},onKeyPress:function(a){var b=a.which||a.keyCode;if(this.shouldStopEvent(b,a)){a.stop();}this.handler.onPress(b);}});upro.sys.KeyboardHandler=Class.create({initialize:function(){},onDown:function(a){},onUp:function(a){},onPress:function(a){}});
upro.sys.KeyboardDispatcher=Class.create(upro.sys.KeyboardHandler,{initialize:function(){this.handlers=[];},addHandler:function(a){if(this.handlers.indexOf(a)<0){this.handlers.push(a);
}},removeHandler:function(b){var a=this.handlers.indexOf(b);if(a>=0){this.handlers.splice(a,1);}},dispatch:function(a,f){var e=this.handlers.slice(0),b,d=false,c;
for(b=0;!d&&(b<e.length);b++){c=e[b];if((this.handlers.indexOf(c)>=0)&&c[a](f)){d=true;}}return d;},onDown:function(a){return this.dispatch("onDown",a);
},onUp:function(a){return this.dispatch("onUp",a);},onPress:function(a){return this.dispatch("onPress",a);}});upro.sys.MouseListener=Class.create({initialize:function(c,b){var a=this.onIgnored.bind(this);
this.handler=c;this.context=b||document;this.position={"x":0,"y":0,"z":0};this.buttons=[false,false,false];Element.observe(this.context,"click",a);
Element.observe(this.context,"dblclick",a);Element.observe(this.context,"contextmenu",a);Element.observe(this.context,"mousedown",this.onMouseDown.bind(this));
Element.observe(this.context,"mouseup",this.onMouseUp.bind(this));Element.observe(this.context,"mousemove",this.onMouseMove.bind(this));
Element.observe(this.context,"mousewheel",this.onMouseWheel.bind(this));Element.observe(this.context,"DOMMouseScroll",this.onMouseWheel.bind(this));
},updatePosition:function(a){this.position.x=a.pointerX();this.position.y=a.pointerY();this.position.z=0;},updateButtons:function(b,c){var a=[false,false,false];
if(b.isLeftClick()){a[upro.sys.MouseListener.BUTTON_INDEX_PRIMARY]=true;this.buttons[upro.sys.MouseListener.BUTTON_INDEX_PRIMARY]=c;
}if(b.isRightClick()){a[upro.sys.MouseListener.BUTTON_INDEX_SECONDARY]=true;this.buttons[upro.sys.MouseListener.BUTTON_INDEX_SECONDARY]=c;
}if(b.isMiddleClick()){a[upro.sys.MouseListener.BUTTON_INDEX_TERTIARY]=true;this.buttons[upro.sys.MouseListener.BUTTON_INDEX_TERTIARY]=c;
}return a;},onIgnored:function(a){a.stop();},onMouseDown:function(b){b.stop();this.updatePosition(b);var a=this.updateButtons(b,true);
this.handler.onDown(this.position,this.buttons,a);},onMouseUp:function(b){b.stop();if(!Prototype.Browser.EVE_IGB||!b.isMiddleClick()){this.updatePosition(b);
var a=this.updateButtons(b,false);this.handler.onUp(this.position,this.buttons,a);}},onMouseMove:function(a){this.updatePosition(a);
this.handler.onMove(this.position,this.buttons);},onMouseWheel:function(b){var a=null;Event.extend(b);b.stop();if(b.wheelDeltaX&&b.wheelDeltaY){a=[b.wheelDeltaX,b.wheelDeltaY,0];
}else{if(b.wheelDelta){a=[0,b.wheelDelta,0];}else{if(b.detail){a=[0,b.detail*-40,0];}}}if(a){if(Prototype.Browser.EVE_IGB){a[1]/=120;
}this.updatePosition(b);this.handler.onRotate(this.position,this.buttons,a);}}});upro.sys.MouseListener.BUTTON_INDEX_PRIMARY=0;
upro.sys.MouseListener.BUTTON_INDEX_SECONDARY=1;upro.sys.MouseListener.BUTTON_INDEX_TERTIARY=2;upro.sys.PointerHandler=Class.create({initialize:function(){},onDown:function(b,a,c){},onUp:function(b,a,c){},onMove:function(b,a){},onRotate:function(b,a,c){}});
upro.sys.PointerOperation=Class.create(upro.sys.PointerHandler,{initialize:function(){},onStart:function(b,a){},onStop:function(a){}});
upro.sys.PointerOperationRegistry=Class.create(upro.sys.PointerHandler,{initialize:function(){this.nullEntry={"buttonStates":[],"operation":upro.sys.PointerOperationRegistry.NullOperation};
this.operations=[];this.activeEntry=this.nullEntry;this.lastDivergingPosition=null;},registerOperation:function(a,b){this.operations.push({"buttonStates":a.slice(0),"operation":b});
},onDown:function(b,a,c){this.updateActiveOperation(b,a);this.activeEntry.operation.onDown(b,a,c);},onUp:function(b,a,d){var c=this.findMatchingOperationForStates(a);
this.lastDivergingPosition=null;if((this.activeEntry!=c)&&!this.doesStateMatchMask(this.activeEntry.buttonStates,c.buttonStates)){this.setActiveOperationEntry(c,b,a);
}else{this.activeEntry.operation.onUp(b,a,d);}},onMove:function(b,a){this.updateActiveOperation(b,a);this.activeEntry.operation.onMove(b,a);
},onRotate:function(b,a,c){var d=this.findMatchingOperationForStates(a);if(this.activeEntry!=d){this.setActiveOperationEntry(d,b,a);
}this.activeEntry.operation.onRotate(b,a,c);},updateActiveOperation:function(b,a){var d=this.findMatchingOperationForStates(a);
if(this.activeEntry!=d){var c=vec3.create([b.x,b.y,b.z]);if(!this.lastDivergingPosition){this.lastDivergingPosition=c;}else{if(vec3.length(vec3.subtract(c,this.lastDivergingPosition))>=upro.sys.PointerOperationRegistry.MoveThreshold){this.setActiveOperationEntry(d,b,a);
}}}},doesStateMatchMask:function(d,a){var c=true;for(var b=0;c&&(b<d.length);b++){if(d[b]&&!a[b]){c=false;}}return c;},findMatchingOperationForStates:function(a){var c=null;
for(var b=0;(c==null)&&(b<this.operations.length);b++){var d=this.operations[b];if(this.doesStateMatchMask(d.buttonStates,a)){c=d;
}}return(c!=null)?c:this.nullEntry;},setActiveOperationEntry:function(c,b,a){this.activeEntry.operation.onStop(b);this.activeEntry=c;
if(this.lastDivergingPosition!=null){this.activeEntry.operation.onStart({"x":this.lastDivergingPosition[0],"y":this.lastDivergingPosition[1],"z":this.lastDivergingPosition[2]},a);
this.lastDivergingPosition=null;}else{this.activeEntry.operation.onStart(b,a);}}});upro.sys.PointerOperationRegistry.NullOperation=new upro.sys.PointerOperation();
upro.sys.PointerOperationRegistry.MoveThreshold=5;upro.eve={};upro.eve.Util={REGEX_NAME:/([a-z]|[A-Z]|[0-9])+([-'\x2E\x20]?([a-z]|[A-Z]|[0-9])+)*/,REGEX_NAME_INPUT:/(([a-z]|[A-Z]|[0-9])+([-'\x2E\x20])?)*/,isValidName:function(b){var a=upro.eve.Util.REGEX_NAME.exec(b);
return(a!=null)&&(a.indexOf(b)>=0);},isValidNameInput:function(b){var a=upro.eve.Util.REGEX_NAME_INPUT.exec(b);return(a!=null)&&(a.indexOf(b)>=0);
}};upro.nav={};upro.nav.IdentifiedObjectHolder=Class.create({initialize:function(a){this.owner=a;this.position=this.owner.position;
this.objects={};this.listeners=[];this.waiters={};},toString:function(){return"ObjectHolder for "+this.owner.toString();},add:function(a){var d=this.waiters[a.id];
var c;this.objects[a.id]=a;for(c=this.listeners.length-1;c>=0;c--){this.listeners[c].onAdded(a);}if(d!==undefined){for(c=d.length-1;
c>=0;c--){var b=d[c];b(a);}delete this.waiters[a.id];}},remove:function(c){var a=this.objects[c];if(a!==undefined){delete this.objects[c];
for(var b=this.listeners.length-1;b>=0;b--){this.listeners[b].onRemoved(a);}}},get:function(a){return this.objects[a];},find:function(c){var a=[];
var d=c.toLowerCase();for(objectId in this.objects){var b=this.objects[objectId];var e=b.name.toLowerCase();if(e.indexOf(d)>=0){a.push(b);
}}return a;},findExact:function(b){var a=null;var d=b.toLowerCase();for(objectId in this.objects){var c=this.objects[objectId];
var e=c.name.toLowerCase();if(e==d){a=c;}}return a;},register:function(b){var a=this.listeners.indexOf(b);if(a<0){this.listeners.push(b);
}},unregister:function(b){var a=this.listeners.indexOf(b);if(a>=0){this.listeners.splice(a,1);}},waitFor:function(d,b){var a=this.get(d);
if(a!==undefined){b(a);}else{var c=this.waiters[d];if(c===undefined){this.waiters[d]=c=[];}c.push(b);}},stopWaitingFor:function(d,b){var c=this.waiters[d];
if(c!==undefined){var a=c.indexOf(b);if(a>=0){c.splice(a,1);if(c.length==0){delete this.waiters[d];}}}}});upro.nav.Universe=Class.create({initialize:function(){this.galaxies=new upro.nav.IdentifiedObjectHolder({position:vec3.create(0,0,0)});
}});upro.nav.Galaxy=Class.create({initialize:function(g,b,a,f,e,d){var c=this;this.id=g;this.name=b;this.scale=d?d:1;this.position=vec3.create([a,f,e]);
this.solarSystems=new upro.nav.IdentifiedObjectHolder(this);this.solarSystems.register({onAdded:function(h){c.onSolarSystemAdded(h);
},onRemoved:function(h){}});this.constellations=new upro.nav.IdentifiedObjectHolder(this);this.constellations.register({onAdded:function(h){c.onConstellationAdded(h);
},onRemoved:function(h){}});this.regions=new upro.nav.IdentifiedObjectHolder(this);this.regions.register({onAdded:function(h){c.onRegionAdded(h);
},onRemoved:function(h){}});this.jumpCorridors=[];},toString:function(){return"Galaxy ["+this.name+"]";},addStaticJumpCorridor:function(b,a,d){var c=new upro.nav.JumpCorridor(this,b,this,a,d);
this.jumpCorridors.push(c);},onSolarSystemAdded:function(a){var b=this.regions.get(a.regionId);a.galaxy=this;if(b!=undefined){this.registerSolarSystemInRegion(b,a);
}},onConstellationAdded:function(a){a.galaxy=this;for(regionId in this.regions.objects){var b=this.regions.get(regionId);
if(a.regionId===b.id){this.registerConstellationInRegion(b,a);}}},onRegionAdded:function(c){c.galaxy=this;for(constellationId in this.constellations.objects){var b=this.constellations.get(constellationId);
if(b.regionId===c.id){this.registerConstellationInRegion(c,b);}}for(systemId in this.solarSystems.objects){var a=this.solarSystems.get(systemId);
if(a.regionId===c.id){this.registerSolarSystemInRegion(c,a);}}},registerConstellationInRegion:function(b,a){if((a.region===null)&&(b.constellations.get(a.id)===undefined)){b.constellations.add(a);
}},registerSolarSystemInRegion:function(b,a){if((a.region===null)&&(b.solarSystems.get(a.id)===undefined)){b.solarSystems.add(a);
}}});upro.nav.Galaxy.create=function(f,b,a,e,d,c){return new upro.nav.Galaxy(f,b,a,e,d,c);};upro.nav.Region=Class.create({initialize:function(g,c,a,f,e,b){var d=this;
this.id=g;this.name=c;this.position=vec3.create([a,f,e]);this.galaxyId=b;this.galaxy=null;this.solarSystems=new upro.nav.IdentifiedObjectHolder(this);
this.solarSystems.register({onAdded:function(h){d.onSolarSystemAdded(h);},onRemoved:function(h){}});this.constellations=new upro.nav.IdentifiedObjectHolder(this);
this.constellations.register({onAdded:function(h){d.onConstellationAdded(h);},onRemoved:function(h){}});},toString:function(){return"Region ["+this.name+"]";
},onSolarSystemAdded:function(a){var b=this.constellations.get(a.constellationId);a.region=this;if(b!=undefined){this.registerSolarSystemInConstellation(b,a);
}},onConstellationAdded:function(b){b.region=this;for(systemId in this.solarSystems.objects){var a=this.solarSystems.get(systemId);
if(a.constellationId===b.id){this.registerSolarSystemInConstellation(b,a);}}},registerSolarSystemInConstellation:function(b,a){if((a.constellation===null)&&(b.solarSystems.get(a.id)===undefined)){b.solarSystems.add(a);
}}});upro.nav.Region.create=function(e,b,a,d,c){return new upro.nav.Region(e,b,a,d,c);};upro.nav.Constellation=Class.create({initialize:function(g,b,a,f,d,e){var c=this;
this.id=g;this.name=b;this.position=vec3.create([a,f,d]);this.galaxy=null;this.regionId=e;this.region=null;this.solarSystems=new upro.nav.IdentifiedObjectHolder(this);
this.solarSystems.register({onAdded:function(h){c.onSolarSystemAdded(h);},onRemoved:function(h){}});},toString:function(){return"Constellation ["+this.name+"]";
},onSolarSystemAdded:function(a){a.constellation=this;}});upro.nav.Constellation.create=function(f,b,a,e,c,d){return new upro.nav.Constellation(f,b,a,e,c,d);
};upro.nav.SolarSystem=Class.create({initialize:function(h,c,a,g,e,d,f,b){this.id=h;this.name=c;this.position=vec3.create([a,g,e]);
this.trueSec=d;this.security=(Math.floor((d+0.05)*10)/10).toFixed(1);if(this.security<0){this.security=0;}this.galaxy=null;
this.regionId=f;this.region=null;this.constellationId=b;this.constellation=null;this.jumpPortals=new upro.nav.IdentifiedObjectHolder(this);
},toString:function(){return"SolarSystem ["+this.name+"]";}});upro.nav.SolarSystem.create=function(h,c,a,g,e,d,f,b){return new upro.nav.SolarSystem(h,c,a,g,e,d,f,b);
};upro.nav.JumpType={None:"None",JumpGate:"JumpGate",JumpDrive:"JumpDrive",JumpBridge:"JumpBridge",StaticWormhole:"StaticWormhole",DynamicWormhole:"DynamicWormhole"};
upro.nav.JumpCorridor=Class.create({initialize:function(a,d,f,b,e){var c=this;this.jumpType=e;this.galaxy1=a;this.systemId1=d;
this.system1=null;this.portal1=null;this.galaxy2=f;this.systemId2=b;this.system2=null;this.portal2=null;if((a.id<f.id)||((a.id===f.id)&&(d<b))){this.id=this.createId(a,d,f,b);
}else{this.id=this.createId(f,b,a,d);}this.waiter1=function(g){c.onSystem1Added(g);};this.galaxy1.solarSystems.waitFor(this.systemId1,this.waiter1);
this.waiter2=function(g){c.onSystem2Added(g);};this.galaxy2.solarSystems.waitFor(this.systemId2,this.waiter2);},toString:function(){return"JumpCorridor ["+this.id+"]";
},getJumpType:function(){return this.jumpType;},createId:function(a,c,d,b){return""+a.id+"."+c+"-"+d.id+"."+b;},dispose:function(){this.galaxy1.solarSystems.stopWaitingFor(this.systemId1,this.waiter1);
if(this.system1!=null){this.system1.jumpPortals.remove(this.portal1.id);}this.galaxy2.solarSystems.stopWaitingFor(this.systemId2,this.waiter2);
if(this.system2!=null){this.system2.jumpPortals.remove(this.portal2.id);}},onSystem1Added:function(a){this.system1=a;this.checkPassage();
},onSystem2Added:function(a){this.system2=a;this.checkPassage();},checkPassage:function(){if((this.system1!=null)&&(this.system2!=null)){this.portal1=this.addPortal(this.system1,this.system2);
this.portal2=this.addPortal(this.system2,this.system1);}},addPortal:function(b,c){var a=this.createPortal(c);b.jumpPortals.add(a);
return a;},createPortal:function(a){return new upro.nav.JumpPortal(this,a);}});upro.nav.JumpPortal=Class.create({initialize:function(b,a){this.corridor=b;
this.system=a;this.id=a.id;this.name=a.name;},getJumpCorridor:function(){return this.corridor;},toString:function(){return"JumpPortal ["+this.name+"]";
}});upro.nav.SystemRouteEntry=Class.create({initialize:function(a,b,c){this.solarSystem=a;this.entryType=b;this.jumpType=c;
},getSolarSystem:function(){return this.solarSystem;},getEntryType:function(){return this.entryType;},getJumpType:function(){return this.jumpType;
},asEntryType:function(a){return new upro.nav.SystemRouteEntry(this.getSolarSystem(),a,this.jumpType);},acceptsNext:function(a){var b=false;
if((a.entryType==upro.nav.SystemRouteEntry.EntryType.Checkpoint)||(this.solarSystem!=a.solarSystem)){b=true;}return b;}});
upro.nav.SystemRouteEntry.EntryType={Checkpoint:"Checkpoint",Waypoint:"Waypoint",Transit:"Transit"};upro.nav.finder={};upro.nav.finder.PathFinder=Class.create({initialize:function(b,f,a,e,c){this.sourceSystem=b;
this.destinationSystem=f;this.capabilities=a;this.rules=e;this.filters=(c!==undefined)?c:[];this.waypointsBySystem={};this.cheapestPath=null;
this.pendingWaypoints=[];this.onlyConsiderLastCost=false;var g=new upro.nav.finder.PathFinderCost();var d=new upro.nav.finder.PathFinderWaypoint(this,this.sourceSystem,null,g,upro.nav.JumpType.None);
this.waypointsBySystem[this.sourceSystem.id]=d;this.pendingWaypoints.push(d);},performSearch:function(){var a=false;while(!a){a=this.continueSearch();
}},continueSearch:function(){if(this.pendingWaypoints.length>0){var a=this.pendingWaypoints.shift();this.processNextWaypoints(a);
}return this.pendingWaypoints.length==0;},processNextWaypoints:function(e){if(((this.cheapestPath==null)||(this.cheapestPath.totalCost.compareTo(e.totalCost,this.rules)>0))&&(this.onlyConsiderLastCost||(this.waypointsBySystem[e.system.id]===e))){var d=this.getNextWaypointsByCapabilities(e);
for(var c=0;c<d.length;c++){var a=d[c];var b=this.waypointsBySystem[a.system.id];if((b===undefined)||(a.totalCost.compareTo(b.totalCost,this.rules)<0)){if(a.system===this.destinationSystem){this.waypointsBySystem[a.system.id]=a;
this.onPathFound(a);}else{if(!this.onlyConsiderLastCost){this.waypointsBySystem[a.system.id]=a;}this.pendingWaypoints.push(a);
}}}}},getNextWaypointsByCapabilities:function(a){var g=[];for(var e=0;e<this.capabilities.length;e++){var b=this.capabilities[e];
var j=b.getNextWaypoints(this,a);for(var h=0;h<j.length;h++){var d=j[h];var i=false;for(var f=0;!i&&(f<g.length);f++){var c=g[f];
if(c.system===d.system){i=true;if(c.totalCost.compareTo(d.totalCost,this.rules)>0){g[f]=d;}}}if(!i&&!this.isWaypointFiltered(d)){g.push(d);
}}}return g;},isWaypointFiltered:function(a){var d=false;if(a.system!==this.destinationSystem){for(var b=0;!d&&(b<this.filters.length);
b++){var c=this.filters[b];d=c.isWaypointFiltered(this,a);}}return d;},onPathFound:function(a){this.cheapestPath=a;},getBasicCostTo:function(a){var b=new upro.nav.finder.PathFinderCost();
b.costItems.jumps=1;if(a!==this.destinationSystem){b.setSecurity(a);}return b;},sumCosts:function(a,b){return a.plus(b,this.rules);
}});upro.nav.finder.PathFinderCapability=Class.create({initialize:function(){},getNextWaypoints:function(b,a){return[];}});
upro.nav.finder.PathFinderCapabilityJumpDrive=Class.create(upro.nav.finder.PathFinderCapability,{initialize:function(a){this.maxLightYears=a;
this.lightYearToMeters=9460.7304725808;this.maxDistance=this.maxLightYears*this.lightYearToMeters;},getNextWaypoints:function(k,d){var i=[];
var b=d.system.galaxy;if(b.id==9){var a=b.solarSystems;var g=vec3.create();for(var j in a.objects){var c=a.get(j);if((c.security<0.5)&&(c!==d.system)){var h=vec3.length(vec3.subtract(d.system.position,c.position,g));
if(h<=this.maxDistance){var f=k.getBasicCostTo(c);f.costItems.jumpDistance=h;var e=new upro.nav.finder.PathFinderWaypoint(k,c,d,k.sumCosts(d.totalCost,f),upro.nav.JumpType.JumpDrive);
i.push(e);}}}}return i;}});upro.nav.finder.PathFinderCapabilityJumpGates=Class.create(upro.nav.finder.PathFinderCapability,{initialize:function(){},getNextWaypoints:function(i,c){var g=[];
for(var h in c.system.jumpPortals.objects){var d=c.system.jumpPortals.get(h);var a=d.getJumpCorridor().getJumpType();if(a==upro.nav.JumpType.JumpGate){var b=d.system;
var f=i.getBasicCostTo(b);var e=new upro.nav.finder.PathFinderWaypoint(i,b,c,i.sumCosts(c.totalCost,f),a);g.push(e);}}return g;
}});upro.nav.finder.PathFinderCapabilityWaypoints=Class.create(upro.nav.finder.PathFinderCapability,{initialize:function(a,b){this.routesBySourceSystem=a;
this.destinationSystem=b;},getNextWaypoints:function(i,a){var h=[];var f=this.routesBySourceSystem[a.system.id];for(var d in f){var g=f[d];
var e=this.getSystemFromPath(g,d);if(!this.isSystemInRoute(a,e)&&(e!==this.destinationSystem)){var c=g.totalCost;var b=new upro.nav.finder.PathFinderWaypoint(i,e,a,i.sumCosts(a.totalCost,c));
h.push(b);}}if((h.length==0)&&(this.destinationSystem!==undefined)){var g=f[this.destinationSystem.id];var c=g.totalCost;
var b=new upro.nav.finder.PathFinderWaypoint(i,this.destinationSystem,a,i.sumCosts(a.totalCost,c));h.push(b);}return h;},isSystemInRoute:function(d,c){var b=false;
var a=d;while(!b&&(a!==null)){b=a.system===c;a=a.previousWaypoint;}return b;},getSystemFromPath:function(d,a){var c=null;
var b=d;while((c===null)&&(b!==null)){if(b.system.id==a){c=b.system;}b=b.previousWaypoint;}return c;}});upro.nav.finder.PathFinderCost=Class.create({initialize:function(){this.costItems={};
},setSecurity:function(a){this.costItems.minSecurity=a.security;this.costItems.maxSecurity=a.security;},toString:function(){var b="{";
for(var a in this.costItems){b+=a+": "+this.costItems[a]+",";}b+=" }";return b;},compareTo:function(a,e){var c=0;for(var b=0;
(c==0)&&(b<e.length);b++){var d=e[b];c=d.comparator(this.costItems,a.costItems);}return c;},plus:function(b,f){var a=new upro.nav.finder.PathFinderCost();
for(var d in this.costItems){a.costItems[d]=this.costItems[d];}for(var c=0;c<f.length;c++){var e=f[c];e.add(a.costItems,b.costItems);
}return a;}});upro.nav.finder.PathFinderCostRule=Class.create({initialize:function(){},comparator:function(a,b){return 0;
},add:function(a,b){}});upro.nav.finder.PathFinderCostRuleJumpFuel=Class.create(upro.nav.finder.PathFinderCostRule,{initialize:function(b){var a=9460.7304725808;
this.margin=b*a;},comparator:function(b,e){var d=b.jumpDistance?b.jumpDistance:0;var c=e.jumpDistance?e.jumpDistance:0;var a=d-c;
if(this.margin>0){a/=this.margin;a=((a<0)?Math.ceil(a):Math.floor(a))*this.margin;}return a;},add:function(a,b){if(b.jumpDistance!==undefined){if(a.jumpDistance){a.jumpDistance+=b.jumpDistance;
}else{a.jumpDistance=b.jumpDistance;}}}});upro.nav.finder.PathFinderCostRuleJumps=Class.create(upro.nav.finder.PathFinderCostRule,{initialize:function(a){this.margin=a;
},comparator:function(b,c){var a=b.jumps-c.jumps;if(this.margin>0){a/=this.margin;a=((a<0)?Math.ceil(a):Math.floor(a))*this.margin;
}return a;},add:function(a,b){if(a.jumps){a.jumps+=b.jumps;}else{a.jumps=b.jumps;}}});upro.nav.finder.PathFinderCostRuleMaxSecurity=Class.create(upro.nav.finder.PathFinderCostRule,{initialize:function(a){this.securityLimit=a;
},comparator:function(a,d){var c=(a.maxSecurity!==undefined)?((a.maxSecurity<this.securityLimit)?-1:0):-10;var b=(d.maxSecurity!==undefined)?((d.maxSecurity<this.securityLimit)?-1:0):-10;
if((c==0)&&(b==0)){c=a.maxSecurity-this.securityLimit;b=d.maxSecurity-this.securityLimit;}return c-b;},add:function(a,b){if(a.maxSecurity!==undefined){if((b.maxSecurity!==undefined)&&(a.maxSecurity<b.maxSecurity)){a.maxSecurity=b.maxSecurity;
}}else{a.maxSecurity=b.maxSecurity;}}});upro.nav.finder.PathFinderCostRuleMinSecurity=Class.create(upro.nav.finder.PathFinderCostRule,{initialize:function(a){this.securityLimit=a;
},comparator:function(a,d){var c=(a.minSecurity!==undefined)?((a.minSecurity>=this.securityLimit)?-1:0):-10;var b=(d.minSecurity!==undefined)?((d.minSecurity>=this.securityLimit)?-1:0):-10;
if((c==0)&&(b==0)){c=this.securityLimit-a.minSecurity;b=this.securityLimit-d.minSecurity;}return c-b;},add:function(a,b){if(a.minSecurity!==undefined){if((b.minSecurity!==undefined)&&(a.minSecurity>b.minSecurity)){a.minSecurity=b.minSecurity;
}}else{a.minSecurity=b.minSecurity;}}});upro.nav.finder.PathFinderFilter=Class.create({initialize:function(){},isWaypointFiltered:function(b,a){return false;
}});upro.nav.finder.PathFinderFilterSystem=Class.create({initialize:function(a){this.systemId=a;},isWaypointFiltered:function(b,a){return a.system.id==this.systemId;
}});upro.nav.finder.PathFinderWaypoint=Class.create({initialize:function(c,b,a,e,d){this.system=b;this.previousWaypoint=a;
this.totalCost=e;this.jumpType=d;},isUnidirectional:function(){return this.jumpType==upro.nav.JumpType.JumpDrive;},getPathInNames:function(){var d="[";
var c=[];var a=this.previousWaypoint;c.push(this.system.name);while(a!=null){c.push(a.system.name+", ");a=a.previousWaypoint;
}c.reverse();for(var b=0;b<c.length;b++){d+=c[b];}d+="]";return d;}});upro.nav.finder.RouteFinder=Class.create({initialize:function(a,e,c,b,f,d){this.capabilities=a;
this.rules=e;this.filters=c;this.sourceSystem=b;this.waypoints=f;this.destinationSystem=d;this.pendingTask=undefined;this.route=[];
},continueSearch:function(){if(this.pendingTask===undefined){this.clearRoute();this.pendingTask=this.internalStart;}if(this.pendingTask!==undefined){this.pendingTask=this.pendingTask();
}return this.pendingTask===undefined;},internalStart:function(){return undefined;},getRouteEntries:function(){return this.route;
},addRouteEntry:function(a,b,c){this.route.push(new upro.nav.SystemRouteEntry(a,b,c));},clearRoute:function(){this.route=[];
},searchFailed:function(){this.clearRoute();}});upro.nav.finder.RouteFinderSimple=Class.create(upro.nav.finder.RouteFinder,{initialize:function($super,a,e,c,b,f,d){$super(a,e,c,b,f,d);
this.pathFinder=null;this.lastSystem=null;this.waypointIndex=0;},internalStart:function(){this.pathFinder=null;this.lastSystem=this.sourceSystem;
this.waypointIndex=0;return this.getNextStep();},getNextStep:function(){var a=null;var b=undefined;if(this.waypointIndex<this.waypoints.length){this.addRouteEntry(this.lastSystem,upro.nav.SystemRouteEntry.EntryType.Waypoint);
a=this.waypoints[this.waypointIndex];}else{if(this.lastSystem!==this.destinationSystem){this.addRouteEntry(this.lastSystem,upro.nav.SystemRouteEntry.EntryType.Waypoint);
a=this.destinationSystem;}}if(a){this.pathFinder=new upro.nav.finder.PathFinder(this.lastSystem,a,this.capabilities,this.rules,this.filters);
b=this.runFinder;}return b;},runFinder:function(){var a=this.pathFinder.continueSearch();var e=this.runFinder;if(a){if(this.pathFinder.cheapestPath){var b=this.pathFinder.cheapestPath.previousWaypoint;
var d=[];while((b!=null)&&(b.previousWaypoint!=null)){d.push(b.system);b=b.previousWaypoint;}d.reverse();for(var c=0;c<d.length;
c++){this.addRouteEntry(d[c],upro.nav.SystemRouteEntry.EntryType.Transit,d[c].jumpType);}this.lastSystem=this.pathFinder.cheapestPath.system;
this.waypointIndex++;e=this.getNextStep();}else{this.searchFailed();e=undefined;}}return e;}});upro.nav.finder.RouteFinderAbstractTSP=Class.create(upro.nav.finder.RouteFinder,{initialize:function($super,a,e,c,b,f,d){$super(a,e,c,b,f,d);
this.edges=[];this.edgeMap={};},internalStart:function(){var a=undefined;this.createEdges();this.edgeIndex=0;if(this.edges.length>0){a=this.runNextEdge();
}else{this.addRouteEntry(this.sourceSystem,upro.nav.SystemRouteEntry.EntryType.Waypoint,upro.nav.JumpType.None);}return a;
},createEdges:function(){this.edges=[];this.edgeMap={};if(this.destinationSystem&&(this.sourceSystem.id!=this.destinationSystem.id)){this.addBidirectionalEdge(this.sourceSystem,this.destinationSystem);
}for(var c=0;c<this.waypoints.length;c++){var a=this.waypoints[c];this.addBidirectionalEdge(this.sourceSystem,a);if(this.destinationSystem){this.addBidirectionalEdge(a,this.destinationSystem);
}for(var b=c+1;b<this.waypoints.length;b++){this.addBidirectionalEdge(a,this.waypoints[b]);}}},addBidirectionalEdge:function(a,c){var b=this.createEdge(a,c);
this.setEdgeMapEntry(a.id,c.id,b);this.setEdgeMapEntry(c.id,a.id,b);},addUnidirectionalEdge:function(a,c){var b=this.createEdge(a,c);
this.setEdgeMapEntry(a.id,c.id,b);},createEdge:function(a,c){var b={systemA:a,systemB:c,path:null,cost:null};this.edges.push(b);
return b;},setEdgeMapEntry:function(c,b,d){var a=this.edgeMap[c];if(a===undefined){this.edgeMap[c]=a={};}a[b]=d;},runNextEdge:function(){var c=this.tspStart;
if(this.edgeIndex<this.edges.length){var b=this.edges[this.edgeIndex];this.pathFinder=new upro.nav.finder.PathFinder(b.systemA,b.systemB,this.capabilities,this.rules,this.filters);
c=this.runFinder;}else{if(this.waypoints.length<2){var a=[];a.push(this.sourceSystem);if(this.waypoints.length==1){a.push(this.waypoints[0]);
}if(this.destinationSystem){a.push(this.destinationSystem);}this.onRouteFound(a);c=undefined;}}return c;},runFinder:function(){var a=this.pathFinder.continueSearch();
var c=this.runFinder;if(a){if(this.pathFinder.cheapestPath){var b=this.edges[this.edgeIndex];b.cost=this.pathFinder.cheapestPath.totalCost;
b.path=this.pathFinder.cheapestPath;this.checkUnidirectionalEdge(b);this.edgeIndex++;c=this.runNextEdge();}else{this.searchFailed();
c=undefined;}}return c;},checkUnidirectionalEdge:function(b){var c=false;var a=b.path;while(!c&&a){if(a.isUnidirectional()){c=true;
}a=a.previousWaypoint;}if(c&&this.edgeMap[b.systemB.id][b.systemA.id]==b){this.addUnidirectionalEdge(b.systemB,b.systemA);
}},tspStart:function(){return undefined;},onRouteFound:function(m){var e;var d=null;var g,f;this.clearRoute();for(g=0;g<(m.length-1);
g++){var k=m[g];var h=m[g+1];var b=this.edgeMap[k.id][h.id];var a=[];var l=[];var c=b.path;e=g<(m.length-2);while(c!=null){a.push(c.system);
l.push(c.jumpType);c=c.previousWaypoint;}l.pop();if(k===b.systemA){a.reverse();l.reverse();}if(e||(this.destinationSystem)){a.pop();
}else{l.push(upro.nav.JumpType.None);}for(f=0;f<a.length;f++){d=upro.nav.SystemRouteEntry.EntryType.Transit;if((f==0)||((f==a.length-1)&&!e&&!this.destinationSystem)){d=upro.nav.SystemRouteEntry.EntryType.Waypoint;
}this.addRouteEntry(a[f],d,l[f]);}}m.shift();if(this.destinationSystem){m.pop();}this.waypoints=m;}});upro.nav.finder.RouteFinderBruteForceTSP=Class.create(upro.nav.finder.RouteFinderAbstractTSP,{initialize:function($super,a,e,c,b,f,d){$super(a,e,c,b,f,d);
this.bruteForceFinder=null;},tspStart:function(){var a={};for(var e in this.edgeMap){var b=this.edgeMap[e];var g={};a[e]=g;
for(var f in b){var d=b[f];g[f]=d.path;}}var c=[];c.push(new upro.nav.finder.PathFinderCapabilityWaypoints(a,this.destinationSystem));
this.bruteForceFinder=new upro.nav.finder.PathFinder(this.sourceSystem,this.destinationSystem,c,this.rules,undefined);this.bruteForceFinder.onlyConsiderLastCost=true;
return this.runBruteForceFinder;},runBruteForceFinder:function(){var a=this.bruteForceFinder.continueSearch();var d=this.runBruteForceFinder;
if(a){if(this.bruteForceFinder.cheapestPath){var b=this.bruteForceFinder.cheapestPath;var c=[];while(b!=null){c.push(b.system);
b=b.previousWaypoint;}c.reverse();this.onRouteFound(c);}else{this.searchFailed();}d=undefined;}return d;}});upro.nav.finder.RouteFinderGeneticTSP=Class.create(upro.nav.finder.RouteFinderAbstractTSP,{initialize:function($super,a,e,c,b,f,d){$super(a,e,c,b,f,d);
this.population=[];this.populationLimit=10;this.initialPopulationCount=50;this.generationLimit=40000;this.uncontestetLimit=4000;
this.mutationPercentage=0.5;},tspStart:function(){for(var a=0;a<this.initialPopulationCount;a++){this.createRandomCitizen();
}this.onRouteFound(this.population[0].route.slice(0));this.generation=0;this.uncontestet=0;return this.runGeneration;},runGeneration:function(){var d=this.runGeneration;
if(this.population.length>this.populationLimit){this.population.splice(this.populationLimit,this.population.length-this.populationLimit);
}if((this.generation<this.generationLimit)&&(this.uncontestet<this.uncontestetLimit)){var b=this.population[this.getRandomIndex(this.population.length)];
var a=this.population[this.getRandomIndex(this.population.length)];var c=1+this.getRandomIndex(this.waypoints.length);this.generateOffspring(b,a,c);
this.generateOffspring(a,b,c);this.generation++;this.uncontestet++;}else{d=undefined;}return d;},getRandomIndex:function(a){var b=Math.floor(Math.random()*a);
if(b>=a){b=a-1;}return b;},createChromosome:function(){var a={cost:new upro.nav.finder.PathFinderCost(),route:[]};return a;
},createRandomCitizen:function(){var a=this.createChromosome();a.route.push(this.sourceSystem);for(var b=0;b<this.waypoints.length;
b++){this.addRandomWaypointToChromosome(a);}if(this.destinationSystem){a.route.push(this.destinationSystem);}a.cost=this.calculateCost(a);
this.integrateSorted(a);},addRandomWaypointToChromosome:function(a){var c=false;while(!c){var b=this.getRandomIndex(this.waypoints.length);
var d=this.waypoints[b];if(!this.chromosomeContainsSystem(a,d)){a.route.push(d);c=true;}}},chromosomeContainsSystem:function(b,e){var d=false;
for(var c=1;!d&&(c<b.route.length);c++){var a=b.route[c];d=a.id==e.id;}return d;},calculateCost:function(b){var f=new upro.nav.finder.PathFinderCost();
for(var c=0;c<(b.route.length-1);c++){var a=b.route[c];var e=b.route[c+1];var d=this.edgeMap[a.id][e.id];f=f.plus(d.path.totalCost,this.rules);
}return f;},integrateSorted:function(d){var c=false;var b=false;var e;for(e=this.population.length-1;!c&&(e>=0);e--){var a=this.population[e];
if(d.cost.compareTo(a.cost,this.rules)>0){this.population.splice(e+1,0,d);c=true;}}if(!c){this.population.splice(0,0,d);b=true;
}return b;},generateOffspring:function(j,h,f){var a=this.createChromosome();var e=(Math.random()*100)<this.mutationPercentage;
var g;for(g=0;g<f;g++){a.route.push(j.route[g]);}for(g=f;g<h.route.length;g++){var c=j.route[g];var b=h.route[g];if(!this.chromosomeContainsSystem(a,b)){var d=!e&&(c.id!=b.id)&&!this.chromosomeContainsSystem(a,c);
a.route.push(b);if(d){var k=this.calculateCost(a);a.route[a.route.length-1]=c;var l=this.calculateCost(a);if(l.compareTo(k,this.rules)>=0){a.route[a.route.length-1]=b;
}}}else{if(!this.chromosomeContainsSystem(a,c)){a.route.push(c);}else{this.addRandomWaypointToChromosome(a);}}}if(e){this.mutate(a);
}a.cost=this.calculateCost(a);if(this.integrateSorted(a)){this.onRouteFound(a.route.slice(0));this.uncontestet=0;}},mutate:function(b){var d=1+this.getRandomIndex(this.waypoints.length);
var c=1+this.getRandomIndex(this.waypoints.length);var a=b.route[d];b.route[d]=b.route[c];b.route[c]=a;}});upro.scene={};
upro.scene.SceneSystem=Class.create({initialize:function(a){this.context=a;this.matrixStack=[];this.mvMatrix=mat4.identity(mat4.create());
this.camera=new upro.scene.Camera();this.inverseCameraPos=vec3.negate(this.camera.position,vec3.create());this.rotationBuffer=this.getCameraRotationBuffer();
this.bodies=[];this.setupCanvas();this.setupGL();this.setupProjectionMatrix();this.context.getFrame().addEventListener("resize",this.onResize.bind(this),false);
this.animId=null;this.animCallback=this.render.bind(this);this.lastRenderTick=upro.sys.Time.tickMSec();this.render(this);
},pixelToReal:function(c,b){var a={x:(c/(this.canvas.width/2))-1,y:-((b/(this.canvas.height/2))-1)};return a;},addRenderObject:function(a){this.bodies.push(a);
},project:function(b){var c=quat4.create();var a=null;c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=1;mat4.multiplyVec4(this.mvMatrix,c);
mat4.multiplyVec4(this.pMatrix,c);if(c[3]>0){c[0]/=c[3];c[1]/=c[3];c[2]/=c[3];a={};a.x=0+this.canvas.width*(c[0]+1)*0.5;a.y=0+this.canvas.height*(-c[1]+1)*0.5;
a.x=a.x/this.canvas.width*2-1;a.y=a.y/this.canvas.height*-2+1;}return a;},pickAt:function(d){var b=null,c=null,e,a;for(e=0;
e<this.bodies.length;e++){a=this.bodies[e];c=a.pick(d);if((c!=null)&&((b==null)||(c.getDistance()<b.getDistance()))){b=c;
}}return b;},getCameraRotationBuffer:function(){return new upro.scene.RotationBuffer(this,this.camera.rotation);},pushMatrix:function(){this.matrixStack.push(mat4.create(this.mvMatrix));
},popMatrix:function(){if(this.matrixStack.length==0){throw"matrixStack is empty!";}this.mvMatrix=this.matrixStack.pop();
},render:function(){this.animId=window.requestAnimFrame(this.animCallback,this.canvas);var a=upro.sys.Time.tickMSec();var b=a-this.lastRenderTick;
this.lastRender=a;this.draw(b);},draw:function(a){var b=this.camera.isOrientationModified();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT);
mat4.identity(this.mvMatrix);vec3.negate(this.camera.position,this.inverseCameraPos);this.rotationBuffer.rotateVector(this.inverseCameraPos);
mat4.translate(this.mvMatrix,this.inverseCameraPos);this.bodies.each(function(c){if(b){c.setOrientationModified(true);}c.render(a);
c.setOrientationModified(false);},this);this.camera.setOrientationModified(false);},onResize:function(){this.resizeCanvas();
this.setupProjectionMatrix();this.camera.setOrientationModified(true);},resizeCanvas:function(){this.canvas.width=this.context.getFrame().innerWidth,this.canvas.height=this.context.getFrame().innerHeight;
},setupProjectionMatrix:function(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height);this.pMatrix=mat4.create();
mat4.perspective(45,this.canvas.width/this.canvas.height,0.1,1000,this.pMatrix);},setupCanvas:function(){var a=$(this.context.getHolderName());
this.canvas=a;a.style.backgroundColor="gray";this.resizeCanvas();},setupGL:function(){var a=this.canvas.getContext("experimental-webgl");
this.gl=a;a.clearColor(0,0,0,1);a.enable(a.CULL_FACE);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);},loadShaderProgram:function(a,c){var d=upro.scene.ShaderProgram.compileAndLink(this.gl,c);
var b=null;if(d!=null){b=new a(this.gl,d);}return b;}});upro.scene.SceneSystem.SUPPORTED=!!window.WebGLRenderingContext;upro.scene.ShaderProgram=Class.create({initialize:function(b,a){this.gl=b;
this.handle=a;this.mvMatrixUniform=this.gl.getUniformLocation(this.handle,"uMVMatrix");this.pMatrixUniform=this.gl.getUniformLocation(this.handle,"uPMatrix");
this.colorAttribute=b.getAttribLocation(this.handle,"aColor");this.gl.enableVertexAttribArray(this.colorAttribute);this.positionAttribute=b.getAttribLocation(this.handle,"aPosition");
this.gl.enableVertexAttribArray(this.positionAttribute);},getHandle:function(){return this.handle;},use:function(){this.gl.useProgram(this.handle);
}});upro.scene.ShaderProgram.compileAndLink=function(d,a){var e=d.createProgram();for(var c=0;c<a.length;c++){var b=upro.scene.ShaderProgram.compileScript(d,a[c]);
d.attachShader(e,b);}d.linkProgram(e);if(!d.getProgramParameter(e,d.LINK_STATUS)){console.log("Shader Link Problem");e=null;
}return e;};upro.scene.ShaderProgram.compileScript=function(c,a){var b=null;if(a.type==="x-shader/x-fragment"){b=c.createShader(c.FRAGMENT_SHADER);
}else{if(a.type==="x-shader/x-vertex"){b=c.createShader(c.VERTEX_SHADER);}}if(b){c.shaderSource(b,a.text);c.compileShader(b);
if(!c.getShaderParameter(b,c.COMPILE_STATUS)){console.log("Shader Compile Problem in '"+a.id+"': "+c.getShaderInfoLog(b));
b=null;}}return b;};upro.scene.RotationBuffer=Class.create({initialize:function(b,a){this.scene=b;this.rotation=a;this.rotMatrix=mat4.create();
this.axisPitch=vec3.create();},rotateVector:function(b){var d=vec3.set([1,0,0],this.axisPitch);var c=this.rotation;var a=this.rotMatrix;
mat4.identity(a);mat4.rotateY(a,-c[1]);mat4.multiply(this.scene.mvMatrix,a);mat4.inverse(a);mat4.multiplyVec3(a,d);mat4.multiplyVec3(a,b);
mat4.identity(a);mat4.rotate(a,-c[0],d);mat4.multiply(this.scene.mvMatrix,a);mat4.inverse(a);mat4.multiplyVec3(a,b);return b;
}});upro.scene.SceneObject=Class.create({initialize:function(){this.position=vec3.create([0,0,0]);this.rotation=vec3.create([0,0,0]);
this.orientationModified=false;},isOrientationModified:function(){return this.orientationModified;},setOrientationModified:function(a){this.orientationModified=a;
}});upro.scene.Camera=Class.create(upro.scene.SceneObject,{initialize:function($super){$super();}});upro.scene.SceneRenderObject=Class.create(upro.scene.SceneObject,{initialize:function($super){$super();
this.scene=null;this.mvMatrix=mat4.create();this.projectionTrackers={};this.projectionHelperVec=vec3.create();},addToScene:function(a){this.scene=a;
a.addRenderObject(this);},setOrientationModified:function($super,a){$super(a);},addProjectionTracker:function(a){this.projectionTrackers[a.getId()]=a;
},removeProjectionTracker:function(a){delete this.projectionTrackers[a];},resetProjectionTrackers:function(b){var a;for(var c in this.projectionTrackers){a=this.projectionTrackers[c];
a.reset(b);}},updateProjectionTrackers:function(){var b=null;var a=this.isOrientationModified();for(var c in this.projectionTrackers){b=this.projectionTrackers[c];
if(a||!b.isProjectionConfirmed()){vec3.add(b.position,this.position,this.projectionHelperVec);b.setProjectedPosition(this.scene.project(this.projectionHelperVec));
}}},render:function(a){},pick:function(a){}});upro.scene.PickResult=Class.create({initialize:function(b,a,c){this.refObject=b;
this.viewPosition=a;this.distance=c;},getRefObject:function(){return this.refObject;},getViewPosition:function(){return this.viewPosition;
},getDistance:function(){return this.distance;}});upro.scene.GalaxyRenderObject=Class.create(upro.scene.SceneRenderObject,{initialize:function($super,b,a){$super();
this.basicShader=b;this.systemShader=a;this.systems=[];this.systemProjections={};this.systemVertices=[];this.systemColors=[];
this.jumpVertices=[];this.jumpColors=[];this.routeVertices=[];this.routeColors=[];this.routeSegments=[];this.dynamicJumpSegments={};
this.ready=false;this.visible=false;},setOrientationModified:function($super,a){$super(a);if(a){delete this.systemProjections;
this.systemProjections={};}},addSolarSystem:function(c){var d=c.galaxy;var b=d.scale;var a=d.position;this.systemVertices.push((c.position[0]-a[0])/b,(c.position[1]-a[1])/b,(c.position[2]-a[2])/b);
this.systemColors.push(c.security,0,0);this.systems.push(c);},addJumpCorridor:function(d){var b=[1,1,1];if(d.getJumpType()==upro.nav.JumpType.JumpGate){if(d.system1.constellationId==d.system2.constellationId){b=[0,0,1];
}else{if(d.system1.regionId==d.system2.regionId){b=[1,0,0];}else{if(d.system1.galaxy==d.system2.galaxy){b=[1,0,1];}}}this.addEdge(d.system1,d.system2,this.jumpVertices,this.jumpColors,b);
}else{var c=[],a=[];var e=new upro.scene.VertexBufferSegment();var f=this.scene;this.addEdge(d.system1,d.system2,c,a,b);e.create(f.gl);
e.update(f.gl,c,a,0,c.length/3);this.dynamicJumpSegments[d.id]=e;}},addRouteEdge:function(c,b,d){var a=d?[1,1,0,2]:[1,0,0,2];
this.addEdge(c,b,this.routeVertices,this.routeColors,a);this.updateRouteSegments();},clearRoute:function(){this.routeVertices.clear();
this.routeColors.clear();this.updateRouteSegments();},addEdge:function(g,f,k,a,h){var d=g.galaxy;var o=d.scale;var b=d.position;
var m=vec3.scale(vec3.subtract(g.position,b,vec3.create()),1/o);var l=vec3.scale(vec3.subtract(f.position,b,vec3.create()),1/o);
var e=vec3.subtract(l,m,vec3.create());var c=vec3.length(e);var j=c/5,n=1;var i=(h.length>3)?h[3]:1;vec3.normalize(e);if(j>n){j=n;
}vec3.scale(e,j);k.push(m[0],m[1],m[2]);a.push(h[0],h[1],h[2],i*0);vec3.add(m,e);k.push(m[0],m[1],m[2]);a.push(h[0],h[1],h[2],i*0.3);
k.push(l[0],l[1],l[2]);a.push(h[0],h[1],h[2],i*0);vec3.subtract(l,e);k.push(l[0],l[1],l[2]);a.push(h[0],h[1],h[2],i*0.3);
k.push(m[0],m[1],m[2]);a.push(h[0],h[1],h[2],i*0.3);k.push(l[0],l[1],l[2]);a.push(h[0],h[1],h[2],i*0.3);},addToScene:function($super,e){this.systemVertexBuffer=e.gl.createBuffer();
e.gl.bindBuffer(e.gl.ARRAY_BUFFER,this.systemVertexBuffer);e.gl.bufferData(e.gl.ARRAY_BUFFER,new Float32Array(this.systemVertices),e.gl.STATIC_DRAW);
this.systemColorBuffer=e.gl.createBuffer();e.gl.bindBuffer(e.gl.ARRAY_BUFFER,this.systemColorBuffer);e.gl.bufferData(e.gl.ARRAY_BUFFER,new Float32Array(this.systemColors),e.gl.STATIC_DRAW);
this.jumpSegments=[];var b=this.jumpVertices.length/3,a=1024*4,c=b,g=0;while(c>0){var f=(a>c)?c:a;var d=new upro.scene.VertexBufferSegment();
d.create(e.gl);d.update(e.gl,this.jumpVertices,this.jumpColors,g,g+f);this.jumpSegments.push(d);c-=f;g+=f;}var d=new upro.scene.VertexBufferSegment();
d.create(e.gl);this.routeSegments.push(d);$super(e);this.updateRouteSegments();this.loadTexture();},updateRouteSegments:function(){if(this.routeSegments.length>0){var b=this.scene;
var a=this.routeSegments[0];a.update(b.gl,this.routeVertices,this.routeColors,0,this.routeVertices.length/3);}},loadTexture:function(){var c=this.scene;
var d=c.gl;var a=d.createTexture();var b=this;a.image=new Image();a.image.onload=function(){d.bindTexture(d.TEXTURE_2D,a);
d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a.image);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR_MIPMAP_LINEAR);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.generateMipmap(d.TEXTURE_2D);d.uniform1i(d.getUniformLocation(b.systemShader.getHandle(),"texture"),0);
b.ready=true;};a.image.src="data:image/png;base64,"+"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8"+"YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAACPSURBVDhPxVNBCgAhCMzYZ9Wtj/WvbvWv3UYQ2t2soEOC"+"IDiOoyLd1YxipRTOOOc0iKERARFx4aCHsSr1YkIlEPngaeMv728EAaeUXtgQQncf2yNcbRt0l84xRnUL"+"7VUsirBtuPd+ujpgBI/a7REs5ODO8JzzVAEwgkft+StATteqVPwIO2LNzv/CUMHKOz+xL4uwLi0r5QAA"+"AABJRU5ErkJggg==";
},setVisible:function(a){this.visible=a;if(!this.visible){this.resetProjectionTrackers(true);}},render:function(b){if(this.ready&&this.visible){var e=this.scene;
e.pushMatrix();mat4.translate(e.mvMatrix,this.position);var d=this.systemShader;d.use();e.gl.bindBuffer(e.gl.ARRAY_BUFFER,this.systemVertexBuffer);
e.gl.vertexAttribPointer(d.positionAttribute,3,e.gl.FLOAT,false,0,0);e.gl.bindBuffer(e.gl.ARRAY_BUFFER,this.systemColorBuffer);
e.gl.vertexAttribPointer(d.colorAttribute,3,e.gl.FLOAT,false,0,0);e.gl.uniformMatrix4fv(d.mvMatrixUniform,false,e.mvMatrix);
e.gl.uniformMatrix4fv(d.pMatrixUniform,false,e.pMatrix);e.gl.drawArrays(e.gl.POINTS,0,this.systemVertices.length/3);e.gl.flush();
var d=this.basicShader;var a,c;d.use();e.gl.uniformMatrix4fv(d.mvMatrixUniform,false,e.mvMatrix);e.gl.uniformMatrix4fv(d.pMatrixUniform,false,e.pMatrix);
for(a=0;a<this.jumpSegments.length;a++){c=this.jumpSegments[a];c.select(e.gl,d);e.gl.drawArrays(e.gl.LINES,0,c.size);e.gl.flush();
}for(dynId in this.dynamicJumpSegments){c=this.dynamicJumpSegments[dynId];c.select(e.gl,d);e.gl.drawArrays(e.gl.LINES,0,c.size);
e.gl.flush();}for(a=0;a<this.routeSegments.length;a++){c=this.routeSegments[a];if(c.size>0){c.select(e.gl,d);e.gl.drawArrays(e.gl.LINES,0,c.size);
e.gl.flush();}}e.popMatrix();this.updateProjectionTrackers();}},pick:function(a){var k=null;if(this.visible){var d=vec3.create();
var b=this.systems;var g;var e;for(var c=0;((k==null)||(k.getDistance()>0.0001))&&(c<b.length);c++){g=b[c];e=this.projectSolarSystem(g,d);
if(e!=null){var j=e.x-a.x;var h=e.y-a.y;var f=Math.sqrt((j*j)+(h*h));if((f<0.05)&&((k==null)||(f<k.getDistance()))){k=new upro.scene.PickResult(g,e,f);
}}}}return k;},projectSolarSystem:function(e,b){var d=this.systemProjections[e.id];var a=null;if(!d||(d.confirmed<5)){vec3.subtract(e.position,e.galaxy.position,b);
vec3.scale(b,1/e.galaxy.scale);vec3.add(b,this.position);var c=this.scene.project(b);if(!d){d={"result":c,"confirmed":1};
this.systemProjections[e.id]=d;}if((d.result==null)&&(c==null)){d.confirmed++;}else{if((d.result==null)||(c==null)||(c.x!=d.result.x)||(c.y!=d.result.y)){d.result=c;
d.confirmed=1;}else{d.confirmed++;}}a=c;}else{a=d.result;}return a;}});upro.scene.VertexBufferSegment=Class.create({initialize:function(){this.vertexBuffer=null;
this.colorBuffer=null;},create:function(a){this.destroy(a);this.vertexBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();
},update:function(c,b,a,e,d){c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,new Float32Array(b.slice(e*3,d*3)),c.STATIC_DRAW);
c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.bufferData(c.ARRAY_BUFFER,new Float32Array(a.slice(e*4,d*4)),c.STATIC_DRAW);
this.size=d-e;},destroy:function(a){if(this.vertexBuffer){a.deleteBuffer(this.vertexBuffer);this.vertexBuffer=null;}if(this.colorBuffer){a.deleteBuffer(this.colorBuffer);
this.colorBuffer=null;}},select:function(b,a){b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(a.positionAttribute,3,b.FLOAT,false,0,0);
b.bindBuffer(b.ARRAY_BUFFER,this.colorBuffer);b.vertexAttribPointer(a.colorAttribute,4,b.FLOAT,false,0,0);}});upro.scene.TrackedProjection=Class.create({initialize:function(c,a,b){this.id=c;
this.position=a;this.callback=b;this.projectedPositon=null;this.confirmed=0;},getId:function(){return this.id;},getPosition:function(){return this.position;
},getProjectedPosition:function(){return this.projectedPosition;},isProjectionConfirmed:function(){return this.confirmed==upro.scene.TrackedProjection.CONFIRMATION_LIMIT;
},reset:function(b){var a=this.isProjectionConfirmed();this.projectedPosition=null;this.confirmed=0;if(a&&b){this.callback(this);
}},setProjectedPosition:function(a){var b=this.isProjectionConfirmed();if(!this.projectedPosition&&!a){if(!b){this.onConfirmation();
}}else{if(!this.projectedPosition||!a||(this.projectedPosition.x!=a.x)||(this.projectedPosition.y!=a.y)){this.projectedPosition=!a?null:{"x":a.x,"y":a.y};
this.confirmed=1;this.callback(this,false);}else{if(!b){this.onConfirmation();}}}},onConfirmation:function(){this.confirmed++;
var a=this.isProjectionConfirmed();this.callback(this,a);}});upro.scene.TrackedProjection.CONFIRMATION_LIMIT=5;upro.hud={};
upro.hud.CommandAdapter=Class.create({initialize:function(){},isCommandActive:function(){return false;},isCommandPossible:function(){return true;
},getLabel:function(){return"";},registerListener:function(a){},unregisterListener:function(a){},execute:function(){}});upro.hud.SimpleCommandAdapter=Class.create(upro.hud.CommandAdapter,{initialize:function(b,a){this.callback=b;
this.listeners=[];this.active=false;this.possible=true;this.label=a||"";},setActive:function(a){var b=!!a;if(b!=this.active){this.active=b;
this.notifyListeners();}},isCommandActive:function(){return this.active;},setPossible:function(a){var b=!!a;if(b!=this.possible){this.possible=b;
this.notifyListeners();}},isCommandPossible:function(){return this.possible;},getLabel:function(){return this.label;},setLabel:function(a){if(a!=this.label){this.label=a;
this.notifyListeners();}},registerListener:function(b){var a=this.listeners.indexOf(b);if(a<0){this.listeners.push(b);}},unregisterListener:function(b){var a=this.listeners.indexOf(b);
if(a>=0){this.listeners.splice(a,1);}},execute:function(){this.callback();},notifyListeners:function(){var a=this.listeners.slice(0),c;
for(var b=0;b<a.length;b++){c=a[b];if(this.listeners.indexOf(c)>=0){c();}}}});upro.hud.SubMenuCommandAdapter=Class.create(upro.hud.CommandAdapter,{initialize:function(b,c,a){this.parent=b;
this.label=a;this.sub=new upro.hud.RadialMenu(c,this.onCancelled.bind(this));},getLabel:function(){return this.label;},getSubMenu:function(){return this.sub;
},execute:function(){this.context=this.parent.context;this.parent.hide();this.sub.show(this.context);},onCancelled:function(){var a=this.context;
this.context=null;this.parent.show(a);}});upro.hud.HudSystem=Class.create({initialize:function(c,e,a){var b=ScaleRaphael(c.getHolderName(),e?e:screen.width,a?a:screen.height);
this.context=c;this.paper=b;this.context.getFrame().addEventListener("resize",this.onResize.bind(this),false);this.onResize();
this.onResize();this.activeContextMenu=null;this.debugMessageTexts=[];this.debugMessageElements=[];for(var d=0;d<10;d++){var f=b.text(10,10+(20*(d+1)),"");
f.attr({"fill":"#FFF","font-size":20,"text-anchor":"start"});this.debugMessageElements.push(f);this.debugMessageTexts.push("");
}this.keyDispatcher=new upro.sys.KeyboardDispatcher();this.keyFocus=null;},getKeyboardHandler:function(){return this.keyDispatcher;
},pixelToReal:function(c,b){var a={x:(c/(this.paper.width/2))-1,y:-((b/(this.paper.height/2))-1)};return a;},realToViewCoordinates:function(h){var e=(h.x+1)*(this.paper.width/2),c=(-h.y+1)*(this.paper.height/2);
var a=this.paper.w/this.paper.width;var f=this.paper.h/this.paper.height;if(a>f){var g=this.paper.h/a;correctedX=e*a;c-=((this.paper.height/2)-(g/2));
correctedY=(c/g)*this.paper.h;}else{var d=this.paper.w/f;e-=((this.paper.width/2)-(d/2));correctedX=(e/d)*this.paper.w;correctedY=c*f;
}var b={x:correctedX,y:correctedY};return b;},getActiveContextMenu:function(){return this.activeContextMenu;},setActiveContextMenu:function(b){var a=this.activeContextMenu;
this.activeContextMenu=null;if(a){a.cancel();}this.activeContextMenu=b;},setKeyFocus:function(a){if(this.keyFocus!=a){if(this.keyFocus!=null){this.keyDispatcher.removeHandler(this.keyFocus);
this.keyFocus.onFocusLost();}this.keyFocus=a;if(this.keyFocus!=null){this.keyDispatcher.addHandler(this.keyFocus);}}},removeKeyFocus:function(a){if(this.keyFocus==a){this.setKeyFocus(null);
}},onResize:function(){var a=this.context.getFrame();this.paper.changeSize(a.innerWidth,a.innerHeight,true,false);},debugMessage:function(c){var a;
for(var b=this.debugMessageTexts.length-1;b>0;b--){this.debugMessageTexts[b]=a=this.debugMessageTexts[b-1];this.debugMessageElements[b].attr("text",a);
}this.debugMessageTexts[0]=(new Date().toISOString())+" - "+c;this.debugMessageElements[0].attr("text",this.debugMessageTexts[0]);
},createHexagon:function(c){var a=upro.hud.HudSystem.HexagonDiagFactor;var d="M0,-"+(2*c)+"L"+(a*c)+",-"+c+"V"+c+"L0,"+(2*c)+"L-"+(a*c)+","+c+"V-"+c+"Z";
var b=this.paper.path(d);b.attr({fill:"#423f22","fill-opacity":0.5,stroke:"#741","stroke-width":2,"stroke-opacity":0.8});
return b;}});upro.hud.HudSystem.HexagonDiagFactor=1.732050808;upro.hud.Button=Class.create({initialize:function(b,h,e,f,g,i){this.hudSystem=b;
this.clickedCallback=null;this.enabled=(g!==undefined)?g:true;this.active=(i!==undefined)?i:false;this.wholeSet=this.hudSystem.paper.set();
this.createBase();this.wholeSet.translate(h,e);this.icon=f;if(f){var d=f.getBBox();var a=(d.height>d.width)?d.height:d.width;
f.hide();f.translate(h-((d.width-d.x)/2),e-((d.height-d.y)/2));f.scale((upro.hud.Button.Scale*2)/a,(upro.hud.Button.Scale*2)/a);
f.toFront();f.attr(upro.hud.Button.States.Enabled[this.enabled].IconAttr);this.wholeSet.push(f);}var c=new upro.sys.PointerHandler();
c.onUp=this.onPointerUp.bind(this);this.wholeSet.forEach(function(j){new upro.sys.MouseListener(c,Element.extend(j[0]));return true;
});this.wholeSet.show();},destroy:function(){var a=this.wholeSet;this.clickedCallback=null;a.toBack();a.animate({"fill-opacity":0.2,"stroke-opacity":0.3},200,">",function(){a.remove();
});},setEnabled:function(b){var c=!!b;if((c!=this.enabled)&&this.icon){var a=upro.hud.Button.States.Enabled[c].IconAttr;this.enabled=c;
this.icon.animate(a,50);}},isEnabled:function(){return this.enabled;},setActive:function(b){var c=!!b;if(c!=this.active){var a=upro.hud.Button.States.Active[c].BaseAttr;
this.active=c;this.base.animate(a,50);}},isActive:function(){return this.active;},setLabel:function(a){this.wholeSet.forEach(function(b){b.attr("title",a);
return true;});},createBase:function(){var a=this.hudSystem.createHexagon(upro.hud.Button.Scale).hide();a.attr({fill:"#423f22",stroke:"#741","stroke-width":2});
a.attr(upro.hud.Button.States.Active[this.active].BaseAttr);this.base=a;this.wholeSet.push(a);},onPointerUp:function(b,a,c){if(c[0]&&this.clickedCallback&&this.enabled){this.clickedCallback();
}}});upro.hud.Button.Scale=10;upro.hud.Button.getShiftHalf=function(b){var a={x:(b/2)+(upro.hud.Button.Scale*2),y:(b*1)+(upro.hud.Button.Scale*2*upro.hud.HudSystem.HexagonDiagFactor)};
return a;};upro.hud.Button.getShiftFull=function(b){var a={x:(b*1)+(upro.hud.Button.Scale*4),y:0};return a;};upro.hud.Button.States={};
upro.hud.Button.States.Enabled={};upro.hud.Button.States.Enabled[true]={};upro.hud.Button.States.Enabled[true].IconAttr={"fill-opacity":1,"stroke-opacity":1};
upro.hud.Button.States.Enabled[false]={};upro.hud.Button.States.Enabled[false].IconAttr={"fill-opacity":0.2,"stroke-opacity":0.3};
upro.hud.Button.States.Active={};upro.hud.Button.States.Active[true]={};upro.hud.Button.States.Active[true].BaseAttr={"fill-opacity":0.9,"stroke-opacity":1};
upro.hud.Button.States.Active[false]={};upro.hud.Button.States.Active[false].BaseAttr={"fill-opacity":0.5,"stroke-opacity":0.8};
upro.hud.Button.getOffset=[];upro.hud.Button.getOffset.push(function(b){var a=upro.hud.Button.getShiftHalf(b);return{x:a.x,y:-a.y};
});upro.hud.Button.getOffset.push(function(b){var a=upro.hud.Button.getShiftFull(b);return{x:a.x,y:a.y};});upro.hud.Button.getOffset.push(function(b){var a=upro.hud.Button.getShiftHalf(b);
return{x:a.x,y:a.y};});upro.hud.Button.getOffset.push(function(b){var a=upro.hud.Button.getShiftHalf(b);return{x:-a.x,y:a.y};
});upro.hud.Button.getOffset.push(function(b){var a=upro.hud.Button.getShiftFull(b);return{x:-a.x,y:a.y};});upro.hud.Button.getOffset.push(function(b){var a=upro.hud.Button.getShiftHalf(b);
return{x:-a.x,y:-a.y};});upro.hud.RadialMenuContext=Class.create({initialize:function(b,c,a){this.mainMenu=b;this.hudSystem=c;
this.realPos=a;this.activeMenu=null;},getRealPos:function(){return this.realPos;},getHudSystem:function(){return this.hudSystem;
},show:function(){this.mainMenu.show(this);},cancel:function(){while(this.activeMenu){this.activeMenu.cancel();}},setActiveMenu:function(a){this.activeMenu=a;
}});upro.hud.RadialMenu=Class.create({initialize:function(b,a){this.iconCreator=b;this.cancelEntry=new upro.hud.MenuEntry(b,new upro.hud.SimpleCommandAdapter(this.onCancel.bind(this,a)));
this.commands={};this.context=null;},setCommand:function(b,c,a){this.commands[b]=new upro.hud.MenuEntry(c,a);},setSubMenu:function(c,d,b){var a=new upro.hud.SubMenuCommandAdapter(this,d,b);
this.commands[c]=new upro.hud.MenuEntry(d,a);return a.getSubMenu();},show:function(b){var c=b.getHudSystem();var e=c.realToViewCoordinates(b.getRealPos());
var d=null;this.hide();this.context=b;this.context.setActiveMenu(this);this.cancelEntry.show(c,e.x,e.y);for(var a in this.commands){d=upro.hud.Button.getOffset[a](upro.hud.RadialMenu.PADDING);
this.commands[a].show(c,e.x+d.x,e.y+d.y);}},cancel:function(){if(this.context){this.cancelEntry.commandAdapter.execute();
}},onCancel:function(a){this.hide();if(a){a();}},hide:function(){if(this.context){this.context.setActiveMenu(null);this.context=null;
}this.cancelEntry.hide();for(var a in this.commands){this.commands[a].hide();}}});upro.hud.RadialMenu.PADDING=2;upro.hud.MenuEntry=Class.create({initialize:function(b,a){this.iconCreator=b;
this.commandAdapter=a;this.commandAdapterListener=this.updateButtonOnCommand.bind(this);this.button=null;},show:function(c,a,d){var b=null;
this.hide();if(this.iconCreator){b=this.iconCreator();}this.button=new upro.hud.Button(c,a,d,b,this.commandAdapter.isCommandPossible(),this.commandAdapter.isCommandActive());
this.button.setLabel(this.commandAdapter.getLabel());this.button.clickedCallback=this.onClicked.bind(this);this.commandAdapter.registerListener(this.commandAdapterListener);
},hide:function(){if(this.button){this.commandAdapter.unregisterListener(this.commandAdapterListener);this.button.destroy();
this.button=null;}},onClicked:function(){this.commandAdapter.execute();},updateButtonOnCommand:function(){this.button.setEnabled(this.commandAdapter.isCommandPossible());
this.button.setActive(this.commandAdapter.isCommandActive());this.button.setLabel(this.commandAdapter.getLabel());}});upro.hud.Label=Class.create({initialize:function(d,b,e,c,a){this.hudSystem=d;
this.x=b;this.y=e;this.width=c;this.height=a;this.icon=null;this.text=this.hudSystem.paper.text(this.x+this.height,e+this.height/2,"");
this.text.attr({"text-anchor":"start","clip-rect":""+(b+a)+","+e+","+(c-a-3)+","+a,"font-size":a-4,"fill":"#FFFFFF"});},destroy:function(){this.destroyIcon();
this.text.remove();},setElementsBefore:function(a){this.text.insertBefore(a);if(this.icon){this.icon.insertBefore(this.text);
}},setText:function(a){this.text.attr({"text":a});},setIcon:function(a){this.destroyIcon();if(a){var b=a.getBBox();var c=(b.height>b.width)?b.height:b.width;
a.translate(this.x+(this.height/2)-((b.width-b.x)/2),this.y+(this.height/2)-((b.height-b.y)/2));if(c>0){a.scale(this.height/c,this.height/c);
}}},destroyIcon:function(){if(this.icon){this.icon.remove();this.icon=null;}}});upro.hud.Table=Class.create({initialize:function(c,h,g,j,b){var e;
this.hudSystem=c;this.x=h;this.y=g;this.maxRows=j;this.colData=b;this.viewIndex=0;this.model=new upro.hud.TableModel(this);
this.keyHandler=new upro.hud.TableModelKeyboardHandler(this.model);this.width=0;for(e=0;e<b.length;e++){this.width+=b[e].width;
}this.background=this.hudSystem.paper.rect(h,g,this.width,upro.hud.Table.ROW_HEIGHT);this.background.attr({"fill":"#423f22","fill-opacity":0.5,"stroke":"#000000","stroke-opacity":0,"stroke-width":0});
this.editground=this.hudSystem.paper.rect(h,g,0,upro.hud.Table.ROW_HEIGHT).hide();this.editground.attr({"stroke-width":0,"stroke-opacity":0,"fill":"#FFFFFF","fill-opacity":0.2});
this.foreground=this.hudSystem.paper.rect(h,g,this.width,upro.hud.Table.ROW_HEIGHT);this.foreground.attr({"fill":"#000000","fill-opacity":0.1,"stroke":"#741","stroke-opacity":0.8,"stroke-width":1});
var f=new upro.sys.PointerHandler();var k=this;var d=Element.extend(this.foreground[0]);f.onRotate=function(l,i,m){if(m[1]!=0){k.setViewIndex(k.viewIndex+(m[1]/-120));
}};f.onMove=this.onPointerMove.bind(this);f.onDown=this.onPointerDown.bind(this);new upro.sys.MouseListener(f,d);var a=null;
new upro.sys.KeyboardListener(a,d);this.viewRows=[];},destroy:function(){this.hudSystem.removeKeyFocus(this.keyHandler);this.cleanViewRows(0);
this.background.remove();this.foreground.remove();},getModel:function(){return this.model;},setModel:function(a){this.model=a;
this.keyHandler.setModel(a);this.onModelChanged(0);},onModelChanged:function(d){var c=this.model.getEditCellIndex();if(c>=0){this.hudSystem.setKeyFocus(this.keyHandler);
if(c<this.viewIndex){this.viewIndex=c;}else{if(c>=(this.viewIndex+this.maxRows)){this.viewIndex+=c-(this.viewIndex+this.maxRows)+1;
}}}else{this.hudSystem.removeKeyFocus(this.keyHandler);}if((d>=this.viewIndex)&&(d<(this.viewIndex+this.maxRows))){var a=this.model.getRowCount(),b=a;
if(b>this.maxRows){b=this.maxRows;}this.cleanViewRows(b);if(b==0){b=1;}this.background.attr({"height":b*upro.hud.Table.ROW_HEIGHT});
this.foreground.attr({"height":b*upro.hud.Table.ROW_HEIGHT});if(this.viewIndex>(a-this.maxRows)){d=this.viewIndex=(a-this.maxRows);
if(d<0){d=this.viewIndex=0;}}this.updateCells(d);}},updateCells:function(j){var b=0,a,e,c,k,h,g,d=this.model.getRowCount()-this.viewIndex,f=false;
if(d>this.maxRows){d=this.maxRows;}g=this.y+(upro.hud.Table.ROW_HEIGHT*b);while(b<d){if(b>=this.viewRows.length){e=[];this.viewRows.push(e);
}else{e=this.viewRows[b];}h=this.x;for(c=0;c<this.colData.length;c++){a=this.colData[c];if(c<e.length){k=e[c];}else{k=new upro.hud.Label(this.hudSystem,h,g,a.width,upro.hud.Table.ROW_HEIGHT);
k.setElementsBefore(this.foreground);e.push(k);}this.model.updateCell(this.viewIndex+b,a.name,k);if(this.model.isEditCell(this.viewIndex+b,a.name)){this.editground.attr({"x":h,"y":g,"width":a.width});
this.editground.show();f=true;}h+=a.width;}g+=upro.hud.Table.ROW_HEIGHT;b++;}if(!f){this.editground.hide();}},cleanViewRows:function(d){var a=null,c,b;
for(c=this.viewRows.length-1;c>=d;c--){a=this.viewRows[c];this.viewRows.pop();for(b=0;b<a.length;b++){a[b].destroy();}}},getViewIndex:function(){return this.viewIndex;
},setViewIndex:function(b){var a=this.model.getRowCount();this.viewIndex=b;if(this.viewIndex>(a-this.maxRows)){this.viewIndex=a-this.maxRows;
}if(this.viewIndex<0){this.viewIndex=0;}this.updateCells(this.viewIndex);},onPointerMove:function(b,a){},onPointerDown:function(f,h){var j=this.hudSystem.pixelToReal(f.x,f.y);
var c=this.hudSystem.realToViewCoordinates(j);var d=Math.floor((c.y-this.y)/upro.hud.Table.ROW_HEIGHT);var b=null,g=this.x;
for(var e=0;(b==null)&&(e<this.colData.length);e++){var a=this.colData[e];if((c.x>=g)&&(c.x<(g+a.width))){b=a.name;}g+=a.width;
}this.model.setEditCell(this.viewIndex+d,b);}});upro.hud.Table.ROW_HEIGHT=20;upro.hud.TableModel=Class.create({initialize:function(a){},getRowCount:function(){return 0;
},updateCell:function(b,c,a){},getEditCellIndex:function(){return -1;},setEditCell:function(a,b){},isEditCell:function(a,b){return false;
},setEditCellPrevRow:function(){},setEditCellNextRow:function(){},editCellRemoveCharacter:function(){},editCellAddCharacter:function(a){}});
upro.hud.TableModel.NULL=new upro.hud.TableModel();upro.hud.SimpleTableModel=Class.create({initialize:function(a){this.table=a;
this.rows=[];this.editIndex=-1;this.editColumnKey=null;},getRowCount:function(){return this.rows.length;},addRow:function(a){this.rows.push(a);
this.table.onModelChanged(this.rows.length-1);},removeRow:function(a){if((a>=0)&&(a<this.rows.length)){this.rows.splice(a,1);
this.table.onModelChanged(a);}},updateCell:function(b,c,a){a.setText(this.rows[b][c]);},getEditCellIndex:function(){return this.editIndex;
},setEditCell:function(a,c){if((this.editIndex!=a)||(this.editColumnKey!=c)){var b=this.editIndex;this.editIndex=-1;this.editColumnKey=null;
if(b>=0){this.table.onModelChanged(b);}this.editIndex=a;this.editColumnKey=c;if(this.editIndex>=0){this.table.onModelChanged(this.editIndex);
}}},isEditCell:function(a,b){return(this.editIndex==a)&&(this.editColumnKey==b);},setEditCellPrevRow:function(){if(this.editIndex>0){this.editIndex--;
this.table.onModelChanged(this.editIndex);}},setEditCellNextRow:function(){if(this.editIndex<(this.rows.length-1)){this.editIndex++;
this.table.onModelChanged(this.editIndex-1);}}});upro.hud.TableModelKeyboardHandler=Class.create(upro.sys.KeyboardHandler,{initialize:function(a){this.model=a;
},setModel:function(a){this.model=a;},onFocusLost:function(){this.model.setEditCell(-1,null);},onDown:function(a){if(a==Event.KEY_RETURN){this.model.setEditCell(-1,null);
}else{if(a==Event.KEY_UP){this.model.setEditCellPrevRow();}else{if(a==Event.KEY_DOWN){this.model.setEditCellNextRow();}else{if(a==Event.KEY_BACKSPACE){this.model.editCellRemoveCharacter();
}}}}return true;},onUp:function(a){return true;},onPress:function(a){this.model.editCellAddCharacter(a);return true;}});upro.data={};
upro.data.InfoId=Class.create({initialize:function(a,b){this.type=a;this.id=b?b:upro.Uuid.newV4();},toString:function(){return""+this.type+"["+this.id+"]";
},getType:function(){return this.type;},getId:function(){return this.id;}});upro.data.InfoId.System=new upro.data.InfoId("System",upro.Uuid.Empty);
upro.data.InfoTypeFactory=Class.create({initialize:function(){this.factoryByType={};},register:function(b,a){this.factoryByType[b]=a;
},create:function(c,b){var a=this.factoryByType[c.getType()];var d=null;if(a!==undefined){d=a(c,b);}return d;}});upro.data.InfoTypeFactory.Instance=new upro.data.InfoTypeFactory();
upro.data.DataStoreInfo=Class.create({initialize:function(a){this.infoId=a;},toString:function(){return"DataStoreInfo:"+this.infoId.toString();
},getInfoId:function(){return this.infoId;},decodeBooleanMember:function(b,a){var d=b[a];var c=false;if(d!==undefined){this[a]=(""+d)!="0";
c=true;}return c;},decodeNumberMember:function(b,a){var d=b[a];var c=false;if(d!==undefined){this[a]=new Number(d);c=true;
}return c;},decodeStringMember:function(b,a){var d=b[a];var c=false;if(d!==undefined){this[a]=(""+d);c=true;}return c;},onDeleted:function(){},onUpdated:function(a){},onReferenceAdded:function(a){},onReferenceRemoved:function(a){}});
upro.data.DataStore=Class.create({initialize:function(){},createWriteTransaction:function(){return null;}});upro.data.DataStoreModifier=Class.create({initialize:function(){},createInfo:function(c,b,a){return false;
},updateInfo:function(b,a){return false;},deleteInfo:function(a){return false;},addReference:function(b,c,a){return false;
},removeReference:function(a,b){return false;}});upro.data.DataStoreWriteTransaction=Class.create({initialize:function(){},commit:function(){},createInfo:function(c,b,a){},updateInfo:function(b,a){},deleteInfo:function(a){},addReference:function(b,c,a){},removeReference:function(a,b){}});
upro.data.MemoryDataStore=Class.create(upro.data.DataStore,{initialize:function(){this.store={};this.pendingActions=[];this.initializeStore();
},createWriteTransaction:function(){return new upro.data.MemoryDataStoreWriteTransaction(this);},getEntry:function(b){var c=this.store[b.getType()];
var a=undefined;if(c!=undefined){a=c[b.getId()];}return a;},getReference:function(c,d){var b=this.getEntry(c);var a=undefined;
if(b!==undefined){a=b.getReference(d);}return a;},containsEntry:function(a){return this.getEntry(a)!=undefined;},createEntry:function(b){var c=this.store[b.getType()];
var a=new upro.data.MemoryDataStoreEntry(b,this);if(c===undefined){this.store[b.getType()]=c={};}c[b.getId()]=a;return a;
},deleteEntry:function(e){var d=this.getEntry(e);if(d!==undefined){delete this.store[e.getType()][e.getId()];for(var b in d.children){var f=d.children[b];
this.setReference(f,d,undefined);}for(var a in d.references){var c=d.references[a].entry;this.setReference(d,c,undefined);
}d.destruct();}},setReference:function(d,b,a){var c=b.children[d.infoId.toString()];if(a===undefined){if(c){delete b.children[d.infoId.toString()];
delete d.references[b.infoId.toString()];b.notifyReferenceRemoved(d);d.notifyReferenceRemoved(b);}}else{b.children[d.infoId.toString()]=d;
d.references[b.infoId.toString()]={"entry":b,"owning":a};if(!c){d.notifyReferenceAdded(b);b.notifyReferenceAdded(d);}}if(!d.isOwned()){this.deleteEntry(d.infoId);
}},initializeStore:function(){},commit:function(a){this.pendingActions.push(a);this.deferProcessPendingActions();},deferProcessPendingActions:function(){this.processPendingActions.bind(this).defer();
},processPendingActions:function(){if(this.pendingActions.length>0){var a=this.pendingActions.pop();this.processActions(a);
}},processActions:function(c){if(this.areActionsOk(c)){var d=new upro.data.MemoryDataStoreModifyExecutor(this);for(var a=0;
a<c.length;a++){var b=c[a];b(d);}}},areActionsOk:function(e){var a=new upro.data.MemoryDataStoreModifyTester(this);var c=true;
for(var b=0;c&&(b<e.length);b++){var d=e[b];c=d(a);}return c;}});upro.data.MemoryDataStoreEntry=Class.create({initialize:function(b,a){this.infoId=b;
this.properties={};this.references={};this.children={};this.boundObject=upro.data.InfoTypeFactory.Instance.create(this.infoId,a);
},destruct:function(){if(this.boundObject){this.boundObject.onDeleted();this.boundObject=null;}},toString:function(){return"DataStoreEntry:"+this.infoId.toString();
},isOwned:function(){var a=false;for(var b in this.references){if(this.references[b].owning){a=true;}}return a;},getReference:function(c){var b=this.references[c];
var a=undefined;if(b!==undefined){a=b.owning;}return a;},setProperties:function(b){for(var a in b){var c=b[a];this.properties[a]=c;
}if(this.boundObject){this.boundObject.onUpdated(b);}},notifyReferenceAdded:function(a){if(this.boundObject&&a.boundObject){this.boundObject.onReferenceAdded(a.boundObject);
}},notifyReferenceRemoved:function(a){if(this.boundObject&&a.boundObject){this.boundObject.onReferenceRemoved(a.boundObject);
}}});upro.data.MemoryDataStoreWriteTransaction=Class.create(upro.data.DataStoreWriteTransaction,{initialize:function(a){this.dataStore=a;
this.actions=[];},commit:function(){var a=this.actions;this.actions=[];this.dataStore.commit(a);},createInfo:function(c,b,a){this.actions.push(function(d){return d.createInfo(c,b,a);
});},updateInfo:function(b,a){this.actions.push(function(c){return c.updateInfo(b,a);});},deleteInfo:function(a){this.actions.push(function(b){return b.deleteInfo(a);
});},addReference:function(b,c,a){this.actions.push(function(d){return d.addReference(b,c,a);});},removeReference:function(a,b){this.actions.push(function(c){return c.removeReference(a,b);
});}});upro.data.MemoryDataStoreModifyTester=Class.create(upro.data.DataStoreModifier,{initialize:function(a){this.store=a;
this.objectLife={};},isEntryAlive:function(c){var b=false;var a=this.objectLife[c.toString()];if(a===undefined){b=this.store.containsEntry(c);
}else{if(a===true){b=true;}else{if(a===false){b=false;}}}return b;},createInfo:function(d,c,a){var b=this.isEntryAlive(d)&&!this.isEntryAlive(c);
if(b){this.objectLife[c.toString()]=true;}return b;},updateInfo:function(b,a){return this.isEntryAlive(b);},deleteInfo:function(a){this.objectLife[a.toString()]=false;
return true;},addReference:function(b,c,a){return this.isEntryAlive(c)&&this.isEntryAlive(b);},removeReference:function(a,b){return true;
}});upro.data.MemoryDataStoreModifyExecutor=Class.create(upro.data.DataStoreModifier,{initialize:function(a){this.store=a;
},createInfo:function(e,d,a){var b=this.store.getEntry(e);var c=this.store.createEntry(d);c.setProperties(a);this.store.setReference(c,b,true);
return true;},updateInfo:function(c,a){var b=this.store.getEntry(c);b.setProperties(a);return true;},deleteInfo:function(a){this.store.deleteEntry(a);
return true;},addReference:function(d,e,a){var b=this.store.getEntry(e);var c=this.store.getEntry(d);this.store.setReference(c,b,a);
return true;},removeReference:function(c,d){var a=this.store.getEntry(d);var b=this.store.getEntry(c);if((a!==undefined)&&(b!==undefined)){this.store.setReference(b,a,undefined);
}return true;}});upro.model={};upro.model.AbstractProxiedDataStoreInfo=Class.create(upro.data.DataStoreInfo,{initialize:function($super,a){$super(a);
this.deletedCallback=null;},onDeleted:function(){if(this.deletedCallback){this.deletedCallback();}}});upro.model.UserSession=Class.create(upro.model.AbstractProxiedDataStoreInfo,{initialize:function($super,a){$super(a);
this.corridorPrepSystemId=null;this.corridorPrepJumpType=null;this.corridorPreparationChanged=null;},getCorridorPrepSystemId:function(){return this.corridorPrepSystemId;
},getCorridorPrepJumpType:function(){return this.corridorPrepJumpType;},onUpdated:function(a){var b=false;b=false;if(this.decodeNumberMember(a,upro.model.UserSession.PROPERTY_CORRIDOR_PREP_SYSTEM_ID)){b=true;
}if(this.decodeStringMember(a,upro.model.UserSession.PROPERTY_CORRIDOR_PREP_JUMP_TYPE)){b=true;}if(b&&this.corridorPreparationChanged){this.corridorPreparationChanged();
}}});upro.model.UserSession.TYPE="UserSession";upro.model.UserSession.PROPERTY_CORRIDOR_PREP_SYSTEM_ID="corridorPrepSystemId";
upro.model.UserSession.PROPERTY_CORRIDOR_PREP_JUMP_TYPE="corridorPrepJumpType";upro.model.UserSettings=Class.create(upro.model.AbstractProxiedDataStoreInfo,{initialize:function($super,a){$super(a);
this.activeGalaxy=null;this.activeGalaxyChanged=null;this.ignoredSolarSystems=[];this.ignoredSolarSystemsChanged=null;this.routingCapJumpGatesInUse=false;
this.routingCapJumpDriveInUse=false;this.routingCapJumpDriveRange=0;this.routingCapabilitiesChanged=null;this.routingRules={};
this.routingRuleChangedHandler=this.onRoutingRuleChanged.bind(this);this.routingRulesChanged=null;},getActiveGalaxy:function(){return this.activeGalaxy;
},getRoutingCapJumpGatesInUse:function(){return this.routingCapJumpGatesInUse;},getRoutingCapJumpDriveInUse:function(){return this.routingCapJumpDriveInUse;
},getRoutingCapJumpDriveRange:function(){return this.routingCapJumpDriveRange;},getIgnoredSolarSystems:function(){return this.ignoredSolarSystems.slice(0);
},setActiveGalaxy:function(a){if(this.activeGalaxy!=a){this.activeGalaxy=a;if(this.activeGalaxyChanged!==null){this.activeGalaxyChanged();
}}},onUpdated:function(b){var c=b[upro.model.UserSettings.PROPERTY_ACTIVE_GALAXY];if(c!==undefined){this.setActiveGalaxy(c);
}var a=false;if(this.decodeBooleanMember(b,upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_GATES_IN_USE)){a=true;}if(this.decodeBooleanMember(b,upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_DRIVE_IN_USE)){a=true;
}if(this.decodeNumberMember(b,upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_DRIVE_RANGE)){a=true;}if(a&&this.routingCapabilitiesChanged){this.routingCapabilitiesChanged();
}},onReferenceAdded:function(a){if(a.getInfoId().getType()==upro.model.UserIgnoredSolarSystem.TYPE){this.ignoredSolarSystems.push(a);
if(this.ignoredSolarSystemsChanged){this.ignoredSolarSystemsChanged();}}else{if(a.getInfoId().getType()==upro.model.UserRoutingRule.TYPE){this.routingRules[a.getRuleType()]=a;
a.changedCallback=this.routingRuleChangedHandler;this.onRoutingRuleChanged();}}},onReferenceRemoved:function(b){if(b.getInfoId().getType()==upro.model.UserIgnoredSolarSystem.TYPE){var a=this.ignoredSolarSystems.indexOf(b);
if(a>=0){this.ignoredSolarSystems.splice(a,1);if(this.ignoredSolarSystemsChanged){this.ignoredSolarSystemsChanged();}}}else{if(b.getInfoId().getType()==upro.model.UserRoutingRule.TYPE){delete this.routingRules[b.getRuleType()];
b.changedCallback=null;this.onRoutingRuleChanged();}}},onRoutingRuleChanged:function(){if(this.routingRulesChanged){this.routingRulesChanged();
}},getRoutingRuleByType:function(a){return this.routingRules[a];},getRoutingRules:function(){var a=[];for(var b in this.routingRules){a.push(this.routingRules[b]);
}a.sort(function c(e,d){return e.getIndex()-d.getIndex();});return a;}});upro.model.UserSettings.TYPE="UserSettings";upro.model.UserSettings.PROPERTY_ACTIVE_GALAXY="activeGalaxy";
upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_GATES_IN_USE="routingCapJumpGatesInUse";upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_DRIVE_IN_USE="routingCapJumpDriveInUse";
upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_DRIVE_RANGE="routingCapJumpDriveRange";upro.model.UserSettings.JumpDriveConstants={MinimumRange:0.25,MaximumRange:20,RangeStep:0.25};
upro.model.UserIgnoredSolarSystem=Class.create(upro.data.DataStoreInfo,{initialize:function($super,a){$super(a);this.solarSystemId=null;
},getSolarSystemId:function(){return this.solarSystemId;},onUpdated:function(a){this.solarSystemId=a[upro.model.UserIgnoredSolarSystem.PROPERTY_SOLAR_SYSTEM_ID];
}});upro.model.UserIgnoredSolarSystem.TYPE="UserIgnoredSolarSystem";upro.model.UserIgnoredSolarSystem.PROPERTY_SOLAR_SYSTEM_ID="solarSystemId";
upro.model.UserRoutingRule=Class.create(upro.data.DataStoreInfo,{initialize:function($super,a){$super(a);this.index=-1;this.ruleType=null;
this.inUse=false;this.parameter=null;this.changedCallback=null;},getIndex:function(){return this.index;},getRuleType:function(){return this.ruleType;
},getInUse:function(){return this.inUse;},getParameter:function(){return this.parameter;},onUpdated:function(a){this.decodeNumberMember(a,upro.model.UserRoutingRule.PROPERTY_INDEX);
this.decodeStringMember(a,upro.model.UserRoutingRule.PROPERTY_RULE_TYPE);this.decodeBooleanMember(a,upro.model.UserRoutingRule.PROPERTY_IN_USE);
this.decodeNumberMember(a,upro.model.UserRoutingRule.PROPERTY_PARAMETER);if(this.changedCallback){this.changedCallback(this);
}}});upro.model.UserRoutingRule.RuleConstants={};upro.model.UserRoutingRule.RuleConstants["Jumps"]={Type:"Jumps",Increment:1,Minimum:0,Maximum:10,Factor:1,Fixed:0};
upro.model.UserRoutingRule.RuleConstants["Jumps"].Constructor=upro.nav.finder.PathFinderCostRuleJumps;upro.model.UserRoutingRule.RuleConstants["JumpFuel"]={Type:"Fuel",Increment:0.25,Minimum:0,Maximum:5,Factor:1,Fixed:2};
upro.model.UserRoutingRule.RuleConstants["JumpFuel"].Constructor=upro.nav.finder.PathFinderCostRuleJumpFuel;upro.model.UserRoutingRule.RuleConstants["MinSecurity"]={Type:"MinSecurity",Increment:1,Minimum:0,Maximum:5,Factor:0.1,Fixed:1};
upro.model.UserRoutingRule.RuleConstants["MinSecurity"].Constructor=upro.nav.finder.PathFinderCostRuleMinSecurity;upro.model.UserRoutingRule.RuleConstants["MaxSecurity"]={Type:"MaxSecurity",Increment:1,Minimum:5,Maximum:10,Factor:0.1,Fixed:1};
upro.model.UserRoutingRule.RuleConstants["MaxSecurity"].Constructor=upro.nav.finder.PathFinderCostRuleMaxSecurity;upro.model.UserRoutingRule.RuleLimit=4;
upro.model.UserRoutingRule.TYPE="UserRoutingRule";upro.model.UserRoutingRule.PROPERTY_INDEX="index";upro.model.UserRoutingRule.PROPERTY_RULE_TYPE="ruleType";
upro.model.UserRoutingRule.PROPERTY_IN_USE="inUse";upro.model.UserRoutingRule.PROPERTY_PARAMETER="parameter";upro.model.proxies={};
upro.model.proxies.InfoTypeFactoryProxy=Class.create(Proxy,{initialize:function($super){$super(upro.model.proxies.InfoTypeFactoryProxy.NAME,upro.data.InfoTypeFactory.Instance);
},onRegister:function(){this.registerFactories();},registerFactories:function(){var a=this.getData();a.register(upro.model.UserSession.TYPE,this.createUserSession.bind(this));
a.register(upro.model.UserSettings.TYPE,this.createUserSettings.bind(this));a.register(upro.model.UserIgnoredSolarSystem.TYPE,this.createUserIgnoredSolarSystem.bind(this));
a.register(upro.model.UserRoutingRule.TYPE,this.createUserRoutingRule.bind(this));},createInfoAndProxy:function(d,a,e,c){var f=new e(d);
var b=new c(f,a);this.facade().registerProxy(b);return f;},createUserSession:function(b,a){return this.createInfoAndProxy(b,a,upro.model.UserSession,upro.model.proxies.UserSessionProxy);
},createUserSettings:function(b,a){return this.createInfoAndProxy(b,a,upro.model.UserSettings,upro.model.proxies.UserSettingsProxy);
},createUserIgnoredSolarSystem:function(b,a){return new upro.model.UserIgnoredSolarSystem(b);},createUserRoutingRule:function(b,a){return new upro.model.UserRoutingRule(b);
}});upro.model.proxies.InfoTypeFactoryProxy.NAME="InfoTypeFactory";upro.model.proxies.SessionControlProxy=Class.create(Proxy,{initialize:function($super){$super(upro.model.proxies.SessionControlProxy.NAME,null);
},onRegister:function(){},shutdown:function(){var a=this.getData();if(a){a.deleteEntry(upro.data.InfoId.System);this.setData(null);
}},runUnregistered:function(){this.shutdown();var a=new upro.data.MemoryDataStore();this.setData(a);a.createEntry(upro.data.InfoId.System);
var b=a.createWriteTransaction();var e=new upro.data.InfoId(upro.model.UserSession.TYPE);var d=new upro.data.InfoId(upro.model.UserSettings.TYPE);
b.createInfo(upro.data.InfoId.System,e,{});b.createInfo(e,d,{"activeGalaxy":upro.model.proxies.UniverseProxy.GALAXY_ID_NEW_EDEN,"routingCapJumpGatesInUse":"1","routingCapJumpDriveInUse":"0","routingCapJumpDriveRange":"5.0"});
var c=new upro.data.InfoId(upro.model.UserIgnoredSolarSystem.TYPE);b.createInfo(d,c,{"solarSystemId":30000142});this.createRoutingRule(b,d,0,"MinSecurity",true,5);
this.createRoutingRule(b,d,1,"MaxSecurity",false,10);this.createRoutingRule(b,d,2,"Jumps",true,0);this.createRoutingRule(b,d,3,"JumpFuel",false,0);
b.commit();},createRoutingRule:function(d,g,b,f,a,h){var e=new upro.data.InfoId(upro.model.UserRoutingRule.TYPE);var c={};
c[upro.model.UserRoutingRule.PROPERTY_INDEX]=b;c[upro.model.UserRoutingRule.PROPERTY_RULE_TYPE]=f;c[upro.model.UserRoutingRule.PROPERTY_IN_USE]=a?1:0;
c[upro.model.UserRoutingRule.PROPERTY_PARAMETER]=h;d.createInfo(g,e,c);},login:function(b,a){}});upro.model.proxies.SessionControlProxy.NAME="SessionControl";
upro.model.proxies.AbstractDataStoreInfoProxy=Class.create(Proxy,{initialize:function($super,b,c,a){$super(b,c);this.dataStore=a;
c.deletedCallback=this.onDataDeleted.bind();},toString:function(){return this.getName()+" for "+this.getData().toString();
},getDataStore:function(){return this.dataStore;},onDataDeleted:function(){this.facade().removeProxy(this.getName());},encodeBoolean:function(a){return a?"1":"0";
},updateProperties:function(a){var b=this.getDataStore().createWriteTransaction();b.updateInfo(this.getData().infoId,a);b.commit();
}});upro.model.proxies.UserSessionProxy=Class.create(upro.model.proxies.AbstractDataStoreInfoProxy,{initialize:function($super,b,a){$super(upro.model.proxies.UserSessionProxy.NAME,b,a);
b.corridorPreparationChanged=this.onCorridorPreparationChanged.bind(this);},onRegister:function(){this.facade().sendNotification(upro.app.Notifications.SessionLoggedIn,null);
},setCorridorPreparation:function(b,c){var a={};a[upro.model.UserSession.PROPERTY_CORRIDOR_PREP_SYSTEM_ID]=b?b.id:"";a[upro.model.UserSession.PROPERTY_CORRIDOR_PREP_JUMP_TYPE]=c?c:"";
this.updateProperties(a);},getCorridorPreparationJumpType:function(){var a=this.getData().getCorridorPrepJumpType();return(a&&(a.length>0))?a:upro.nav.JumpType.None;
},getCorridorPreparationSolarSystem:function(){var b=this.getData().getCorridorPrepSystemId();var a=this.facade().retrieveProxy(upro.model.proxies.UniverseProxy.NAME);
return b?a.findSolarSystemById(b):null;},onCorridorPreparationChanged:function(){this.facade().sendNotification(upro.app.Notifications.NewCorridorPreparationChanged,null);
}});upro.model.proxies.UserSessionProxy.NAME="UserSession";upro.model.proxies.UserSettingsProxy=Class.create(upro.model.proxies.AbstractDataStoreInfoProxy,{initialize:function($super,b,a){$super(upro.model.proxies.UserSettingsProxy.NAME,b,a);
b.activeGalaxyChanged=this.onActiveGalaxyChanged.bind(this);b.routingCapabilitiesChanged=this.onRoutingCapabilitiesChanged.bind(this);
b.ignoredSolarSystemsChanged=this.onIgnoredSolarSystemsChanged.bind(this);b.routingRulesChanged=this.onRoutingRulesChanged.bind(this);
},onRemove:function(){this.notifyActiveGalaxyChanged(undefined);},onActiveGalaxyChanged:function(){this.notifyActiveGalaxyChanged(this.getData().getActiveGalaxy());
},notifyActiveGalaxyChanged:function(a){this.facade().sendNotification(upro.app.Notifications.ActiveGalaxyChanged,a);},setActiveGalaxy:function(a){var b={};
b[upro.model.UserSettings.PROPERTY_ACTIVE_GALAXY]=a;this.updateProperties(b);},onRoutingCapabilitiesChanged:function(){this.facade().sendNotification(upro.app.Notifications.UserRoutingCapabilitiesChanged);
},getRoutingCapJumpGatesInUse:function(){return this.getData().getRoutingCapJumpGatesInUse();},toggleRoutingCapJumpGates:function(){var a={};
a[upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_GATES_IN_USE]=this.encodeBoolean(!this.getRoutingCapJumpGatesInUse());
this.updateProperties(a);},getRoutingCapJumpDriveInUse:function(){return this.getData().getRoutingCapJumpDriveInUse();},toggleRoutingCapJumpDrive:function(){var a={};
a[upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_DRIVE_IN_USE]=this.encodeBoolean(!this.getRoutingCapJumpDriveInUse());
this.updateProperties(a);},getRoutingCapJumpDriveRange:function(){return this.getData().getRoutingCapJumpDriveRange();},stepRoutingCapJumpDriveRange:function(a){var c=this.getRoutingCapJumpDriveRange()+(a?upro.model.UserSettings.JumpDriveConstants.RangeStep:-upro.model.UserSettings.JumpDriveConstants.RangeStep);
if((c>=upro.model.UserSettings.JumpDriveConstants.MinimumRange)&&(c<=upro.model.UserSettings.JumpDriveConstants.MaximumRange)){var b={};
b[upro.model.UserSettings.PROPERTY_ROUTING_CAP_JUMP_DRIVE_RANGE]=c;this.updateProperties(b);}},onIgnoredSolarSystemsChanged:function(){this.facade().sendNotification(upro.app.Notifications.UserIgnoredSolarSystemsChanged,this.getIgnoredSolarSystemIds());
},toggleIgnoredSolarSystem:function(h){var g=this.getDataStore().createWriteTransaction();var e=this.getData();var a=e.getIgnoredSolarSystems();
var d=false;for(var b=0;b<a.length;b++){var c=a[b];if(c.getSolarSystemId()==h){g.deleteInfo(c.getInfoId());d=true;}}if(!d){var f=new upro.data.InfoId(upro.model.UserIgnoredSolarSystem.TYPE);
g.createInfo(e.getInfoId(),f,{"solarSystemId":h});}g.commit();},getIgnoredSolarSystemIds:function(){var b=this.getData().getIgnoredSolarSystems();
var a=[];for(var c=0;c<b.length;c++){var d=b[c];a.push(d.getSolarSystemId());}return a;},onRoutingRulesChanged:function(){this.facade().sendNotification(upro.app.Notifications.UserRoutingRulesChanged,this.getRoutingRules());
},getRoutingRules:function(){return this.getData().getRoutingRules();},toggleRoutingRule:function(d){var b=this.getData().getRoutingRuleByType(d);
if(b){var c=this.getDataStore().createWriteTransaction();var a={};a[upro.model.UserRoutingRule.PROPERTY_IN_USE]=b.getInUse()?0:1;
c.updateInfo(b.getInfoId(),a);c.commit();}},stepRoutingRuleParameter:function(f,a){var d=this.getData().getRoutingRuleByType(f);
if(d){var c=upro.model.UserRoutingRule.RuleConstants[d.getRuleType()];var e=this.getDataStore().createWriteTransaction();
var b={};b[upro.model.UserRoutingRule.PROPERTY_PARAMETER]=d.getParameter()+(a?c.Increment:-c.Increment);e.updateInfo(d.getInfoId(),b);
e.commit();}},moveRoutingRule:function(c,d){var f=this.getData().getRoutingRuleByType(c);if(f){var g=f.getIndex();var h=g+(d?-1:1);
if((h>=0)&&(h<upro.model.UserRoutingRule.RuleLimit)){var j=this.getRoutingRules();var a=this.getDataStore().createWriteTransaction();
var e={};e[upro.model.UserRoutingRule.PROPERTY_INDEX]=h;a.updateInfo(f.getInfoId(),e);for(var b=0;b<j.length;b++){f=j[b];
if(f.getIndex()==h){e={};e[upro.model.UserRoutingRule.PROPERTY_INDEX]=g;a.updateInfo(f.getInfoId(),e);}}a.commit();}}}});
upro.model.proxies.UserSettingsProxy.NAME="UserSettings";upro.model.proxies.UniverseProxy=Class.create(Proxy,{initialize:function($super){$super(upro.model.proxies.UniverseProxy.NAME,new upro.nav.Universe());
this.loadTimer=null;this.loaded=0;},onRegister:function(){this.createGalaxies();},getUniverse:function(){return this.getData();
},getGalaxy:function(a){return this.getUniverse().galaxies.get(a);},findSolarSystemById:function(d){var a=null;var c=this.getUniverse();
var b=null;b=c.galaxies.get(upro.model.proxies.UniverseProxy.GALAXY_ID_NEW_EDEN);a=b.solarSystems.get(d);if(!a){b=c.galaxies.get(upro.model.proxies.UniverseProxy.GALAXY_ID_W_SPACE);
a=b.solarSystems.get(d);}return a;},createGalaxies:function(){var b=this.getUniverse();var a=upro.nav.Galaxy.create(upro.model.proxies.UniverseProxy.GALAXY_ID_NEW_EDEN,"New Eden",-78415,-40007,18791,25000);
b.galaxies.add(a);this.fillGalaxy(a,upro.nav.JumpType.JumpGate);var a=upro.nav.Galaxy.create(upro.model.proxies.UniverseProxy.GALAXY_ID_W_SPACE,"W-Space",7704164,-15393,9519056,25000);
b.galaxies.add(a);this.fillGalaxy(a,upro.nav.JumpType.StaticWormhole);},fillGalaxy:function(b,a){var c=upro.res.eve.MapData[b.id];
if(c!=undefined){this.loadRegions(b,c);this.loadConstellations(b,c);this.loadSolarSystems(b,c);this.loadSolarSystemJumps(b,c,a);
}},loadRegions:function(e,f){var a=f.regionData;var c,d;for(var b=0;b<a.length;b++){c=a[b];d=upro.nav.Region.create(c[0],c[1],c[2],-c[3],c[4]);
e.regions.add(d);}},loadConstellations:function(e,f){var b=f.constellationData;var c,d;for(var a=0;a<b.length;a++){c=b[a];
d=upro.nav.Constellation.create(c[1],c[2],c[3],-c[4],c[5],c[0]);e.constellations.add(d);}},loadSolarSystems:function(d,f){var e=f.solarSystemData;
var c,b;for(var a=0;a<e.length;a++){c=e[a];b=upro.nav.SolarSystem.create(c[0],c[3],c[4],-c[5],c[6],c[7],c[1],c[2]);d.solarSystems.add(b);
}},loadSolarSystemJumps:function(e,f,b){var a=f.solarSystemJumpData;var d;for(var c=0;c<a.length;c++){d=a[c];e.addStaticJumpCorridor(d[0],d[1],b);
}}});upro.model.proxies.UniverseProxy.NAME="Universe";upro.model.proxies.UniverseProxy.GALAXY_ID_NEW_EDEN=9;upro.model.proxies.UniverseProxy.GALAXY_ID_W_SPACE=9000001;
upro.model.proxies.UserViewDataProxy=Class.create(Proxy,{initialize:function($super){$super(upro.model.proxies.UserViewDataProxy.NAME);
this.highlightedObject=undefined;},onRemove:function(){if(this.highlightedObject!==undefined){this.notifyHighlightedObjectChanged(undefined);
}},notifyHighlightedObjectChanged:function(a){this.facade().sendNotification(upro.app.Notifications.HighlightedObjectChanged,a);
},setHighlightedObject:function(a){if(this.highlightedObject!==a){this.highlightedObject=a;this.notifyHighlightedObjectChanged(a);
}}});upro.model.proxies.UserViewDataProxy.NAME="UserViewData";upro.model.proxies.ActiveRouteProxy=Class.create(Proxy,{initialize:function($super){$super(upro.model.proxies.ActiveRouteProxy.NAME,null);
this.routeEntries=[];this.optimizersByIndex={};this.timer=null;this.filterSolarSystems=[];this.routingCapabilities=[];this.routingRules=[];
},onRegister:function(){this.timer=new upro.sys.Timer.getIntervalTimer(this.runOptimizers.bind(this));this.timer.start(10);
},onRemove:function(){if(this.timer){this.timer.stop();this.timer=null;}},notify:function(a){this.facade().sendNotification(a);
},setIgnoredSolarSystemIds:function(b){this.filterSolarSystems=[];for(var a=0;a<b.length;a++){var c=b[a];this.filterSolarSystems.push(new upro.nav.finder.PathFinderFilterSystem(c));
}this.optimizeAll();},setRoutingCapabilities:function(a){this.routingCapabilities=a;this.optimizeAll();},setRoutingRules:function(a){this.routingRules=a;
this.optimizeAll();},isEmpty:function(){return this.routeEntries.length==0;},resetRoute:function(){if(this.routeEntries.length>0){this.stopOptimizer(0,this.routeEntries.length-1);
this.routeEntries=[];this.notify(upro.app.Notifications.ActiveRoutePathChanged);}},containsSolarSystemAsEntry:function(d){var c=false;
for(var a=0;!c&&(a<this.routeEntries.length);a++){var b=this.routeEntries[a];if(b.systemEntry.getSolarSystem().id==d.id){c=true;
}}return c;},canEntryBeAdded:function(c,d){var b=this.routeEntries.length;var e=b==0;var a=false;if((d==upro.nav.SystemRouteEntry.EntryType.Checkpoint)||(!e&&(this.findSystemInSegmentOf(b-1,c)<0))){a=true;
}return a;},addEntry:function(f,g){if(this.canEntryBeAdded(f,g)){var b=g==upro.nav.SystemRouteEntry.EntryType.Checkpoint;
var a=new upro.nav.SystemRouteEntry(f,g);var e=this.createRouteEntry(a);if(this.routeEntries.length==0){e.isReachable=true;
}this.routeEntries.push(e);var d=this.routeEntries.length-((b&&(this.routeEntries.length>1))?2:1);var c=this.findSegmentStart(d);
this.optimizeSegment(c,d);this.notify(upro.app.Notifications.ActiveRoutePathChanged);}},removeEntry:function(c){var e=0;while(e<this.routeEntries.length){var a=this.findSystemInSegmentOf(e,c);
if(a>=0){var b=this.routeEntries[a];var d=b.systemEntry.getEntryType();if(d==upro.nav.SystemRouteEntry.EntryType.Checkpoint){if(a<(this.routeEntries.length-1)){this.routeEntries[a+1].systemEntry=this.routeEntries[a+1].systemEntry.asEntryType(upro.nav.SystemRouteEntry.EntryType.Checkpoint);
this.deleteEntry(a);}else{this.deleteEntry(a);startIndex=a;}}else{this.deleteEntry(a);}}else{if(e==0){e=1;}else{e=this.findSegmentEnd(e)+1;
}}}this.notify(upro.app.Notifications.ActiveRoutePathChanged);},deleteEntry:function(a){this.stopOptimizer(a,a);this.routeEntries.splice(a,1);
if(this.routeEntries.length>0){var d=this.findSegmentEnd((a>0)?a-1:0);for(var b=d+1;b<=this.routeEntries.length;b++){var c=this.optimizersByIndex[b];
if(c){this.optimizersByIndex[b-1]=c;delete this.optimizersByIndex[b];}}this.optimizeSegment(this.findSegmentStart(d),d);}},optimizeAll:function(){var b=0;
while(b<this.routeEntries.length){var a=this.findSegmentEnd(b);var c=this.findSegmentStart(a);this.optimizeSegment(c,a);b=a+1;
}this.notify(upro.app.Notifications.ActiveRoutePathChanged);},optimizeSegment:function(k,g){var c;var f;this.stopOptimizer(k,g+1);
for(f=k;f<=g;f++){c=this.routeEntries[f];c.transits=[];if(f>k){c.isReachable=false;}}var h=[];var d=null;var b=null;var a=null;
d=this.routeEntries[k].systemEntry.getSolarSystem();if(g<(this.routeEntries.length-1)){c=this.routeEntries[g+1];var e=c.systemEntry;
c.isReachable=false;b=e.getSolarSystem();}for(f=k+1;f<=g;f++){var j=this.routeEntries[f].systemEntry.getSolarSystem();if(b&&(b.id==j.id)){this.routeEntries.splice(f,1);
g--;f--;}else{h.push(j);}}a=new upro.nav.finder.RouteFinderGeneticTSP(this.routingCapabilities,this.routingRules,this.filterSolarSystems,d,h,b);
this.optimizersByIndex[g]=a;},runOptimizers:function(){var c=null;var d=[];var f=false;var b=true;for(c in this.optimizersByIndex){d.push(c);
}for(var a=0;a<d.length;a++){c=new Number(d[a]);var e=this.optimizersByIndex[c];if(this.runFinderBulk(e)){this.onOptimizerCompleted(c);
f=true;}else{b=false;}}if(f){this.notify(upro.app.Notifications.ActiveRoutePathChanged);}return b;},runFinderBulk:function(c){var b=false;
for(var a=0;!b&&(a<100);a++){b=c.continueSearch();}return b;},stopOptimizer:function(c,b){for(var a=c+1;a<=b;a++){if(this.optimizersByIndex[a]){delete this.optimizersByIndex[a];
}}},onOptimizerCompleted:function(c){var f=this.findSegmentStart(c);var d=this.optimizersByIndex[c];var e=d.getRouteEntries();
var g=this.routeEntries[f];var a;var b;delete this.optimizersByIndex[c];if(e.length>0){this.routeEntries[f].systemEntry=e[0].asEntryType(upro.nav.SystemRouteEntry.EntryType.Checkpoint);
if(c<(this.routeEntries.length-1)){this.routeEntries[1+c].isReachable=true;}}f++;for(b=1;b<e.length;b++){a=e[b];if(a.getEntryType()==upro.nav.SystemRouteEntry.EntryType.Waypoint){g=this.createRouteEntry(a);
g.isReachable=true;this.routeEntries.splice(f,1,g);f++;}else{g.transits.push(a);}}},findSegmentEnd:function(c){var b=c+1;
var a=this.routeEntries.length;while((b<a)&&(this.routeEntries[b].systemEntry.getEntryType()!=upro.nav.SystemRouteEntry.EntryType.Checkpoint)){b++;
}return b-1;},findSegmentStart:function(a){var b=a;while((b>=0)&&(this.routeEntries[b].systemEntry.getEntryType()!=upro.nav.SystemRouteEntry.EntryType.Checkpoint)){b--;
}return(b>=0)?b:0;},findSystemInSegmentOf:function(a,e){var d=this.findSegmentEnd(a);var f=this.findSegmentStart(d);var g=-1;
var c;for(var b=f;(g<0)&&(b<(d+1));b++){c=this.routeEntries[b];if(c.systemEntry.getSolarSystem()==e){g=b;}}return g;},createRouteEntry:function(a){var b={"systemEntry":a,"transits":[],"isReachable":false};
return b;}});upro.model.proxies.ActiveRouteProxy.NAME="ActiveRoute";upro.ctrl={};upro.ctrl.cmd={};upro.ctrl.cmd.NAME_SUFFIX="Command";
upro.ctrl.cmd.NOTIFIED_NAME_PREFIX="Notified";upro.ctrl.cmd.getAllNotified=function(){var a={};var c=upro.ctrl.cmd.NOTIFIED_NAME_PREFIX;
var d=upro.ctrl.cmd.NAME_SUFFIX;for(var b in upro.ctrl.cmd){if((b.length>d.length)&&(b.substr(b.length-d.length)==d)&&(b.length>c.length)&&(b.substr(0,c.length)==c)){a[b.substr(c.length,b.length-(d.length+c.length))]=upro.ctrl.cmd[b];
}}return a;};upro.ctrl.cmd.NotifiedStartupCommand=Class.create(MacroCommand,{initializeMacroCommand:function(){upro.res.text.Lang.setCurrentLanguage(upro.res.text.Lang.defaultLang);
this.addSubCommand(upro.ctrl.cmd.SetupModelCommand);this.addSubCommand(upro.ctrl.cmd.SetupViewCommand);this.addSubCommand(upro.ctrl.cmd.InitApplicationCommand);
}});upro.ctrl.cmd.SetupModelCommand=Class.create(SimpleCommand,{execute:function(a){this.facade().registerProxy(new upro.model.proxies.InfoTypeFactoryProxy());
this.facade().registerProxy(new upro.model.proxies.SessionControlProxy());}});upro.ctrl.cmd.SetupViewCommand=Class.create(SimpleCommand,{execute:function(a){this.facade().registerMediator(new upro.view.mediators.DocumentMouseMediator());
this.facade().registerMediator(new upro.view.mediators.HudMediator());if(upro.scene.SceneSystem.SUPPORTED){this.facade().registerMediator(new upro.view.mediators.SceneMediator());
}}});upro.ctrl.cmd.InitApplicationCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.SessionControlProxy.NAME);
a.runUnregistered();}});upro.ctrl.cmd.NotifiedSessionLoggedInCommand=Class.create(SimpleCommand,{execute:function(b){this.facade().registerProxy(new upro.model.proxies.UniverseProxy());
this.facade().registerProxy(new upro.model.proxies.UserViewDataProxy());this.facade().registerProxy(new upro.model.proxies.ActiveRouteProxy());
this.facade().registerMediator(new upro.view.mediators.MainContextMenuMediator());this.facade().registerMediator(new upro.view.mediators.SolarSystemHighlightMediator());
this.facade().registerMediator(new upro.view.mediators.SolarSystemContextMenuMediator());this.facade().registerMediator(new upro.view.mediators.ActiveRouteOverlayMediator());
if(upro.scene.SceneSystem.SUPPORTED){var a=this.facade().retrieveMediator(upro.view.mediators.SceneMediator.NAME);a.createGalaxies();
}}});upro.ctrl.cmd.NotifiedSetActiveGalaxyCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
if(a!==null){a.setActiveGalaxy(b.getBody());}}});upro.ctrl.cmd.NotifiedSetHighlightedObjectCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserViewDataProxy.NAME);
a.setHighlightedObject(b.getBody());}});upro.ctrl.cmd.NotifiedHighlightedObjectChangedCommand=Class.create(SimpleCommand,{execute:function(e){var c=e.getBody();
var a=this.facade().retrieveMediator(upro.view.mediators.SolarSystemHighlightMediator.NAME);var d=this.facade().retrieveMediator(upro.view.mediators.SceneMediator.NAME);
if(c instanceof upro.nav.SolarSystem){var b=d.projectSolarSystem(c);if(b){a.setHighlight(c,b);}else{a.clearHighlight();}}else{a.clearHighlight();
}}});upro.ctrl.cmd.NotifiedScenePointerActivationCommand=Class.create(SimpleCommand,{execute:function(a){var c=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
var d=this.facade().retrieveMediator(upro.view.mediators.SceneMediator.NAME);var g=this.facade().retrieveMediator(upro.view.mediators.MainContextMenuMediator.NAME);
var i=a.getBody();var h=d.pick(i);var e=g.isVisible();c.setActiveContextMenu(null);if(h){var b=h.getRefObject();if(b instanceof upro.nav.SolarSystem){var f=this.facade().retrieveMediator(upro.view.mediators.SolarSystemContextMenuMediator.NAME);
f.show(h.getViewPosition(),b);}}else{if(!e){g.show(i,null);}}}});upro.ctrl.cmd.NotifiedUserIgnoredSolarSystemsChangedCommand=Class.create(SimpleCommand,{execute:function(c){var b=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var a=c.getBody();b.setIgnoredSolarSystemIds(a);}});upro.ctrl.cmd.NotifiedUserIgnoredSolarSystemIgnoreToggleCommand=Class.create(SimpleCommand,{execute:function(c){var b=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
var a=c.getBody();b.toggleIgnoredSolarSystem(a.id);}});upro.ctrl.cmd.NotifiedActiveRouteResetCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
a.resetRoute();}});upro.ctrl.cmd.NotifiedActiveRouteRemoveEntryCommand=Class.create(SimpleCommand,{execute:function(c){var a=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var b=c.getBody();a.removeEntry(b);}});upro.ctrl.cmd.NotifiedActiveRouteAddWaypointCommand=Class.create(SimpleCommand,{execute:function(c){var a=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var b=c.getBody();a.addEntry(b,upro.nav.SystemRouteEntry.EntryType.Waypoint);}});upro.ctrl.cmd.NotifiedActiveRouteAddCheckpointCommand=Class.create(SimpleCommand,{execute:function(c){var a=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var b=c.getBody();a.addEntry(b,upro.nav.SystemRouteEntry.EntryType.Checkpoint);}});upro.ctrl.cmd.NotifiedActiveRoutePathChangedCommand=Class.create(SimpleCommand,{execute:function(d){var b=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var l=this.facade().retrieveMediator(upro.view.mediators.SceneMediator.NAME);var a=this.facade().retrieveMediator(upro.view.mediators.ActiveRouteOverlayMediator.NAME);
var f,c;var k=null,m=null;var h=1;l.clearRoute();a.clear();for(var g=0;g<b.routeEntries.length;g++){f=b.routeEntries[g];c=f.isReachable;
if(k){l.addRouteEdge(k,f.systemEntry.getSolarSystem(),c);}a.setSystemOverlay(f.systemEntry.getSolarSystem(),h,c);h++;k=f.systemEntry.getSolarSystem();
for(var e=0;e<f.transits.length;e++){m=f.transits[e].getSolarSystem();l.addRouteEdge(k,m,true);k=m;}}}});upro.ctrl.cmd.NotifiedUserRoutingRulesChangedCommand=Class.create(SimpleCommand,{execute:function(g){var d=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var h=g.getBody();var c=[];for(var a=0;a<h.length;a++){var f=h[a];var b=upro.model.UserRoutingRule.RuleConstants[f.getRuleType()];
if(f.getInUse()&&b){var e=new b.Constructor((f.getParameter()*b.Factor).toFixed(b.Fixed));c.push(e);}}d.setRoutingRules(c);
}});upro.ctrl.cmd.NotifiedUserRoutingRuleToggleCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.toggleRoutingRule(b.getBody());}});upro.ctrl.cmd.NotifiedUserRoutingRuleMoreCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.stepRoutingRuleParameter(b.getBody(),true);}});upro.ctrl.cmd.NotifiedUserRoutingRuleLessCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.stepRoutingRuleParameter(b.getBody(),false);}});upro.ctrl.cmd.NotifiedUserRoutingRuleUpCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.moveRoutingRule(b.getBody(),true);}});upro.ctrl.cmd.NotifiedUserRoutingRuleDownCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.moveRoutingRule(b.getBody(),false);}});upro.ctrl.cmd.NotifiedUserRoutingCapabilitiesChangedCommand=Class.create(SimpleCommand,{execute:function(d){var b=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var c=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);var a=[];if(c.getRoutingCapJumpGatesInUse()){a.push(new upro.nav.finder.PathFinderCapabilityJumpGates());
}if(c.getRoutingCapJumpDriveInUse()){a.push(new upro.nav.finder.PathFinderCapabilityJumpDrive(c.getRoutingCapJumpDriveRange()));
}b.setRoutingCapabilities(a);}});upro.ctrl.cmd.NotifiedUserRoutingCapJumpGatesToggleCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.toggleRoutingCapJumpGates();}});upro.ctrl.cmd.NotifiedUserRoutingCapJumpDriveToggleCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.toggleRoutingCapJumpDrive();}});upro.ctrl.cmd.NotifiedUserRoutingCapJumpDriveRangeStepCommand=Class.create(SimpleCommand,{execute:function(b){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
a.stepRoutingCapJumpDriveRange(b.getBody());}});upro.ctrl.cmd.NotifiedNewCorridorSetExitCommand=Class.create(SimpleCommand,{execute:function(a){sessionProxy.setCorridorPreparation(null,null);
}});upro.ctrl.cmd.NotifiedNewCorridorPrepareWormholeCommand=Class.create(SimpleCommand,{execute:function(c){var a=this.facade().retrieveProxy(upro.model.proxies.UserSessionProxy.NAME);
var b=c.getBody();a.setCorridorPreparation(b,upro.nav.JumpType.DynamicWormhole);}});upro.ctrl.cmd.NotifiedNewCorridorPrepareJumpBridgeCommand=Class.create(SimpleCommand,{execute:function(c){var a=this.facade().retrieveProxy(upro.model.proxies.UserSessionProxy.NAME);
var b=c.getBody();a.setCorridorPreparation(b,upro.nav.JumpType.JumpBridge);}});upro.view={};upro.view.SceneObjectRotationOperation=Class.create(upro.sys.PointerOperation,{initialize:function(b,a){this.sceneSystem=b;
this.obj=a;this.lastPos=vec3.create();this.temp=vec3.create();},onDown:function(b,a,c){},onUp:function(b,a,c){},onMove:function(b,a){var d=this.sceneSystem.pixelToReal(b.x,b.y);
var c=vec3.set([-d.y,d.x,0],this.temp);var e=vec3.subtract(this.lastPos,c);vec3.scale(e,5);vec3.add(this.obj.rotation,e);
this.obj.rotation[0]=this.rotateValue(this.obj.rotation[0]);this.obj.rotation[0]=this.limitValueMax(this.obj.rotation[0],0);
this.obj.rotation[0]=this.limitValueMin(this.obj.rotation[0],Math.PI/-2);this.obj.rotation[1]=this.rotateValue(this.obj.rotation[1]);
this.obj.rotation[2]=this.rotateValue(this.obj.rotation[2]);this.obj.setOrientationModified(true);vec3.set(c,this.lastPos);
},onRotate:function(b,a,c){},onStart:function(b,a){var c=this.sceneSystem.pixelToReal(b.x,b.y);this.lastPos[0]=-c.y;this.lastPos[1]=c.x;
},onStop:function(a){},rotateValue:function(b){var a=Math.PI*2;while(b>a){b-=a;}while(b<-a){b+=a;}return b;},limitValueMax:function(b,a){if(b>a){b=a;
}return b;},limitValueMin:function(b,a){if(b<a){b=a;}return b;}});upro.view.OrientedMoveOperation=Class.create(upro.sys.PointerOperation,{initialize:function(b,a,c){this.sceneSystem=b;
this.buffer=a;this.moveCallback=c;this.lastPos=vec3.create();this.temp=vec3.create();},onDown:function(b,a,c){},onUp:function(b,a,c){},onMove:function(b,a){var d=this.sceneSystem.pixelToReal(-b.x,-b.y);
var c=vec3.set([d.x,d.y,0],this.temp);var e=vec3.subtract(this.lastPos,c);this.moveByVector(e);vec3.set(c,this.lastPos);},onRotate:function(b,a,d){var c=vec3.set([0,0,d[1]/-1000],this.temp);
this.moveByVector(c);},onStart:function(b,a){var c=this.sceneSystem.pixelToReal(-b.x,-b.y);this.lastPos[0]=c.x;this.lastPos[1]=c.y;
},onStop:function(a){},moveByVector:function(a){this.buffer.rotateVector(a);this.moveCallback(a);}});upro.view.IdlePointerOperation=Class.create(upro.sys.PointerOperation,{initialize:function(a){this.sceneMediator=a;
},onDown:function(b,a,c){if(c[2]&&a[2]){this.sceneMediator.onIdleTertiaryClick();}},onUp:function(b,a,e){var d=this.sceneMediator.getViewComponent();
var c=d.pixelToReal(b.x,b.y);if(e[0]&&!a[0]){this.sceneMediator.onIdlePrimaryClick(c);}},onMove:function(b,a){var d=this.sceneMediator.getViewComponent();
var c=d.pixelToReal(b.x,b.y);this.sceneMediator.onHover(c);},onRotate:function(b,a,c){},onStart:function(b,a){var d=this.sceneMediator.getViewComponent();
var c=d.pixelToReal(b.x,b.y);this.sceneMediator.onHover(c);},onStop:function(a){this.sceneMediator.stopHover();}});upro.view.mediators={};
upro.view.mediators.AbstractMediator=Class.create(Mediator,{listNotificationInterests:function(){var c=[];var b=upro.view.mediators.AbstractMediator.HANDLER_NAME_PREFIX;
for(var a in this){if((a.length>b.length)&&(a.substr(0,b.length)==b)){c.push(a.substr(b.length));}}return c;},handleNotification:function(b){var a=upro.view.mediators.AbstractMediator.HANDLER_NAME_PREFIX+b.getName();
if(this[a]!=undefined){this[a](b.getBody());}}});upro.view.mediators.AbstractMediator.HANDLER_NAME_PREFIX="onNotify";upro.view.mediators.DocumentMouseMediator=Class.create(upro.view.mediators.AbstractMediator,{initialize:function($super){$super(upro.view.mediators.DocumentMouseMediator.NAME,null);
},onRegister:function(){var a=new upro.sys.PointerOperationRegistry();this.mouseListener=new upro.sys.MouseListener(a);this.setViewComponent(a);
}});upro.view.mediators.DocumentMouseMediator.NAME="DocumentMouse";upro.view.mediators.HudMediator=Class.create(upro.view.mediators.AbstractMediator,{initialize:function($super){$super(upro.view.mediators.HudMediator.NAME,null);
},onRegister:function(){var a=new upro.sys.ResizableContextWindow("hud");var b=new upro.hud.HudSystem(a);this.setViewComponent(b);
},onNotifyDebugMessage:function(a){this.getViewComponent().debugMessage(a);},onNotifySessionLoggedIn:function(){this.getViewComponent().debugMessage("Online!");
}});upro.view.mediators.HudMediator.NAME="HUD";upro.view.mediators.SceneMediator=Class.create(upro.view.mediators.AbstractMediator,{initialize:function($super){$super(upro.view.mediators.SceneMediator.NAME,null);
this.galaxies={};this.visibleGalaxyId=null;},onRegister:function(){var b=new upro.sys.ResizableContextWindow("scene");var a=new upro.scene.SceneSystem(b);
this.basicShader=a.loadShaderProgram(upro.scene.ShaderProgram,[$("basic-vertex-shader"),$("basic-fragment-shader")]);this.systemShader=a.loadShaderProgram(upro.scene.ShaderProgram,[$("system-vertex-shader"),$("system-fragment-shader")]);
this.setViewComponent(a);},resetCamera:function(){var a=this.getViewComponent();vec3.set([0,0,0],a.camera.position);vec3.set([Math.PI/-2,0,0],a.camera.rotation);
},createGalaxies:function(){this.resetCamera();this.createGalaxy(upro.model.proxies.UniverseProxy.GALAXY_ID_NEW_EDEN);this.createGalaxy(upro.model.proxies.UniverseProxy.GALAXY_ID_W_SPACE);
this.registerPointerOperations();},createGalaxy:function(b){var f=this.getViewComponent();var d=new upro.scene.GalaxyRenderObject(this.basicShader,this.systemShader);
var h=this.facade().retrieveProxy(upro.model.proxies.UniverseProxy.NAME).getGalaxy(b);this.galaxies[b]=d;vec3.set([0,-20,0],d.position);
for(var a in h.solarSystems.objects){var g=h.solarSystems.get(a);d.addSolarSystem(g);}for(var e=0;e<h.jumpCorridors.length;
e++){var c=h.jumpCorridors[e];d.addJumpCorridor(c);}d.addToScene(f);},pick:function(c){var a=null;if(this.visibleGalaxyId){var b=this.galaxies[this.visibleGalaxyId];
a=b.pick(c);}return a;},projectSolarSystem:function(c){var a=null;if(this.visibleGalaxyId==c.galaxy.id){var b=this.galaxies[this.visibleGalaxyId];
a=b.projectSolarSystem(c,vec3.create());}return a;},addRouteEdge:function(b,a,c){this.addRouteEdgeBySystem1(b,a,c);if(b.galaxy.id!=a.galaxy.id){this.addRouteEdgeBySystem1(a,b,c);
}},addRouteEdgeBySystem1:function(c,b,d){var a=this.galaxies[c.galaxy.id];a.addRouteEdge(c,b,d);},clearRoute:function(){for(var b in this.galaxies){var a=this.galaxies[b];
a.clearRoute();}},addSolarSystemTrack:function(c,d,e){var b=this.galaxies[d.galaxy.id];var a=vec3.create();vec3.subtract(d.position,d.galaxy.position,a);
vec3.scale(a,1/d.galaxy.scale);b.addProjectionTracker(new upro.scene.TrackedProjection(c,a,e));},removeSolarSystemTrack:function(b,c){var a=this.galaxies[c.galaxy.id];
a.removeProjectionTracker(b);},registerPointerOperations:function(){var c=this.facade().retrieveMediator(upro.view.mediators.DocumentMouseMediator.NAME).getViewComponent();
var d=this.getViewComponent();var e=new upro.view.SceneObjectRotationOperation(d,d.camera);c.registerOperation([true,false,false],e);
var a=new upro.view.OrientedMoveOperation(d,d.getCameraRotationBuffer(),this.onMove.bind(this));c.registerOperation([false,true,false],a);
var b=new upro.view.IdlePointerOperation(this);c.registerOperation([false,false,false],b);},onIdlePrimaryClick:function(a){this.facade().sendNotification(upro.app.Notifications.ScenePointerActivation,a);
},onIdleTertiaryClick:function(){var b=this.visibleGalaxyId?this.visibleGalaxyId:0;var d=null;var c=null;for(var a in this.galaxies){if((d==null)||(d>a)){d=a;
}if((a>b)&&((c==null)||(c>a))){c=a;}}b=c?c:d;this.facade().sendNotification(upro.app.Notifications.SetActiveGalaxy,b);},onHover:function(b){var c=this.getViewComponent();
var a=c.pickAt(b);if(a){this.facade().sendNotification(upro.app.Notifications.SetHighlightedObject,a.getRefObject());}else{this.facade().sendNotification(upro.app.Notifications.SetHighlightedObject,null);
}},stopHover:function(){this.facade().sendNotification(upro.app.Notifications.SetHighlightedObject,null);},onMove:function(b){if(this.visibleGalaxyId){var a=this.galaxies[this.visibleGalaxyId];
var c=vec3.length(a.position)/1.5;if(c<5){c=5;}var e=vec3.scale(b,c,vec3.create());vec3.add(a.position,e);var d=vec3.length(a.position);
if(a.position[1]>2){a.position[1]=2;}if(a.position[1]<-20){a.position[1]=-20;}if(d>30){vec3.normalize(a.position);vec3.scale(a.position,30);
}a.setOrientationModified(true);}},onNotifyActiveGalaxyChanged:function(a){var b=this.galaxies[a];if((this.visibleGalaxyId!=null)&&(this.visibleGalaxyId!=a)){var c=this.galaxies[this.visibleGalaxyId];
c.setVisible(false);this.visibleGalaxyId=null;}if(b){this.visibleGalaxyId=a;b.setVisible(true);}}});upro.view.mediators.SceneMediator.NAME="Scene";
upro.view.mediators.SolarSystemHighlightMediator=Class.create(upro.view.mediators.AbstractMediator,{initialize:function($super){$super(upro.view.mediators.SolarSystemHighlightMediator.NAME,null);
},onRegister:function(){var a=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();this.bracket=a.createHexagon(upro.hud.Button.Scale).hide();
this.info=a.paper.text(0,0,"");this.info.attr({"fill":"#FFF","font-size":upro.view.mediators.SolarSystemHighlightMediator.TEXT_HEIGHT,"text-anchor":"end"});
this.clearHighlight();},setHighlight:function(d,b){var c=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
var a=c.realToViewCoordinates(b);var e=upro.hud.Button.getOffset[5](0);this.bracket.stop();this.bracket.animate({"transform":"T"+a.x+","+a.y,"fill-opacity":0.2,"stroke-opacity":0.3},50);
this.info.attr({"text":d.name});this.info.attr({"x":a.x+e.x,"y":a.y+e.y});this.bracket.show();this.info.show();},clearHighlight:function(){var b=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
var a=b.realToViewCoordinates({x:0,y:0});this.bracket.hide();this.info.hide();this.bracket.attr({"transform":"T"+a.x+","+a.y,"fill-opacity":0,"stroke-opacity":0});
this.info.attr({"text":"","x":a.x,"y":a.y});}});upro.view.mediators.SolarSystemHighlightMediator.NAME="SolarSystemHighlight";
upro.view.mediators.SolarSystemHighlightMediator.TEXT_HEIGHT=20;upro.view.mediators.AbstractContextMenuMediator=Class.create(upro.view.mediators.AbstractMediator,{initialize:function($super,a,b){$super(a,new upro.hud.RadialMenu(b,this.onMenuCancel.bind(this)));
this.activeContext=null;this.notifyBody=null;},getNotifyBody:function(){return this.notifyBody;},isVisible:function(){return this.activeContext!=null;
},show:function(a,e){var c=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();var d=this.getViewComponent();
var b=new upro.hud.RadialMenuContext(d,c,a);this.cancel();this.activeContext=b;this.notifyBody=e;this.updateCommands();c.setActiveContextMenu(b);
b.show();},cancel:function(){if(this.activeContext){this.activeContext.cancel();}},createVectorIcon:function(c){var a=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
var b=a.paper.path(c);b.attr("fill","#FFF");return b;},notify:function(b,a){this.facade().sendNotification(b,(a!==undefined)?a:this.getNotifyBody());
},onMenuCancel:function(){if(this.activeContext){var a=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
a.setActiveContextMenu(null);this.activeContext=null;}},updateCommands:function(){}});upro.view.mediators.SolarSystemContextMenuMediator=Class.create(upro.view.mediators.AbstractContextMenuMediator,{initialize:function($super){$super(upro.view.mediators.SolarSystemContextMenuMediator.NAME,this.createVectorIcon.bind(this,upro.res.menu.IconData.SolarSystem));
},onRegister:function(){var c=this.getViewComponent();var b=this;var a=c.setSubMenu(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Routing),upro.res.text.Lang.format("routing.menuLabel"));
this.commandActiveRouteAddCheckpoint=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.ActiveRouteAddCheckpoint);
b.cancel();},upro.res.text.Lang.format("solarSystem.routing.addCheckpoint"));a.setCommand(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Checkpoint),this.commandActiveRouteAddCheckpoint);
this.commandActiveRouteAddWaypoint=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.ActiveRouteAddWaypoint);
b.cancel();},upro.res.text.Lang.format("solarSystem.routing.addWaypoint"));a.setCommand(5,this.createVectorIcon.bind(this,upro.res.menu.IconData.Waypoint),this.commandActiveRouteAddWaypoint);
this.commandActiveRouteRemoveEntry=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.ActiveRouteRemoveEntry);
b.cancel();},upro.res.text.Lang.format("solarSystem.routing.remove"));a.setCommand(3,this.createVectorIcon.bind(this,upro.res.menu.IconData.Delete),this.commandActiveRouteRemoveEntry);
this.commandActiveRouteIgnoreSystem=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.UserIgnoredSolarSystemIgnoreToggle);
b.cancel();},upro.res.text.Lang.format("solarSystem.routing.toggleIgnore"));a.setCommand(4,this.createVectorIcon.bind(this,upro.res.menu.IconData.Denied),this.commandActiveRouteIgnoreSystem);
var d=c.setSubMenu(5,this.createVectorIcon.bind(this,upro.res.menu.IconData.JumpCorridor),upro.res.text.Lang.format("corridor.menuLabel"));
this.commandCorridorExit=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.NewCorridorSetExit);
b.cancel();},upro.res.text.Lang.format("corridor.exit"));d.setCommand(4,this.createVectorIcon.bind(this,upro.res.menu.IconData.WormholeOut),this.commandCorridorExit);
this.commandCorridorPrepWormhole=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.NewCorridorPrepareWormhole);
b.cancel();},upro.res.text.Lang.format("corridor.entry.wormhole"));d.setCommand(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Wormhole),this.commandCorridorPrepWormhole);
this.commandCorridorPrepJumpBridge=new upro.hud.SimpleCommandAdapter(function(){b.notify(upro.app.Notifications.NewCorridorPrepareJumpBridge);
b.cancel();},upro.res.text.Lang.format("corridor.entry.jumpBridge"));d.setCommand(1,this.createVectorIcon.bind(this,upro.res.menu.IconData.Bridge),this.commandCorridorPrepJumpBridge);
},updateCommands:function(){this.updateCommandActiveRoute();this.updateCommandIgnored();this.updateCommandCorridor();},updateCommandActiveRoute:function(){var a=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);
var b=this.getNotifyBody();this.commandActiveRouteAddCheckpoint.setPossible(b&&a.canEntryBeAdded(b,upro.nav.SystemRouteEntry.EntryType.Checkpoint));
this.commandActiveRouteAddWaypoint.setPossible(b&&a.canEntryBeAdded(b,upro.nav.SystemRouteEntry.EntryType.Waypoint));this.commandActiveRouteRemoveEntry.setPossible(b&&a.containsSolarSystemAsEntry(b));
},updateCommandIgnored:function(c){var b=this.getNotifyBody();if(!c){var a=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
c=a.getIgnoredSolarSystemIds();}this.commandActiveRouteIgnoreSystem.setActive(b&&(c.indexOf(b.id)>=0));},updateCommandCorridor:function(){var b=this.facade().retrieveProxy(upro.model.proxies.UserSessionProxy.NAME);
var d=this.getNotifyBody();var a=b.getCorridorPreparationJumpType();var c=d&&(d.galaxy.id==upro.model.proxies.UniverseProxy.GALAXY_ID_NEW_EDEN)&&(d.security==0);
var e=false;if(a==upro.nav.JumpType.DynamicWormhole){e=true;}else{if(a==upro.nav.JumpType.JumpBridge){e=c;}}this.commandCorridorExit.setPossible(e);
this.commandCorridorPrepJumpBridge.setPossible(c);},onNotifyActiveRoutePathChanged:function(){this.updateCommandActiveRoute();
},onNotifyUserIgnoredSolarSystemsChanged:function(a){this.updateCommandIgnored(a);}});upro.view.mediators.SolarSystemContextMenuMediator.NAME="SolarSystemContextMenu";
upro.view.mediators.ActiveRouteOverlayMediator=Class.create(upro.view.mediators.AbstractMediator,{initialize:function($super){$super(upro.view.mediators.ActiveRouteOverlayMediator.NAME,null);
this.systems={};},clear:function(){for(var a in this.systems){this.removeSystemOverlay(a);}},setSystemOverlay:function(e,c,a){var g=this.createKey(e);
var d=this.systems[g];if(!d){var b=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
var i=this.facade().retrieveMediator(upro.view.mediators.SceneMediator.NAME);var f=a?"#FFFF00":"#FF0000";var h=a?"#808000":"800000";
d={"solarSystem":e,"bracket":null,"info":null,"text":""+c+": "+e.name};d.bracket=b.createHexagon(5).hide();d.bracket.attr({"stroke":h,"fill":h,"fill-opacity":0.1,"stroke-opacity":0.8});
d.info=b.paper.text(0,0,"").hide();d.info.attr({"fill":f,"font-size":upro.view.mediators.ActiveRouteOverlayMediator.TEXT_HEIGHT,"text-anchor":"start"});
d.info.attr({"text":d.text});this.systems[g]=d;i.addSolarSystemTrack(g,e,this.onProjectionChanged.bind(this,g));}else{d.text+="\r\n"+c+": "+e.name;
d.info.attr({"text":d.text});}},createKey:function(a){return"RouteOverlay:"+a.id;},removeSystemOverlay:function(a){var c=this.facade().retrieveMediator(upro.view.mediators.SceneMediator.NAME);
var b=this.systems[a];if(b){delete this.systems[a];c.removeSolarSystemTrack(a,b.solarSystem);b.bracket.remove();b.info.remove();
}},onProjectionChanged:function(c,f,h){var e=this.systems[c];var b=f.getProjectedPosition();if(b){var d=this.facade().retrieveMediator(upro.view.mediators.HudMediator.NAME).getViewComponent();
var a=d.realToViewCoordinates(b);var g=upro.hud.Button.getOffset[2](0);e.bracket.attr({"transform":"T"+a.x+","+a.y});e.bracket.show();
e.info.attr({"x":a.x+g.x,"y":a.y+g.y});e.info.show();}else{e.bracket.hide();e.info.hide();}}});upro.view.mediators.ActiveRouteOverlayMediator.NAME="ActiveRouteOverlay";
upro.view.mediators.ActiveRouteOverlayMediator.TEXT_HEIGHT=15;upro.view.mediators.MainContextMenuMediator=Class.create(upro.view.mediators.AbstractContextMenuMediator,{initialize:function($super){$super(upro.view.mediators.MainContextMenuMediator.NAME,null);
},onRegister:function(){var f=this.getViewComponent();var e=this;var d=f.setSubMenu(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Routing),upro.res.text.Lang.format("routing.menuLabel"));
this.commandActiveRouteReset=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.ActiveRouteReset);
e.cancel();},upro.res.text.Lang.format("routing.clearRoute"));d.setCommand(3,this.createVectorIcon.bind(this,upro.res.menu.IconData.Delete),this.commandActiveRouteReset);
var b=d.setSubMenu(5,this.createVectorIcon.bind(this,upro.res.menu.IconData.List),upro.res.text.Lang.format("routing.rules.menuLabel"));
this.ruleCommands={};this.createRoutingRuleCommandSet(b,0,"MinSecurity",upro.res.menu.IconData.MinSecurity);this.createRoutingRuleCommandSet(b,1,"MaxSecurity",upro.res.menu.IconData.MaxSecurity);
this.createRoutingRuleCommandSet(b,2,"Jumps",upro.res.menu.IconData.Hash);this.createRoutingRuleCommandSet(b,5,"JumpFuel",upro.res.menu.IconData.Fuel);
var c=d.setSubMenu(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Capabilities),upro.res.text.Lang.format("routing.capabilities.menuLabel"));
this.commandRoutingCapJumpGates=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingCapJumpGatesToggle);
});c.setCommand(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.JumpGate),this.commandRoutingCapJumpGates);var a=c.setSubMenu(1,this.createVectorIcon.bind(this,upro.res.menu.IconData.JumpDrive),upro.res.text.Lang.format("routing.caps.jumpDrive.menuLabel"));
this.commandRoutingCapJumpDrive=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingCapJumpDriveToggle);
});a.setCommand(3,this.createVectorIcon.bind(this,upro.res.menu.IconData.Power),this.commandRoutingCapJumpDrive);this.commandRoutingCapJumpDriveMore=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingCapJumpDriveRangeStep,true);
});a.setCommand(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Higher),this.commandRoutingCapJumpDriveMore);this.commandRoutingCapJumpDriveLess=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingCapJumpDriveRangeStep,false);
});a.setCommand(1,this.createVectorIcon.bind(this,upro.res.menu.IconData.Lower),this.commandRoutingCapJumpDriveLess);},createRoutingRuleCommandSet:function(a,d,f,g){var c=upro.res.text.Lang.format("routing.rules.rule["+f+"].menuLabel");
var b=a.setSubMenu(d,this.createVectorIcon.bind(this,g),c);var e=this;this.ruleCommands[f]={};this.ruleCommands[f].more=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingRuleMore,f);
});b.setCommand(0,this.createVectorIcon.bind(this,upro.res.menu.IconData.Higher),this.ruleCommands[f].more);this.ruleCommands[f].less=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingRuleLess,f);
});b.setCommand(1,this.createVectorIcon.bind(this,upro.res.menu.IconData.Lower),this.ruleCommands[f].less);this.ruleCommands[f].toggle=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingRuleToggle,f);
});b.setCommand(3,this.createVectorIcon.bind(this,upro.res.menu.IconData.Power),this.ruleCommands[f].toggle);this.ruleCommands[f].up=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingRuleUp,f);
},upro.res.text.Lang.format("routing.rules.up"));b.setCommand(5,this.createVectorIcon.bind(this,upro.res.menu.IconData.Up),this.ruleCommands[f].up);
this.ruleCommands[f].down=new upro.hud.SimpleCommandAdapter(function(){e.notify(upro.app.Notifications.UserRoutingRuleDown,f);
},upro.res.text.Lang.format("routing.rules.down"));b.setCommand(4,this.createVectorIcon.bind(this,upro.res.menu.IconData.Down),this.ruleCommands[f].down);
},updateCommands:function(){this.updateCommandActiveRoute();this.updateCommandRoutingCapabilities();this.updateCommandRoutingRules();
},updateCommandActiveRoute:function(){var a=this.facade().retrieveProxy(upro.model.proxies.ActiveRouteProxy.NAME);this.commandActiveRouteReset.setPossible(!a.isEmpty());
},updateCommandRoutingCapabilities:function(){var e=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
var a;var d=upro.res.text.Lang.format("general.on");var c=upro.res.text.Lang.format("general.off");a=e.getRoutingCapJumpGatesInUse();
this.commandRoutingCapJumpGates.setActive(a);this.commandRoutingCapJumpGates.setLabel(upro.res.text.Lang.format("routing.caps.jumpGates.toggle",a?c:d));
var b=e.getRoutingCapJumpDriveRange();var g=b<upro.model.UserSettings.JumpDriveConstants.MaximumRange;var f=b>upro.model.UserSettings.JumpDriveConstants.MinimumRange;
a=e.getRoutingCapJumpDriveInUse();this.commandRoutingCapJumpDrive.setActive(a);this.commandRoutingCapJumpDrive.setLabel(upro.res.text.Lang.format("routing.caps.jumpDrive.toggle",a?c:d));
this.commandRoutingCapJumpDriveMore.setPossible(g);this.commandRoutingCapJumpDriveMore.setLabel(g?upro.res.text.Lang.format("routing.caps.jumpDrive.rangeSet",b,b+upro.model.UserSettings.JumpDriveConstants.RangeStep):upro.res.text.Lang.format("routing.caps.jumpDrive.rangeLimit",b));
this.commandRoutingCapJumpDriveLess.setPossible(f);this.commandRoutingCapJumpDriveLess.setLabel(f?upro.res.text.Lang.format("routing.caps.jumpDrive.rangeSet",b,b-upro.model.UserSettings.JumpDriveConstants.RangeStep):upro.res.text.Lang.format("routing.caps.jumpDrive.rangeLimit",b));
},updateCommandRoutingRules:function(h){if(!h){var f=this.facade().retrieveProxy(upro.model.proxies.UserSettingsProxy.NAME);
h=f.getRoutingRules();}for(var c=0;c<h.length;c++){var d=h[c];var j=this.ruleCommands[d.getRuleType()];var g=upro.model.UserRoutingRule.RuleConstants[d.getRuleType()];
if(j&&g){var b=upro.res.text.Lang.format("routing.rules.rule["+d.getRuleType()+"].menuLabel");var e=d.getParameter();var a=e<g.Maximum;
var k=e>g.Minimum;j.toggle.setActive(d.getInUse());j.toggle.setLabel(upro.res.text.Lang.format("routing.rules.toggle",b,upro.res.text.Lang.format(d.getInUse()?"general.off":"general.on")));
j.more.setPossible(a);j.more.setLabel(a?upro.res.text.Lang.format("routing.rules.rule["+d.getRuleType()+"].paramSet",(e*g.Factor).toFixed(g.Fixed),((e+g.Increment)*g.Factor).toFixed(g.Fixed)):upro.res.text.Lang.format("routing.rules.rule["+d.getRuleType()+"].paramLimit",(e*g.Factor).toFixed(g.Fixed)));
j.less.setPossible(k);j.less.setLabel(k?upro.res.text.Lang.format("routing.rules.rule["+d.getRuleType()+"].paramSet",(e*g.Factor).toFixed(g.Fixed),((e-g.Increment)*g.Factor).toFixed(g.Fixed)):upro.res.text.Lang.format("routing.rules.rule["+d.getRuleType()+"].paramLimit",(e*g.Factor).toFixed(g.Fixed)));
j.up.setPossible(c>0);j.down.setPossible(c<(h.length-1));}}},onNotifyActiveRoutePathChanged:function(){this.updateCommandActiveRoute();
},onNotifyUserRoutingCapabilitiesChanged:function(){this.updateCommandRoutingCapabilities();},onNotifyUserRoutingRulesChanged:function(a){this.updateCommandRoutingRules(a);
}});upro.view.mediators.MainContextMenuMediator.NAME="MainContextMenu";upro.app={};upro.app.Notifications={Startup:0,DebugMessage:0,SessionLogInRequest:0,SessionLoggedIn:0,SessionLoggedOut:0,SetActiveGalaxy:0,ActiveGalaxyChanged:0,SetHighlightedObject:0,HighlightedObjectChanged:0,ScenePointerActivation:0,ActiveRouteReset:0,ActiveRouteRemoveEntry:0,ActiveRouteAddCheckpoint:0,ActiveRouteAddWaypoint:0,ActiveRoutePathChanged:0,UserIgnoredSolarSystemsChanged:0,UserIgnoredSolarSystemIgnoreToggle:0,UserRoutingRulesChanged:0,UserRoutingRuleToggle:0,UserRoutingRuleMore:0,UserRoutingRuleLess:0,UserRoutingRuleUp:0,UserRoutingRuleDown:0,UserRoutingCapabilitiesChanged:0,UserRoutingCapJumpGatesToggle:0,UserRoutingCapJumpDriveToggle:0,UserRoutingCapJumpDriveRangeStep:0,NewCorridorPreparationChanged:0,NewCorridorSetExit:0,NewCorridorPrepareWormhole:0,NewCorridorPrepareJumpBridge:0};
(function(){for(var a in upro.app.Notifications){upro.app.Notifications[a]=a;}})();upro.app.ApplicationFacade=Class.create(Facade,{initialize:function($super){$super(upro.app.ApplicationFacade.NAME);
var b=upro.ctrl.cmd.getAllNotified();for(var a in b){this.registerCommand(a,b[a]);}},start:function(){this.sendNotification(upro.app.Notifications.Startup);
}});upro.app.ApplicationFacade.NAME="upro";upro.res={};upro.res.text={};upro.res.text.Util={format:function(d){var b=arguments;
var a=d;var c=function(e){return b[new Number(e.substr(1,e.length-2))+1];};return a.replace(/[{]\d+[}]/g,c);}};upro.res.text.Lang={defaultLang:"en",texts:{},setCurrentLanguage:function(d){var a=upro.res.text.templates;
var b=true;upro.sys.log("Setting language to: ["+d+"]");upro.res.text.Lang.texts={};if(!upro.res.text.Lang.copyMissingTextsFrom(a[d],false)){b=false;
}var c=d.indexOf("-");if(c>0){if(!upro.res.text.Lang.copyMissingTextsFrom(a[d.substr(0,c)],false)){b=false;}}if(!upro.res.text.Lang.copyMissingTextsFrom(a[upro.res.text.Lang.defaultLang],true)){b=false;
}if(!b){upro.sys.log("Some errors occured while setting language");}return b;},copyMissingTextsFrom:function(e,f){var a=upro.res.text.templates[upro.res.text.Lang.defaultLang];
var c=false;if(e){var b=upro.res.text.Lang.texts;c=true;for(var d in e){if(!a[d]){c=false;upro.sys.log("Container has an entry the default language has not: ["+d+"]");
}if(!b[d]){if(f){c=false;upro.sys.log("Container is missing entry for ["+d+"]");}b[d]=e[d];}}}return c;},format:function(d){var a;
var e=this.texts[d];if(e){var b=[e];for(var c=1;c<arguments.length;c++){b.push(arguments[c]);}a=upro.res.text.Util.format.apply(this,b);
}else{upro.sys.log("Unknown key ["+d+"] specified for text");a="ERROR: Missing Text for ["+d+"]";}return a;}};upro.res.eve={};
upro.res.eve.MapData={};upro.res.eve.MapData[9]={regionData:[],constellationData:[],solarSystemData:[],solarSystemJumpData:[]};
upro.res.eve.MapData[9000001]={regionData:[],constellationData:[],solarSystemData:[],solarSystemJumpData:[]};upro.res.eve.IconData={};
upro.res.eve.IconData.Amarr="M30.483,34.296c2.059,4.295,5.294,8.166,9.395,11.388c9.196-3.321,19.755-5.214,30.989-5.214"+"c10.811,0,20.994,1.759,29.944,4.852c4.06-3.292,7.223-7.23,9.193-11.594c-11.216-4.955-24.669-7.851-39.138-7.851"+"C55.853,25.877,41.944,28.993,30.483,34.296 M9.715,49.222C3.55,56.216,0,64.358,0,73.053c0,9.086,3.865,17.563,10.544,24.76"+"c-2.673-4.653-4.148-9.691-4.148-14.962c0-8.128,3.488-15.716,9.522-22.169C13.364,57.113,11.278,53.271,9.715,49.222"+"M141.732,73.053c0-9.18-3.952-17.741-10.767-24.99c-1.479,4.137-3.517,8.063-6.026,11.722"+"c6.567,6.637,10.397,14.556,10.397,23.065c0,5.271-1.477,10.309-4.146,14.962C137.87,90.616,141.732,82.137,141.732,73.053"+"M125.79,31.875c0-12.304-5.61-23.5-14.79-31.875c5.847,6.568,9.294,14.598,9.294,23.279"+"c0,22.189-22.464,40.182-50.175,40.182c-27.713,0-50.178-17.992-50.178-40.182c0-8.681,3.448-16.711,9.294-23.279"+"c-9.178,8.375-14.792,19.571-14.792,31.875c0,22.837,19.318,41.861,44.915,46.092l-0.003,0.003c0,0,2.849,0.401,5.348,4.448"+"c3.763,6.1,5.398,11.395,5.398,11.395s1.632-5.295,5.398-11.395c2.382-3.862,5.055-4.396,5.297-4.438"+"C106.434,73.775,125.79,54.735,125.79,31.875";
upro.res.eve.IconData.Caldari="M70.866,0C31.728,0,0,31.727,0,70.866c0,39.139,31.728,70.866,70.866,70.866c39.139,0,70.867-31.728,70.867-70.866"+"C141.732,31.727,110.005,0,70.866,0 M53.23,62.03c3.244-6.462,9.914-10.908,17.636-10.908c10.904,0,19.744,8.84,19.744,19.743"+"c0,10.903-8.84,19.743-19.744,19.743c-7.722,0-14.392-4.445-17.636-10.907l-14.51,4.782c5.307,12.511,17.702,21.286,32.146,21.286"+"c13.471,0,25.139-7.644,30.958-18.819l13.883,5.397c-8.016,16.7-25.081,28.229-44.841,28.229"+"c-27.455,0-49.712-22.257-49.712-49.712c0-27.455,22.257-49.712,49.712-49.712c19.76,0,36.826,11.529,44.841,28.229l-13.883,5.398"+"c-5.819-11.176-17.487-18.819-30.958-18.819c-14.444,0-26.839,8.775-32.146,21.286L53.23,62.03z";
upro.res.eve.IconData.Gallente="M0,0v169.424l70.864,33.801l70.868-33.801V0H0z M111.755,80.536c3.258,3.461,6.059,4.169,6.924,4.226"+"c0.865,0.048-3.399,1.496-8.655-0.866c-1.017-0.459-2.496-1.581-2.496-1.581s-0.024,4.942,4.073,11.049"+"c4.57,6.808,7.205,7.995,8.755,8.76c1.888,0.927-4.846,0.442-10.385-2.954c-4.477-2.752-5.596-5.4-5.596-5.4"+"s-0.858,3.745,1.831,11.103c1.87,5.113,5.729,11.499,11.685,15.766c3.583,2.567-7.611,0.181-13.516-6.948"+"c-5.908-7.126-5.704-10.038-5.704-10.038s-1.989,3.737-1.779,9.694c0.149,4.315,1.488,8.323,3.436,11.149"+"c2.751,3.994-2.865,0.345-7.562-5.687c-3.743-4.817-4.121-8.593-4.121-8.593s-1.229,2.204-1.526,3.857"+"c-0.308,1.681-0.232,2.94,0.073,3.816c0.308,0.878-2.594-1.985-4.082-4.77c-1.215-2.277-1.946-5.156-1.946-5.156"+"s-2.76,5.173-1.986,7.29c1.22,3.361,2.287,2.903,3.815,5.501c1.526,2.595,1.526,3.815,3.055,6.413"+"c1.529,2.595,2.598,4.43,4.582,4.735c1.053-1.922,1.981-1.986,3.92-1.986c3.207,0,5.805,4.174,5.805,7.89"+"c0,0.809-0.096,1.586-0.272,2.318c-0.749-2.084-1.508-4.252-4.261-5.168c0.98,1.114,1.666,3.415,1.666,5.434"+"c0,2.084-0.242,3.729-2.429,5.154c0.226-0.728,0.562-1.818,0.562-2.646c0-3.656-1.582-5.699-4.891-6.457"+"c-1.897,0-3.434,1.983-3.434,4.432c0,0.413,0.04,0.814,0.121,1.191c-0.773-0.83-1.288-2.335-1.288-4.055"+"c0-1.964,0.671-3.643,1.632-4.367c0,0-2.17-3.113-4.31-4.946c-1.926-1.654-3.735-1.841-6.419-4.533"+"c1.065,2.233,2.25,6.131,2.225,12.369c-0.036,8.248-1.547,11.257-2.189,12.425c-0.561,1.016-0.356-2.905-0.712-5.397"+"c-0.304-2.139-1.733-5.241-2.601,2.138c-0.48,4.111-2.646,9.623-3.052,9.623c-0.46,0-2.137-6.413-2.594-9.623"+"c-0.46-3.205-0.532-6.39-1.221-5.498c-1.937,2.493,0,6.873-1.681,4.734c-1.417-1.799-1.173-7.483-0.867-13.438"+"c0.203-3.954,0.845-6.799,1.264-8.29c-3.206,3.657-5.188,3.661-7.324,5.491c-2.137,1.833-4.306,4.946-4.306,4.946"+"c0.959,0.725,1.631,2.403,1.631,4.367c0,1.72-0.518,3.225-1.289,4.055c0.08-0.377,0.123-0.778,0.123-1.191"+"c0-2.448-1.538-4.432-3.437-4.432c-3.309,0.758-4.888,2.801-4.888,6.457c0,0.828,0.331,1.919,0.561,2.646"+"c-2.19-1.425-2.428-3.07-2.428-5.154c0-2.019,0.683-4.319,1.663-5.434c-2.751,0.916-3.509,3.084-4.259,5.168"+"c-0.178-0.732-0.272-1.51-0.272-2.318c0-3.716,2.6-7.89,5.801-7.89c1.943,0,2.87,0.064,3.923,1.986"+"c1.986-0.306,3.055-2.141,4.581-4.735c1.528-2.598,1.528-3.818,3.055-6.413c1.526-2.598,2.595-2.14,3.818-5.501"+"c0.771-2.117-1.985-7.29-1.985-7.29s-0.732,2.879-1.949,5.156c-1.487,2.784-4.389,5.647-4.084,4.77"+"c0.307-0.876,0.383-2.136,0.079-3.816c-0.3-1.653-1.527-3.857-1.527-3.857s-0.379,3.775-4.125,8.593"+"c-4.696,6.031-10.311,9.681-7.559,5.687c1.948-2.826,3.282-6.834,3.436-11.149c0.21-5.957-1.78-9.694-1.78-9.694"+"s0.203,2.912-5.704,10.038c-5.905,7.129-17.099,9.516-13.517,6.948c5.956-4.267,9.814-10.652,11.683-15.766"+"c2.693-7.358,1.833-11.103,1.833-11.103s-1.119,2.648-5.598,5.4c-5.54,3.396-12.27,3.881-10.387,2.954"+"c1.552-0.765,4.185-1.952,8.756-8.76c4.1-6.107,4.074-11.049,4.074-11.049s-1.475,1.122-2.498,1.581"+"c-5.253,2.362-9.518,0.914-8.652,0.866c0.868-0.056,3.667-0.765,6.922-4.226c2.347-2.49,3.106-6.869,3.106-6.869"+"s-1.835,0.558-7.332-1.072c-5.519-1.635-6.058-4.733-5.192-3.921c0.867,0.815,3.359,1.12,9.061,0.97"+"c3.974-0.107,6.059-2.039,6.059-2.039s-3.855-1.833-5.842-4.086c-4.614-5.235-3.397-5.537-2.062-5.036"+"c1.521,0.559,4.696,0.418,4.696,0.418h11.683c4.514,0,8.172,2.494,8.172,5.577c0,1.427-0.791,2.731-2.088,3.72"+"c-3.166,2.402-5.86,5.025-5.86,8.656c0,5.696,5.744,10.309,12.829,10.309c5.497,0,4.979-3.589,5.403-5.911"+"c0.906-4.954,4.549-6.12,7.737-7.942c2.047-1.17-1.861-4.635-3.855-5.36c-1.678-0.612-3.602-2.177-3.971-6.032"+"c-0.331-3.489-3.208-2.519-3.208-2.519c0-1.426,2.293-3.935,5.944-3.6c3.042,0.276,6.719,4.477,10.796,6.309"+"c4.071,1.832,4.273,2.04,7.939,1.427c3.667-0.609-2.853,3.26-4.278,3.055c-1.423-0.201,0.05,5.616-1.159,6.44"+"c-0.838,0.573-2.712-1.348-2.712,5.781c0,7.125,8.688,8.353,8.688,8.353c7.083,0,12.829-4.613,12.829-10.309"+"c0-3.63-2.694-6.254-5.863-8.656c-1.298-0.988-2.088-2.292-2.088-3.72c0-3.083,3.66-5.577,8.173-5.577h11.684"+"c0,0,3.177,0.141,4.695-0.418c1.337-0.5,2.552-0.199-2.063,5.036c-1.984,2.253-5.839,4.086-5.839,4.086s2.084,1.931,6.057,2.039"+"c5.704,0.149,8.195-0.155,9.065-0.97c0.862-0.812,0.32,2.287-5.195,3.921c-5.499,1.63-7.334,1.072-7.334,1.072"+"S109.409,78.045,111.755,80.536";
upro.res.eve.IconData.Minmatar="M112.727,14.19L82.745,69.283c-5.087-4.35-11.397-6.926-18.234-6.926c-16.848,0-30.507,15.643-30.507,34.94"+"c0,13.53,7.927,24.501,17.206,30.84c8.531,5.829,18.532,8.477,29.511,8.477c33.695,0,61.012-28.25,61.012-63.098"+"C141.732,49.158,130.313,27.568,112.727,14.19 M65.053,54.267c5.418,0,10.604,1.058,15.388,2.991l25.272-47.77"+"C95.424,3.448,83.533,0,70.865,0c-8.779,0-17.184,1.661-24.943,4.689l16.473,49.673C63.275,54.305,64.16,54.267,65.053,54.267"+"M53.351,55.982L37.629,8.576C23.297,16.487,11.891,29.351,5.541,44.971l29.92,21.715C40.469,61.717,46.576,57.998,53.351,55.982"+"M29.668,73.721L2.524,54.02C0.881,60.229,0,66.765,0,73.516c0,7.693,1.145,15.108,3.258,22.078h18.574"+"C22.662,87.491,25.446,80.021,29.668,73.721 M21.732,104.688H6.68c7.765,17.178,21.738,30.734,38.932,37.539"+"C32.411,135.173,23.048,121.157,21.732,104.688";
upro.res.eve.IconData.Guristas="M115.156,165.424c4.61-4.099,4.61-2.689,6.403-4.482s5.507-2.689,6.66-4.227c1.153-1.536,1.024-2.305,1.921-2.305"+"s1.537,0.769,2.689-0.513c1.153-1.28,2.562-2.689,2.562-4.098c0-1.409,0.512-5.508,0.512-6.532s1.793-8.58,1.793-10.63"+"c0-2.049-0.256-5.25-1.409-5.25c-1.153,0-3.202,0.256-3.33,1.152c-0.128,0.896-2.049,6.147-2.305,8.324"+"c-0.256,2.177-1.409,4.867-2.945,5.507c-1.537,0.641-5.251,0-6.788-0.256c-1.537-0.256-4.227,0.256-4.611,1.537"+"c-0.384,1.28,0.512,2.049,0.384,2.945c-0.128,0.896-1.537,3.714-1.921,5.251c-0.384,1.536-0.896,3.714-0.896,4.866"+"c0,1.153,0.256,4.227-2.049,4.354c-2.305,0.128-2.817-3.073-2.817-4.098c0-1.025-0.769-2.946-2.049-2.946"+"c-1.281,0-3.202,1.921-3.971,2.306c-0.769,0.384-3.074,0.769-3.074,1.409c0,0.64,0.256,1.792-0.384,1.664"+"c-0.64-0.128-2.548-5.46-4.61-6.147c-0.384-0.128,0.769,9.478-1.195,7.771c-1.455-1.266,0.171-4.867-1.238-4.952"+"c-1.023-0.063-2.178,0.64-3.586,0.64c-1.409,0-2.562-1.024-3.202-1.024c-0.641,0-2.049,0.385-2.818,0.128"+"c-0.768-0.256-1.793-1.28-2.433-1.152c-0.641,0.128-1.025,0.256-1.665-0.256c-0.64-0.513-0.512-2.178-1.024-1.409"+"s-1.281,1.793-1.281,2.689s-0.128,2.05-0.512,2.817c-0.384,0.769-2.434,3.714-2.434,4.61s-1.409,2.178-1.281,3.074"+"s0.896,1.024,0.896,1.665c0,0.64-0.512,1.921,0.128,2.562c0.64,0.64,1.921,1.536,2.817,1.793c0.896,0.256,1.921-0.513,2.433,0.128"+"c0.513,0.641,1.665,1.024,4.482,3.586c2.818,2.562,3.714,3.97,4.739,4.738c1.024,0.769,2.689,0.128,3.202,0.769"+"s1.665,0.896,2.049,0.896s1.665-0.513,2.433-0.513s3.97,1.024,4.482,0.513c0.513-0.513,4.098-4.995,5.251-6.66"+"c1.153-1.664,4.354-4.482,5.379-5.25C111.57,169.651,115.156,165.424,115.156,165.424z"+"M141.708,99.553c-0.17-3.67-0.825-6.145-1.793-7.342c-1.793-2.22-8.709-8.965-12.039-11.441"+"c-3.33-2.476-9.135-6.916-10.331-6.831c-1.195,0.086-3.072,2.22-2.988,3.501c0.085,1.28,0.683,1.708,0.085,2.476"+"c-0.598,0.768-3.416,2.988-3.074,1.792c0.341-1.195,2.049-1.622,2.22-2.903c0.17-1.281,0.598-8.708,1.195-10.928"+"c0.599-2.22,1.452-9.904,2.049-14.088c0.597-4.184,1.879-14.6,2.049-18.784c0.171-4.183,0.342-11.355-0.17-14.514"+"s-3.416-10.501-6.746-13.832c-3.33-3.33-11.44-6.745-16.393-6.66c-4.952,0.085-21.602,2.989-26.382,5.55"+"c-4.781,2.562-22.882,8.965-16.649,9.392s15.966-2.049,19.21-1.963c3.245,0.085,9.136-1.281,12.209,0.256"+"c3.074,1.537,5.721,3.245,6.062,5.977c0.341,2.732,2.647,11.014,3.927,18.357c1.281,7.342,5.636,36.115,4.696,36.201"+"c-0.939,0.085-8.453,0.427-11.014,1.281c-2.562,0.854-11.44,5.123-14.344,9.477c-2.903,4.354-6.403,11.441-6.831,13.832"+"c-0.427,2.391-0.784,5.263-1.451,7.599c-1.025,3.586-5.236,6.082-4.867,6.574c1.024,1.366,0.704,1.857,0.96,3.138"+"c0.256,1.281,1.473,3.266,2.817,4.419c1.345,1.152,4.291,5.059,4.354,4.354c0.064-0.704-1.281-3.266-1.729-4.29"+"s-2.497-4.098-2.241-4.482c0.256-0.384-0.896-1.237-0.704-0.533c0.192,0.704,1.024,3.073,0.64,2.348"+"c-0.445-0.841-1.387-3.18-0.939-2.988c0.448,0.192,2.284,0.277,2.668,0.726s3.458,3.01,4.674,3.586s3.074,0.896,3.714,1.473"+"c0.64,0.576,3.437,1.516,2.732,2.541c-0.705,1.024-3.564,0.276-5.102,1.493c-1.537,1.217-2.604,2.711-3.564,2.903"+"c-0.961,0.192-3.957,2.313-3.928,3.82c0.043,2.242,2.049,5.06,3.586,6.725c1.028,1.113,3.65,3.905,2.946,2.688"+"s-1.857-2.882-2.498-3.714c-0.64-0.833-1.344-1.217-0.768-1.921c0.576-0.705,5.123-2.625,5.379-1.537"+"c0.256,1.089,0.576,2.369,0.64,4.162s0.128,4.931,0.256,6.852s-0.064,3.33,0.256,3.906c0.32,0.576,1.152,0.769,1.985,0.769"+"s1.088,0.128,1.088-0.192s0.256-0.832,0.705-0.832s0.896,1.665,1.024,1.985c0.128,0.319,1.473,0.256,2.177,0.256"+"s1.665,0,1.857-0.192c0.192-0.191,0.32-0.576,1.024-0.512c0.705,0.063,0.577,0.576,0.896,0.896c0.32,0.32,2.455,0.17,3.181,0.148"+"c2.306-0.066,3.671,0.257,3.671-0.341s-0.427-3.244,0.341-3.244c0.769,0,2.477-0.769,3.159-0.342"+"c0.683,0.427,1.537,1.792,2.049,2.902s1.556,4.558,2.049,4.014c1.622-1.793,1.366-6.063,2.22-6.745c0,0,0.956-0.766,1.793-0.598"+"c2.988,0.598,3.03,2.817,3.799,2.817c0,0,3.581,0.008,4.141-0.854c0.555-0.854,2.348-5.721,1.879-5.807"+"c-0.939-0.172-3.245,0-3.757,0.769c-0.512,0.769-3.095,2.194-3.329,1.708c-0.556-1.152,1.963-3.629,1.066-3.629"+"c0,0-2.774-2.049-4.183-3.244s-5.892-4.226-4.141-4.226s3.245,0.981,3.757,1.622c0.512,0.64,2.476,2.434,3.373,1.921"+"s2.519-3.501,3.33-3.287c0.811,0.214,0.982,1.109,2.091,1.109c1.111,0,1.281-0.938,2.135-0.938c0.854,0,7.513,0.341,8.879-0.769"+"c1.366-1.11,2.732-2.135,2.732-2.562s1.537-1.452,1.878-0.598c0.342,0.854,0.683,0.684,0.171,1.708s-1.556,4.873-3.586,5.549"+"c-2.049,0.683-3.586,1.281-5.208,1.366c0,0-3.757,0.939-2.477,0.939s2.646-0.341,4.013-0.427c1.366-0.086,4.696-0.342,5.464-1.024"+"c0.768-0.684,1.792-3.672,2.39-4.782c0.598-1.109,1.647-2.736,1.452-3.756c-0.427-2.22-2.39-4.439-2.39-5.806"+"s5.643-6.451,7.769-8.453c1.452-1.366,3.928-4.098,4.439-5.464C139.915,108.69,141.978,105.356,141.708,99.553z M82.69,131.934"+"c0.064,1.089,0,0.513,0,1.089s-0.649,1.487-0.769,2.369c-0.32,2.369-0.448,2.369-2.241,2.562"+"c-0.989,0.105-2.305-2.241-2.433-2.882c-0.128-0.64,0.672-0.926,0.832-2.049c0.256-1.793,1.409-2.689,1.857-3.33"+"s-0.448-0.704-0.512-1.408c-0.064-0.705,0.769-0.769,1.729-0.705c0.961,0.064,1.601,2.497,1.921,2.946"+"C83.394,130.973,82.618,130.719,82.69,131.934z M95.625,12.766c-3.138-3.778-9.733-3.138-15.497-3.138s15.561-1.921,18.954-1.729"+"c3.394,0.192,5.571,4.547,10.246,10.758c4.674,6.211,3.202,12.231,2.945,18.506s-1.665,28.111-1.985,32.273"+"s-0.448,10.758-1.665,11.398s-6.083-4.034-6.468-4.738c-0.384-0.705-0.646-8.138-1.216-13.96"+"c-0.641-6.531-0.577-5.314-0.961-9.989c-0.384-4.674,1.793,6.468,2.177,8.837s1.665,11.014,2.306,12.679"+"c0.64,1.665,1.409,0.705,2.561-1.665c1.153-2.37,0.769-13.64,0.705-24.206c-0.064-10.565-0.32-19.851-0.32-20.363"+"s-1.601-0.448-3.394-2.689C102.22,22.499,98.763,16.544,95.625,12.766z M92.872,136.417c-0.449,0.32-0.449,2.178-1.473,2.625"+"c-1.024,0.449-1.985,0.129-2.562-0.447c-0.576-0.577-1.601-1.217-2.625-1.922c-1.025-0.704-0.738-2.183-0.577-4.61"+"c0.064-0.96-0.128-1.985-0.576-2.817s-0.576-1.601,0-2.177s1.665,0.64,2.177,1.152c0.512,0.513,3.266,3.649,4.931,5.571"+"C93.832,135.712,93.32,136.096,92.872,136.417z M114.729,129.607c-0.513,0-6.489,0-7.001-0.17"+"c-0.512-0.171-3.415-0.171-4.439-0.171c-1.025,0-2.049-1.024-2.903-2.22c-0.854-1.196-3.928-2.22-6.66-3.074"+"c-2.732-0.854-4.952-3.073-5.635-3.244c-0.683-0.171,1.537-1.195,2.903-2.049c1.366-0.854,4.346-3.176,7.684-6.147"+"c3.309-2.945,1.494-1.28,2.583-2.753c1.088-1.474,1.985-3.074,3.522-4.995s4.354-4.419,6.212-4.419"+"c1.857,0,2.753,2.434,3.585,3.522c0.833,1.089,1.537,3.201,2.306,4.482c0.769,1.28-1.857-2.241-2.369-3.202"+"c-0.513-0.96-2.049-2.561-3.971-2.817c-1.921-0.256-3.97,2.049-4.695,2.839c-0.673,0.733,3.927,0.939,5.293,4.781"+"c0.54,1.518,1.708,3.586,2.391,4.269c0.684,0.684,0.512,4.099,0.512,4.782s0.854-0.171,1.024-1.196"+"c0.171-1.024,0.513,1.537,0.513,2.392c0,0.854-1.196,2.219-1.537,3.073c-0.341,0.854-1.537,4.781-2.562,5.293"+"c-1.024,0.513,2.049,0.172,3.244-0.341c1.195-0.513,3.757-4.61,4.269-5.465C119.51,121.923,115.241,129.607,114.729,129.607z"+"M72.551,60.109c-2.347-7.895-7.257-17.844-10.501-20.577s-6.489-3.159-8.708-4.61c-2.22-1.451-5.55-3.159-7.001-3.159"+"c-1.452,0-7.429,1.11-10.332,1.537c-2.903,0.427-7.854,1.708-11.526,2.647c-3.671,0.939-5.977,2.647-7.343,3.074"+"s-4.61,0.769-4.952,1.11c-0.341,0.341-1.195,1.281-2.134,1.708c-0.939,0.427-7.94,2.647-8.965,3.842s-1.708,4.184-0.256,5.038"+"c1.452,0.854,4.781,0.256,6.745-0.256s5.123-0.769,9.648-1.024c4.525-0.256,9.904-0.171,12.38,0.085"+"c2.476,0.256,7.855,0.342,11.27,1.879c3.416,1.537,7.428,5.806,10.502,9.904s7.77,9.05,10.587,12.209"+"c2.817,3.159,10.7,10.108,10.587,8.538c-0.085-1.195-3.897-5.065-4.696-5.891c-2.476-2.562-4.696-6.233-3.586-5.294"+"c1.11,0.939,3.671,3.843,4.525,4.44c0.854,0.598,2.22,0.171,1.195-1.622c-1.025-1.793-4.269-10.587-6.147-15.027"+"s-3.33-9.05-4.781-10.843s-3.671-4.184-4.354-3.415c-0.683,0.769-3.756,3.842-3.756,2.817s0-3.244-1.537-4.184"+"c-1.537-0.939-2.476-1.281-3.671-1.024s-2.305,0.341-2.903,1.195s-2.562,0.512-1.708,1.451c0.854,0.939,2.135,2.305,0.427,2.135"+"c-1.708-0.171-2.817-1.11-3.842-1.195c-1.025-0.085-1.878-0.769-2.562-1.024c-0.683-0.256-0.683,0.683-2.049,0.683"+"s-1.622-0.598-2.22-0.598s-0.769,0.769-1.708,0.769c-0.939,0-1.024-1.024-1.793-1.024s-1.452,0.939-3.074,1.11"+"s-5.72,0.256-7.001,1.11c-1.281,0.854-9.904,1.281-4.184-0.854c5.72-2.135,8.794-4.184,11.611-5.038s8.794-3.5,10.929-3.757"+"c2.135-0.256,6.403-1.366,8.879-0.683s7.599,3.33,9.989,4.611c2.391,1.281,6.489,3.927,9.819,12.039"+"c3.33,8.111,7.599,19.979,8.368,21.857c0.768,1.878,1.792,4.696,2.732,4.44c0.939-0.256,2.22-1.281,2.22-2.732"+"S74.429,66.427,72.551,60.109z";
upro.res.menu={};upro.res.menu.IconData={};upro.res.menu.IconData.Yes="M11.941,25.754L0,13.812L5.695,8.117L11.941,14.363L26.305,0L32,5.695L11.941,25.754z";
upro.res.menu.IconData.No="M28,22.398L19.594,14L28,5.602L22.398,0L14,8.402L5.598,0L0,5.602L8.398,14L0,22.398L5.598,28L14,19.598L22.398,28z";
upro.res.menu.IconData.Left="M15.984,32l5.672-5.672c0,0-3.18-3.18-6.312-6.312H32v-8.023H15.344l6.312-6.32L15.984,0L0,16L15.984,32z";
upro.res.menu.IconData.Right="M16.016,0l-5.668,5.672c0,0,3.18,3.18,6.312,6.312H0v8.023h16.66l-6.316,6.319l5.672,5.672L32,16L16.016,0z";
upro.res.menu.IconData.Up="M0,15.984l5.672,5.667c0,0,3.18-3.178,6.312-6.315v16.669h8.023V15.336l6.32,6.325L32,15.984L16,0L0,15.984z";
upro.res.menu.IconData.Down="M32,16.016l-5.672-5.664c0,0-3.18,3.18-6.312,6.312V0h-8.023v16.664l-6.32-6.32L0,16.016L16,32L32,16.016z";
upro.res.menu.IconData.Minus="M0,0L32,0L32,8L0,8z";upro.res.menu.IconData.Plus="M32,12L20,12L20,0L12,0L12,12L0,12L0,20L12,20L12,32L20,32L20,20L32,20z";
upro.res.menu.IconData.Denied="M16,0C7.164,0,0,7.164,0,16s7.164,16,16,16s16-7.164,16-16S24.836,0,16,0z M16,4"+"c2.59,0,4.973,0.844,6.934,2.242L6.238,22.93C4.84,20.969,4,18.586,4,16C4,9.383,9.383,4,16,4z M16,28"+"c-2.59,0-4.973-0.844-6.934-2.242L25.762,9.07C27.16,11.031,28,13.414,28,16C28,22.617,22.617,28,16,28z";
upro.res.menu.IconData.List="m 8.25,0.5 v 2 h 20 v -2 h -20 z m 0,12 h 20 v -2 h -20 v 2 z m 0,10 h 20 v -2 h -20 v 2 z m -8,4 "+"h 6 v -6 h -6 v 6 z m 0,-10 h 6 v -6 h -6 v 6 z m 0,-10 h 6 v -6 h -6 v 6 z";
upro.res.menu.IconData.Power="M 221.34821,488.74825 C 99.10258,488.74826 -0.1205327,389.52341 -0.1205357,267.2795 -0.1205367,206.39399 "+"24.592184,151.33727 64.410714,111.31075 l 0.1875,0.1875 c 8.04967,-11.1131 21.05123,-18.406266 "+"35.812496,-18.406246 24.44877,0 44.3125,19.832356 44.3125,44.281246 0,14.99209 -7.49714,28.20383 "+"-18.90625,36.21875 l 0.15625,0.15625 c -23.9259,24.09666 -38.906246,56.9975 -38.906246,93.53125 0,73.70089 "+"60.110436,133.53125 134.156246,133.53125 74.04582,1e-5 134.125,-59.83035 134.125,-133.53125 -10e-6,-33.34259 "+"-12.54037,-63.57981 -32.90625,-86.9375 -12.11468,-7.90659 -20.18749,-21.52681 -20.1875,-37.0625 0,-24.44889 "+"19.86373,-44.312517 44.3125,-44.312497 11.95254,0 22.74833,4.826587 30.71875,12.531247 l 0.625,-0.625 "+"c 40.05216,40.05678 64.87499,95.31901 64.875,156.40625 3e-5,122.2439 -99.19186,221.46876 -221.4375,221.46875 z "+"m -0.0312,-219.9375 c -24.5374,0 -44.28125,-20.10236 -44.28125,-45.09375 l 0,-178.656246 c 0,-24.99139 "+"19.74384,-45.09374939 44.28125,-45.09374939 24.5374,0 44.31251,20.10232939 44.3125,45.09374939 l 0,178.656246 "+"c 0,24.99139 -19.77511,45.09375 -44.3125,45.09375 z";
upro.res.menu.IconData.SolarSystem="M16,8c-4.422,0-8,3.582-8,8s3.578,8,8,8c4.414,0,8-3.582,8-8S20.414,8,16,8L16,8z"+"M18,2c0,1.105-0.898,2-2,2c-1.109,0-2-0.895-2-2s0.891-2,2-2C17.102,0,18,0.895,18,2z"+"M2,13.998c1.102,0,2,0.896,2,2c0,1.108-0.898,2-2,2c-1.109,0-2-0.893-2-2C0,14.893,0.891,13.998,2,13.998z"+"M14,29.998c0-1.105,0.891-2,2-2c1.109,0.002,2,0.895,2,2C18,31.105,17.109,32,16,32S14,31.105,14,29.998z"+"M24.594,27.414c-0.781-0.781-0.781-2.045,0-2.828c0.781-0.781,2.047-0.781,2.828,0c0.789,0.783,0.789,2.047,0,2.828C26.641,28.197,25.375,28.197,24.594,27.414z"+"M29.995,17.998C28.898,17.998,28,17.104,28,16c0-1.109,0.898-2,2.008-2c1.097,0,2,0.893,1.987,1.998C32.008,17.105,31.104,18,29.995,17.998z"+"M27.422,7.417c-0.781,0.779-2.047,0.779-2.828,0c-0.781-0.786-0.781-2.047,0-2.831c0.781-0.779,2.047-0.781,2.828,0.002C28.211,5.37,28.211,6.637,27.422,7.417z";
upro.res.menu.IconData.Delete=upro.res.menu.IconData.No;upro.res.menu.IconData.Routing="M28,18.07V2c0,0,0-1-1-1c-0.717,0-0.917,0.51-0.975,0.801C22.817,1.341,21.738,3,19,3c-3,0-5-1.013-5-1.013v7.821"+"c0,0,2,1.191,5,1.191c2.73,0,3.812-1.65,7-1.193v8.263c-1.723,0.224-3,0.999-3,1.93c0,0.164,0.051,0.32,0.125,0.473l-11.424,4.569"+"C10.458,24.396,8.812,24,7,24c-3.867,0-7,1.791-7,4s3.133,4,7,4s7-1.791,7-4c0-0.536-0.188-1.047-0.522-1.514l11.753-4.701"+"C25.766,21.918,26.361,22,27,22c2.21,0,4-0.896,4-2C31,19.069,29.723,18.294,28,18.07z";
upro.res.menu.IconData.Checkpoint="M17.07,2.93c-3.906-3.906-10.234-3.906-14.141,0c-3.906,3.904-3.906,10.237,0,14.141"+"C2.93,17.07,10,24,10,32c0-8,7.07-14.93,7.07-14.93C20.977,13.167,20.977,6.833,17.07,2.93z M10,14.005c-2.211,0-4-1.789-4-4"+"s1.789-4,4-4s4,1.789,4,4S12.211,14.005,10,14.005z";
upro.res.menu.IconData.Waypoint="M10,4c1.602,0,3.109,0.625,4.242,1.76C15.375,6.891,16,8.398,16,10s-0.625,3.109-1.734,4.213"+"c-0.164,0.166-2.234,2.224-4.266,5.441c-2.023-3.211-4.086-5.261-4.242-5.415C4.625,13.109,4,11.602,4,10s0.625-3.109,1.758-4.242"+"S8.398,4,10,4 M10,0C7.438,0,4.883,0.977,2.93,2.93c-3.906,3.904-3.906,10.237,0,14.141C2.93,17.07,10,24,10,32"+"c0-8,7.07-14.93,7.07-14.93c3.906-3.904,3.906-10.237,0-14.141C15.117,0.977,12.558,0,10,0L10,0z"+"M12,10c0,1.105-0.896,2-2,2c-1.109,0-2-0.895-2-2s0.891-2,2-2C11.104,8,12,8.895,12,10z";
upro.res.menu.IconData.WormholeIn="M15.067,2.25c-5.979,0-11.035,3.91-12.778,9.309h3.213c1.602-3.705,5.271-6.301,9.565-6.309"+"c5.764,0.01,10.428,4.674,10.437,10.437c-0.009,5.764-4.673,10.428-10.437,10.438c-4.294-0.007-7.964-2.605-9.566-6.311"+"H2.289c1.744,5.399,6.799,9.31,12.779,9.312c7.419-0.002,13.437-6.016,13.438-13.438C28.504,8.265,22.486,2.252,15.067,2.25z"+"M10.918,19.813l7.15-4.126l-7.15-4.129v2.297H-0.057v3.661h10.975V19.813z";
upro.res.menu.IconData.WormholeOut="m 22.474483,18.679126 c -1.805,3.113 -5.163,5.212 -9.023,5.219 -5.766,-0.01 -10.427,-4.672 -10.438,-10.435 "+"0.011,-5.7659998 4.672,-10.4269998 10.438,-10.4379998 3.859,0.007 7.216,2.105 9.022,5.218 l 3.962,2.2839998 "+"0.143,0.082 c -1.311,-6.0499998 -6.686,-10.58399976 -13.127,-10.58599976 -7.423,0.002 -13.43799997,6.01699996 "+"-13.43899997,13.43999976 0.002,7.42 6.01699997,13.435 13.43899997,13.437 6.442,-0.002 11.819,-4.538 "+"13.127,-10.589 l -0.141,0.081 -3.963,2.287 z m 4.314,-5.216 -7.15,-4.1289998 v 2.2969998 h -10.975 "+"v 3.661 h 10.975 v 2.297 l 7.15,-4.126 z";
upro.res.menu.IconData.View="M16,0C7.164,0,0,11.844,0,11.844S7.164,24,16,24s16-12.156,16-12.156S24.836,0,16,0z M16,20c-4.418,0-8-3.583-8-8"+"s3.582-8,8-8s8,3.583,8,8S20.418,20,16,20z M16,8.016A4,4 0 1,0 16.01,8.016z";
upro.res.menu.IconData.Galaxy="M21.174,13.98l5.689-9.664C24.008,1.659,20.209,0,16,0c-0.999,0-1.965,0.12-2.913,0.293L21.174,13.98z"+"M19.951,20h11.482C31.768,18.715,32,17.391,32,16c0-3.873-1.432-7.377-3.723-10.145L19.951,20z"+"M16.5,10l-5.408-9.152C6.592,2.307,2.953,5.646,1.188,10H16.5z"+"M15.633,22l5.393,9.115c4.447-1.48,8.037-4.799,9.787-9.115H15.633z"+"M12.105,12H0.566C0.233,13.285,0,14.609,0,16c0,3.891,1.445,7.41,3.756,10.186L12.105,12z"+"M10.918,17.961l-5.745,9.756C8.027,30.354,11.809,32,16,32c1.041,0,2.055-0.117,3.041-0.307L10.918,17.961z";
upro.res.menu.IconData.JumpCorridor="M28,24c-0.974,0-1.833,0.391-2.523,0.964l-6.102-4.35C19.766,19.817,20,18.942,20,18c0-1.292-0.422-2.489-1.117-3.464"+"l7.133-7.138C26.609,7.745,27.261,8,28,8c2.211,0,4-1.789,4-4s-1.789-4-4-4s-4,1.789-4,4c0,0.739,0.25,1.391,0.602,1.984"+"l-7.133,7.136C16.484,12.417,15.297,12,14,12c-2.289,0-4.258,1.302-5.271,3.192l-4.815-1.609C3.719,12.683,2.953,12,2,12"+"c-1.109,0-2,0.896-2,2s0.891,2,2,2c0.5,0,0.953-0.203,1.305-0.511l4.789,1.597C8.047,17.386,8,17.688,8,18c0,3.312,2.688,6,6,6"+"c1.648,0,3.141-0.667,4.229-1.745l6.06,4.323C24.117,27.023,24,27.495,24,28c0,2.208,1.789,4,4,4s4-1.792,4-4S30.211,24,28,24z";
upro.res.menu.IconData.Bridge="m171.939316,75.986969l0.270569,33.08075l97.171341,0l0.25,-60.847931c-35.989578,0.719788 -48.923935,-3.7547 -59.72081,-10.232819c-10.796875,-6.658081 -18.527039,-22.143738 -43,-31.860931c-8.996277,-3.701721 -22.251953,-6.126038 -32.125,-6.126038c-9.872803,0 -22.161469,2.468292 -30.59375,5.766144c-24.472961,9.717194 -32.203125,25.562744 -43,32.220825c-10.796875,6.478119 -25.202026,10.952606 -61.191666,10.232819l0.009628,60.847931l97.90625,0l-0.021484,-33.08075c2.620087,-17.69873 19.481354,-31.542969 37.266022,-31.183075c18.865448,-0.179932 34.318634,15.102356 36.7789,31.183075z";
upro.res.menu.IconData.Fuel="m 128,0.75 c -8.48242,0 -16.9375,6.13064 -16.9375,15.9375 l -0.1875,315.25 17.4375,0 0.15625,24.9375 "+"160.09375,-0.0937 0.125,-24.84375 15,0.125 0,-318.625 C 303.68751,6.64142 299.75087,0.75 292.34375,0.75 "+"L 128,0.75 z m 26.78125,34.84375 104.90625,0 c 5.80827,0 10.37501,2.36551 10.375,10.375 l 0,82.875 "+"c 0,5.61371 -3.00087,9.6875 -9.40625,9.6875 L 155.0625,138.25 c -6.09827,0 -11.34375,-4.50537 "+"-11.34375,-11.0625 l 0.53125,-81.5 c 0,-6.5237 4.51979,-10.09375 10.53125,-10.09375 z m -42.94914,73.51416 "+"-16.02161,-0.0949 c -0.10388,65.19305 0.37125,193.85491 0.64277,196.05634 0.5796,4.69931 0.22912,9.56779 "+"-0.97746,14.00308 -25.11647,63.27313 -106.38805,34.21172 -94.84854,-27.3567 25.3448,-61.07053 60.88334,-102.39502 "+"78.57086,-174.42538 l 1.57455,53.54482 C 64.8545,201.81087 36.77166,256.21167 14.99276,301.68501 "+"13.15788,343.66887 63.10162,357.50125 78.74349,312.43723 85.71402,233.55555 78.48141,147.5723 78.35038,65.13983 "+"88.5149,34.92256 99.73039,32.03014 111.11247,33.46938";
upro.res.menu.IconData.MinSecurity="M16,18.285 16,0 8,0 8,18.285 4,18.285 12.012,27.428 20,18.285M0,27.428h24v4.572h-24";
upro.res.menu.IconData.MaxSecurity="M 16,13.715 16,32 8,32 8,13.715 4,13.715 12.012,4.572 20,13.715 M 0,4.572 H 24 V 0 H 0";
upro.res.menu.IconData.Higher="m 3.5735,13.3805 6.187,-6.187 6.187,6.187 3.536,-3.536 -9.723,-9.724 -9.726,9.724 z";upro.res.menu.IconData.Lower="m 3.5735,0.1205 6.187,6.187 6.187,-6.187 3.536,3.536 -9.723,9.724 -9.726,-9.724 z";
upro.res.menu.IconData.JumpGate="m 488.75443,221.34201 c 10e-6,122.24563 -99.22484,221.46875 -221.46875,221.46875 -60.88551,0 -115.94223,-24.71272 "+"-155.96875,-64.53125 l 0.1875,-0.1875 c -11.1131,-8.04967 -18.406265,-21.05123 -18.406245,-35.8125 0,-24.44877 "+"19.832355,-44.3125 44.281245,-44.3125 14.99209,0 28.20383,7.49714 36.21875,18.90625 l 0.15625,-0.15625 "+"c 24.09666,23.9259 56.9975,38.90625 93.53125,38.90625 73.70089,0 133.53125,-60.11044 133.53125,-134.15625 "+"10e-6,-74.04582 -59.83035,-134.125007 -133.53125,-134.125007 -33.34259,10e-6 -63.57981,12.54037 "+"-86.9375,32.906257 -7.90659,12.11468 -21.52681,20.18749 -37.0625,20.1875 -24.44889,0 -44.312517,-19.86373 "+"-44.312497,-44.312507 0,-11.95254 4.826587,-22.748327 12.531247,-30.718747 l -0.625,-0.625 c 40.05678,-40.05216 "+"95.31901,-64.87498978 156.40625,-64.87499978 122.2439,-3e-5 221.46876,99.19185678 221.46875,221.43750378 z "+"m -219.9375,0.0312 c 0,24.5374 -20.8151,38.3553 -45.09375,44.28125 l -196.656245,48 c -24.2786471,5.92595 "+"-27.09374907,-67.74384 -27.09374907,-92.28125 0,-24.5374 2.01706997,-106.0121 26.09374907,-99.3125 l 197.656245,55 "+"c 24.07665,6.69959 45.09375,19.77511 45.09375,44.3125 z";
upro.res.menu.IconData.Wormhole="m 488.70418,221.36103 c 10e-6,122.24563 -99.22484,221.46875 -221.46875,221.46875 -60.88551,0 -115.94223,-24.71272 "+"-155.96875,-64.53125 l 0.1875,-0.1875 c -11.1131,-8.04967 -18.406265,-21.05123 -18.406245,-35.8125 0,-24.44877 "+"19.832355,-44.3125 44.281245,-44.3125 14.99209,0 28.20383,7.49714 36.21875,18.90625 l 0.15625,-0.15625 "+"c 24.09666,23.9259 56.9975,38.90625 93.53125,38.90625 73.70089,0 133.53125,-60.11044 133.53125,-134.15625 "+"10e-6,-74.04582 -59.83035,-134.125001 -133.53125,-134.125001 -33.34259,1e-5 -63.57981,12.54037 "+"-86.9375,32.906251 -7.90659,12.11468 -21.52681,20.18749 -37.0625,20.1875 -24.44889,0 -44.312515,-19.86373 "+"-44.312495,-44.312501 0,-11.95254 4.826585,-22.748326 12.531245,-30.718746 l 1.14277,-0.625 c 40.05678,-40.05216 "+"93.55124,-64.87498968 154.63848,-64.87499968 122.2439,-3e-5 221.46876,99.19185568 221.46875,221.43749668 z "+"m -219.9375,0.0312 c 0,24.5374 -20.10236,44.28125 -45.09375,44.28125 l -178.656245,0 c -24.99139,0 "+"-45.09375241,-19.74384 -45.09375241,-44.28125 0,-24.5374 20.10233241,-44.31251 45.09375241,-44.3125 "+"l 178.656245,0 c 24.99139,0 45.09375,19.77511 45.09375,44.3125 z";
upro.res.menu.IconData.JumpDrive="M28,14c0-7.729-6.27-14-14-14S0,6.271,0,14C0,8.477,4.477,4,10,4s10,4.477,10,10v2h-4l8,8l8-8h-4V14z";
upro.res.menu.IconData.Hash="M28,12V8h-5.004l1-8h-4l-1,8h-7.998l1-8h-4l-1,8H0v4h6.499L5.5,20H0v4h5l-1,8h4l1-8h7.998l-1,8h4l1-8H28v-4h-6.502 "+"l0.998-8H28z M17.498,20H9.5l0.999-8h7.998L17.498,20z";
upro.res.menu.IconData.Capabilities="M9.6,30c0,1.105-0.893,2-2.001,2c-1.105,0-2-0.895-2-2s0.895-2,2-2C8.707,28,9.6,28.894,9.6,30z"+"M7.676,25.976c-1.336,0-2.59-0.52-3.535-1.465s-1.465-2.199-1.465-3.535s0.52-2.59,1.465-3.535l6.688-6.688"+"C11.586,9.999,12,8.995,12,7.925c0-1.067-0.414-2.072-1.172-2.828c-1.559-1.559-4.097-1.562-5.656,0C4.415,5.854,4,6.858,4,7.925"+"H0c0-2.137,0.833-4.148,2.348-5.66c3.02-3.023,8.285-3.02,11.309,0.003C15.168,3.777,16,5.787,16,7.925"+"c0,2.137-0.832,4.145-2.344,5.656l-6.688,6.688c-0.388,0.391-0.388,1.023,0,1.414c0.391,0.391,1.023,0.391,1.414,0"+"c0.254-0.255,0.293-0.555,0.293-0.708h4c0,1.336-0.52,2.591-1.465,3.536S9.012,25.976,7.676,25.976L7.676,25.976z";
upro.res.text.templates={};upro.res.text.templates["en"]={"general.on":"On","general.off":"Off","routing.menuLabel":"Routing","routing.clearRoute":"Clear Route","routing.capabilities.menuLabel":"Capabilities","routing.rules.menuLabel":"Routing Rules","routing.rules.toggle":"Turn {0} {1}","routing.rules.up":"Increase Priority","routing.rules.down":"Decrease Priority","routing.rules.rule[MinSecurity].menuLabel":"Minimum Security","routing.rules.rule[MinSecurity].paramLimit":"Minimum Security at {0}","routing.rules.rule[MinSecurity].paramSet":"Minimum Security at {0} - Set to {1}","routing.rules.rule[MaxSecurity].menuLabel":"Maximum Security","routing.rules.rule[MaxSecurity].paramLimit":"Use Security below {0}","routing.rules.rule[MaxSecurity].paramSet":"Use Security below {0} - Set to {1}","routing.rules.rule[Jumps].menuLabel":"Jump Count","routing.rules.rule[Jumps].paramLimit":"Jump Count Margin at {0}","routing.rules.rule[Jumps].paramSet":"Jump Count Margin at {0} - Set to {1}","routing.rules.rule[JumpFuel].menuLabel":"Jump Fuel (Distance)","routing.rules.rule[JumpFuel].paramLimit":"Distance Margin at {0}ly","routing.rules.rule[JumpFuel].paramSet":"Distance Margin at {0}ly - Set to {1}ly","routing.caps.jumpGates.toggle":"Turn Jump Gate Capability {0}","routing.caps.jumpDrive.menuLabel":"Jump Drive","routing.caps.jumpDrive.toggle":"Turn Jump Drive Capability {0}","routing.caps.jumpDrive.rangeLimit":"Jump Range at {0}ly","routing.caps.jumpDrive.rangeSet":"Jump Range at {0}ly - Set to {1}ly","corridor.menuLabel":"Jump Corridors","corridor.exit":"Set Exit","corridor.entry.wormhole":"Wormhole Entry","corridor.entry.jumpBridge":"Jump Bridge Entry","solarSystem.routing.addCheckpoint":"Add as Checkpoint","solarSystem.routing.addWaypoint":"Add as Waypoint","solarSystem.routing.toggleIgnore":"Ignore Solar System","solarSystem.routing.remove":"Remove from Route"};
